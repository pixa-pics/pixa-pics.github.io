/*! For license information please see chunk_12.min.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{654:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rgba_=t}return r(e,[{key:"setRGBA",value:function(e){this.rgba_[0]=e[0],this.rgba_[1]=e[1],this.rgba_[2]=e[2],this.rgba_[3]=e[3]}},{key:"setUint32",value:function(e){e=(0|e)>>>0,this.rgba_[3]=e>>24&255,this.rgba_[2]=e>>16&255,this.rgba_[1]=e>>8&255,this.rgba_[0]=255&e}},{key:"r",get:function(){return this.rgba_[0]}},{key:"g",get:function(){return this.rgba_[1]}},{key:"b",get:function(){return this.rgba_[2]}},{key:"a",get:function(){return this.rgba_[3]}},{key:"rgba",get:function(){return this.rgba_.subarray(0,4)}},{key:"uint32",get:function(){return(this.r<<24|this.g<<16|this.b<<8|this.a)>>>0}}],[{key:"createUint32",value:function(t){return new e(new Uint8Array(Uint32Array.of((0|t)>>>0).buffer))}}]),e}(),t.default=i},655:function(e,t,n){"use strict";var r,i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(654),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"colorDifference",value:function(e,t){return Math.sqrt(Math.pow(e.r-t.r,2)+Math.pow(e.g-t.g,2)+Math.pow(e.b-t.b,2)+Math.pow(e.a-t.a,2))}},{key:"averageColor",value:function(e){var t,n=new Uint32Array(4);return e.forEach((function(e){var t=e.rgba;n[0]=(n[0]+t[0]|0)>>>0,n[1]=(n[1]+t[1]|0)>>>0,n[2]=(n[2]+t[2]|0)>>>0,n[3]=(n[3]+t[3]|0)>>>0})),t=e.length,new a.default(Uint8Array.of(n[0]/t|0,n[1]/t|0,n[2]/t|0,n[3]/t|0))}}]),e}(),t.default=o},657:function(e,t,n){"use strict";var r,i=n(656),a=n(650),o=(0,a.SIMDopeCreateConfAdd)({create:{new_of:!0},properties:{uint32:!0,laba:!0,rgbaon4bits:!0,rgbaon6bits:!0,rgbaon8bits:!0,rgbaon12bits:!0,rgbaon16bits:!0,skin:!0},methods:{simplify:!0,get_new_element:!0,get_use_element:!0,set_tail:!0,is_dark:!0,blend_first_with:!0,blend_first_with_tails:!0,blend_all:!0,cie76_match_with:!0,copy:!0}}),s=Math.fround,u=s(1),c=s(.777),l=(0,a.SIMDopeCreate)(o),h=l.simdops,f=l.Color,d=l.Colors,p=(h.minus_int,h.int_not_equal,h.plus_int,h.plus_uint,h.minus_uint,h.multiply_int,h.multiply_uint,h.multiply_uint_4),g=(h.divide_uint,h.clamp_uint8,h.clamp_uint32,h.int_equal,h.uint_less,h.int_less,h.int_greater_equal,h.uint_not_equal,h.uint_less_equal,h.min_uint,function e(t){if(t=t||{},!(this instanceof e))return new e(t);t.pxl_colors=t.pxl_colors||new Uint32Array(0),t.pxls=t.pxls||new Uint32Array(0),this.new_pxls_="buffer"in t.pxls?new Uint32Array(t.pxls.buffer):Uint32Array.from(t.pxls),this.new_pxl_colors_="buffer"in t.pxl_colors?new d(t.pxl_colors.buffer):new d(Uint32Array.from(t.pxl_colors).buffer),this.original_pxls_=this.new_pxls_.slice(0,this.new_pxls_.length),this.original_pxl_colors_=this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length);var n=0|this.new_pxl_colors_.length;this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|n),this.set_new_pxl_skin_mask(),this.best_color_number_=t.number_of_color,this.max_cluster_=this.new_pxl_colors_.length>16384?65537:this.new_pxl_colors_.length>4096?4097:this.new_pxl_colors_.length>1024?257:this.new_pxl_colors_.length>256?17:1,this.index_clusters_=Array(this.max_cluster_),this.length_clusters_=new Uint32Array(this.max_cluster_),this.pxl_colors_usage_=new Uint32Array(n),this.all_index_clusters_=new Uint32Array(n),this.clean_pxl_colors_=new Uint32Array(n),this.clean_pxl_colors_lookup_={},this.is_skin_ops_=0,this.match_ops_=0,this.blend_ops_=0,this.remove_duplicate_ops_=0,this.simplify_ops_=0,this.classify_on_x_bits_ops_=0});Object.defineProperty(g.prototype,"set_is_skin_ops",{get:function(){return function(e){this.is_skin_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_match_ops",{get:function(){return function(e){this.match_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_blend_ops",{get:function(){return function(e){this.blend_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_remove_duplicate_ops",{get:function(){return function(e){this.remove_duplicate_ops_=(0|e)>>>0}}}),Object.defineProperty(g.prototype,"set_simplify_ops",{get:function(){return function(e){this.simplify_ops_=e}}}),Object.defineProperty(g.prototype,"set_classify_on_x_bits_ops",{get:function(){return function(e){this.classify_on_x_bits_ops_=e}}}),Object.defineProperty(g.prototype,"get_is_skin_ops",{get:function(){return function(){return 0|this.is_skin_ops_}}}),Object.defineProperty(g.prototype,"get_match_ops",{get:function(){return function(){return 0|this.match_ops_}}}),Object.defineProperty(g.prototype,"get_blend_ops",{get:function(){return function(){return 0|this.blend_ops_}}}),Object.defineProperty(g.prototype,"get_remove_duplicate_ops",{get:function(){return function(){return 0|this.remove_duplicate_ops_}}}),Object.defineProperty(g.prototype,"get_simplify_ops",{get:function(){return function(){return this.simplify_ops_}}}),Object.defineProperty(g.prototype,"get_classify_on_x_bits_ops",{get:function(){return function(){return this.classify_on_x_bits_ops_}}}),Object.defineProperty(g.prototype,"reset_deduplicate",{get:function(){return function(e){this.clean_pxl_colors_lookup_={},this.pxl_colors_usage_.fill(0,0,0|e),this.clean_pxl_colors_.fill(0,0,0|e)}}}),Object.defineProperty(g.prototype,"index_of_color_within_cleaned",{get:function(){return function(e){return(0|this.clean_pxl_colors_lookup_[(0|e)>>>0])-1|0}}}),Object.defineProperty(g.prototype,"set_cleaned_pxl_colors",{get:function(){return function(e,t){this.clean_pxl_colors_[(0|e)>>>0]=(0|t)>>>0,this.clean_pxl_colors_lookup_[(0|t)>>>0]=(e+1|0)>>>0}}}),Object.defineProperty(g.prototype,"increase_color_usage",{get:function(){return function(e){this.pxl_colors_usage_[(0|e)>>>0]=(this.pxl_colors_usage_[(0|e)>>>0]+1|0)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxls",{get:function(){return function(e,t){this.new_pxls_[(0|e)>>>0]=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"set_new_pxl_colors",{get:function(){return function(e){this.new_pxl_colors_=new d(this.clean_pxl_colors_.buffer.slice(0,p(0|e))),this.set_new_pxl_skin_mask()}}}),Object.defineProperty(g.prototype,"set_new_pxl_skin_mask",{get:function(){return function(){var e=new f(new ArrayBuffer(4)),t=0|this.new_pxl_colors_.length,n=0;for(this.new_pxl_colors_is_skin_mask_=new i.SetFixed(0|t);(0|n)<(0|t);n=n+1|0)this.new_pxl_colors_.get_use_element(0|n,e).skin&&this.new_pxl_colors_is_skin_mask_.add(0|n);this.set_is_skin_ops(this.get_is_skin_ops()+n|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color_from_pxl_index",{get:function(){return function(e){return 4294967295&this.new_pxl_colors_.buffer_getUint32(this.new_pxls_[0|e])}}}),Object.defineProperty(g.prototype,"reset_cluster",{get:function(){return function(e){this.max_cluster_=e?1:this.new_pxl_colors_.length>16384?65537:this.new_pxl_colors_.length>4096?4097:this.new_pxl_colors_.length>1024?257:this.new_pxl_colors_.length>256?17:1,this.length_clusters_.fill(0,0,0|this.max_cluster);for(var t=0;(0|t)<(0|this.max_cluster);t=(t+1|0)>>>0)this.index_clusters_[0|t]=[]}}}),Object.defineProperty(g.prototype,"reset_original_data",{get:function(){return function(){this.new_pxl_colors_=new d(this.original_pxl_colors_.slice(0,this.original_pxl_colors_.length).buffer),this.new_pxls_=this.original_pxls_.slice(0,this.original_pxls_.length)}}}),Object.defineProperty(g.prototype,"add_in_indexes_cluster",{get:function(){return function(e,t){this.index_clusters_[(0|e)>>>0].push((0|t)>>>0)}}}),Object.defineProperty(g.prototype,"set_all_cluster_indexes",{get:function(){return function(){for(var e=0,t=0;(0|e)<(0|this.max_cluster);e=(e+1|0)>>>0)this.all_index_clusters_.set(this.index_clusters_[(0|e)>>>0],(0|t)>>>0),t=(t+this.get_length_in_index_clusters(0|e)|0)>>>0}}}),Object.defineProperty(g.prototype,"get_length_in_index_clusters",{get:function(){return function(e){return(0|this.index_clusters_[(0|e)>>>0].length)>>>0}}}),Object.defineProperty(g.prototype,"get_in_cluster_lengths",{get:function(){return function(e){return(0|this.length_clusters_[(0|e)>>>0])>>>0}}}),Object.defineProperty(g.prototype,"get_an_index_in_clusters",{get:function(){return function(e){return(0|this.all_index_clusters_[0|e])>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage",{get:function(){return function(e){return(0|this.pxl_colors_usage_[0|e])>>>0}}}),Object.defineProperty(g.prototype,"set_a_color_usage",{get:function(){return function(e,t){return this.pxl_colors_usage_[0|e]=(0|t)>>>0}}}),Object.defineProperty(g.prototype,"get_a_color_usage_percent",{get:function(){return function(e){return s(this.pxl_colors_usage_[0|e]/this.new_pxls_.length)}}}),Object.defineProperty(g.prototype,"get_average_color_usage_percent",{get:function(){return function(e,t){var n,r,i;for(t=0|((t|=0)<(e|=0)?this.pxl_colors_usage_.length:t),n=0,r=0,i=0,r=0|e;(0|r)<(0|t);r=(r+1|0)>>>0)i=(0|this.get_an_index_in_clusters((0|r)>>>0))>>>0,n+=this.pxl_colors_usage_[0|i]/this.new_pxls_.length;return n/(t-e|0)}}}),Object.defineProperty(g.prototype,"get_a_new_pxl_color",{get:function(){return function(e){return this.new_pxl_colors_.get_new_element(0|e)}}}),Object.defineProperty(g.prototype,"is_pxl_color_skin",{get:function(){return function(e){return this.new_pxl_colors_is_skin_mask_.has(0|e)}}}),Object.defineProperty(g.prototype,"max_cluster",{get:function(){return 0|this.max_cluster_}}),Object.defineProperty(g.prototype,"new_pxls_length",{get:function(){return 0|this.new_pxls_.length}}),Object.defineProperty(g.prototype,"new_pxl_colors_length",{get:function(){return 0|this.new_pxl_colors_.length}}),Object.defineProperty(g.prototype,"best_color_number",{get:function(){return 0|this.best_color_number_}}),Object.defineProperty(g.prototype,"get_data",{get:function(){return function(){return Array.of(this.new_pxls_,this.new_pxl_colors_.slice_uint32(0,this.new_pxl_colors_.length),{deduplicate:this.get_remove_duplicate_ops(),simplify:this.get_simplify_ops(),classify:this.get_classify_on_x_bits_ops(),skin:this.get_is_skin_ops(),blend:this.get_blend_ops(),match:this.get_match_ops()})}}}),g.prototype.output=function(e){var t,n;return e=e||"heap",t=this.get_data(),"heap"==e?((n=new Uint32Array(2+t[0].length+t[1].length))[0]=0|t[0].length,n[1]=0|t[1].length,n.set(t[0],2),n.set(t[1],2+t[0].length),n.buffer):t},g.prototype.deduplicate=function(){var e,t,n,r,i;for(this.set_remove_duplicate_ops(this.get_remove_duplicate_ops()+1|0),this.reset_deduplicate(0|this.new_pxl_colors_length),e=0,t=0,n=0,r=0,i=0|this.new_pxls_length;(0|r)<(0|i);r=(r+1|0)>>>0)t=0|this.get_a_new_pxl_color_from_pxl_index(0|r),-1==(0|(n=0|this.index_of_color_within_cleaned(0|t)))&&(this.set_cleaned_pxl_colors(0|e,0|t),n=0|e,e=e+1|0),this.increase_color_usage(0|n),this.set_new_pxls(0|r,0|n);this.set_new_pxl_colors(e)},g.prototype.clusterize=function(e){this.reset_cluster(e);var t=0;if(65537===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon16bits)>>>0,(0|t)>>>0);else if(4097===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon12bits)>>>0,(0|t)>>>0);else if(257===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon8bits)>>>0,(0|t)>>>0);else if(17===this.max_cluster)for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster((0|this.get_a_new_pxl_color((0|t)>>>0).rgbaon4bits)>>>0,(0|t)>>>0);else for(;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.add_in_indexes_cluster(0,(0|t)>>>0);this.max_cluster>1&&this.set_classify_on_x_bits_ops(this.get_classify_on_x_bits_ops()+this.new_pxl_colors_length),this.set_all_cluster_indexes()},g.prototype.process_threshold=function(e){var t,n,r,i,a,o,l,h,d,p,g,_,v,y,m,b,w,x,k,P,O,j,S,C,A,E;for(n=function(e,n){return s(Math.pow(e,t)/n)}(e=(0|e)>>>0,Math.pow(255,t=1)),r=0,i=[],a=[],o=0,l=0,p=!1,g=!1,_=0,v=0,y=0,m=0,b=0,w=0,x=s(n),O=0,j=0,S=0,C=0,A=0,E=0,P=s(x*c),k=s(x*u);(0|A)<(0|this.max_cluster);A=(A+1|0)>>>0){for(l=(o+((0|this.get_length_in_index_clusters(0|A))>>>0)|0)>>>0,b=this.get_average_color_usage_percent(0|o,0|l),S=0|o;(0|S)<(0|l);S=(S+1|0)>>>0){if(O=(0|this.get_an_index_in_clusters((0|S)>>>0))>>>0,h=this.get_a_new_pxl_color((0|O)>>>0),p=this.is_pxl_color_skin((0|O)>>>0),(0|(_=(0|this.get_a_color_usage((0|O)>>>0))>>>0))>0)for(i=[],C=0|o;(0|C)<(0|l);C=(C+1|0)>>>0)j=(0|this.get_an_index_in_clusters((0|C)>>>0))>>>0,d=this.get_a_new_pxl_color((0|j)>>>0),g=this.is_pxl_color_skin((0|j)>>>0),0|(v=(0|this.get_a_color_usage((0|j)>>>0))>>>0)&&(0|O)!=(0|j)&&(0|p)==(0|g)&&(y=this.get_a_color_usage_percent((0|O)>>>0)/b,m=this.get_a_color_usage_percent((0|j)>>>0)/b,E=s((E=p&&g?P:p||g?k:x)*(0*Math.abs(y-m)+.223*(2-(y+m))/2+.777)/1),h.cie76_match_with(d,E)&&(w=s(v/_),r++,this.set_a_color_usage(0|j,0),i.push(d),a.push(w)));(0|i.length)>0&&(f.blend_all(h,i,a),i=[],a=[])}o=0|l}return r},g.prototype.round=function(){var e,t;if(this.new_pxl_colors_length>2048){for(e=0|(this.new_pxl_colors_length>6e4?4:this.new_pxl_colors_length>32e3?3:this.new_pxl_colors_length>16e3?2:this.new_pxl_colors_length>8192?1.5:this.new_pxl_colors_length>4096?1.25:1),t=0;(0|t)<(0|this.new_pxl_colors_length);t=(t+1|0)>>>0)this.get_a_new_pxl_color((0|t)>>>0).simplify(e);this.set_simplify_ops(this.get_simplify_ops()+this.new_pxl_colors_length)}},g.prototype.init=function(e){return this.round(),this.deduplicate(),this.clusterize(),this},g.prototype.reset_original=function(){return this.reset_original_data(),this},g.prototype.run=function(){var e=0;if(this.new_pxl_colors_length<=this.best_color_number)return this.reset_original(),this.deduplicate(),this.clusterize(),this;for(;this.new_pxl_colors_length>this.best_color_number&&e<255;)e++,this.process_threshold(0|e)>0&&(this.deduplicate(),this.clusterize());return this.reset_original(),this.deduplicate(),this.clusterize(this.new_pxl_colors_length<4096),this.process_threshold(0|e),this.deduplicate(),this.clusterize(),this},g.split_image_data=function(e){var t,n,r=new Uint32Array(e.data.buffer),i=Uint32Array.from(new Set(r)),a={},o=i.length,s=new Uint32Array(r.length);for(t=0,n=0|o;(0|t)<(0|n);t=(t+1|0)>>>0)a[i[0|t]]=(0|t)>>>0;for(t=0,n=0|r.length;(0|t)<(0|n);t=(t+1|0)>>>0)s[0|t]=(0|a[r[0|t]])>>>0;return[s,i,r,o]},r=function(e,t){return new Promise((function(n){var r,i,a,o,s,u,c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),4!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(g.split_image_data(e)),l=c[0],h=c[1],f=c[2],d=c[3],p=Date.now(),_="auto"===t,v=parseFloat(t)>0&&parseFloat(t)<1,y=parseInt(t)<0,m=_?"auto":v||y?y?Math.max(1,d+parseInt(t)):v?Math.max(1,parseFloat(t)*d):d:parseInt(t);if("auto"===m&&(m=d>255?255:d/2|0),m>=d)n([e,l,h,0,h.length,0]);else{for(r=g({pxls:l,pxl_colors:h,number_of_color:Math.min(d,m),width:e.width,height:e.height}).init().run().output("split"),i=Date.now(),o=0|(a=r[0]).length,s=r[1],u=0;(0|u)<(0|o);u=(u+1|0)>>>0)f[0|u]=(0|s[(0|a[0|u])>>>0])>>>0;n([e=new ImageData(new Uint8ClampedArray(f.buffer),e.width,e.height),a,s,d-s.length,s.length,i-p])}}))},e.exports={QuantiMatGlobal:r,QuantiMat:g}},658:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.strength=t,this.tilesManager=n,this.tiles=n.getTiles(),this.width=r,this.height=i}},660:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=(i=n(672))&&i.__esModule?i:{default:i},t.default=r.default.pool({minWorkers:0,maxWorkers:3})},662:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a,o,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r(n(654)),r(n(655)),n(656),s=n(657),u=Math.abs,c=Math.imul,l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contextSource=t}return o(e,[{key:"computePaletteData",value:function(){var t=this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height),n=Date.now(),r=e.quantizeImageData(this.contextSource,128),i=r.centroids.length,a=Date.now(),o=e._calculateDistortions(r,t),s=Date.now(),u=e._findElbowPoint(o.clustersDistortion),c=Date.now(),l=e._calculateElbowStrength(o.clustersDistortion,u),h=Date.now(),f=0===u?this.contextSource.getImageData(0,0,this.contextSource.canvas.width,this.contextSource.canvas.height):e.quantizeImageData(this.contextSource,u).imageData,d=Date.now();return console.log({quantizeImageData1:a-n,_calculateDistortions:s-a,_findElbowPoint:c-s,"_calculateElbowStrength+updateThreshold":h-c,quantizeImageData2:d-h}),{colorNumber:0===u?i:u,colorNumberCertainty:l,colorData:f}}},{key:"analyzeImageForTileSize",value:function(e){function t(e){for(var t,n,r,i=0,a=4,o=1;a>=4&&a<=32;)t=e[a],e[2*a-1],e[2*a],e[2*a+1],e[4*a-1],e[4*a],e[4*a+1],i<(n=t*a*(1+.1*a))&&(i=n,o=a),a++;return r=0,e.forEach((function(e,t){r+=e*t})),{tileSize:o,certainty:Math.fround(o*e[o]/r)}}var n,r,i,a,o,s,u,c=e.width,l=e.height,h=new Uint32Array(e.data.buffer),f=64,d=new Uint32Array(f),p=new Uint32Array(f),g=0,_=new Uint32Array(2);for(n=0;n<l;n++){for(g=0,r=1;r<c;r++)_[0]=n*c+r|0,_[1]=_[0]-1|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(d[g]=d[g]+1|0),g=1);g>0&&g<f&&(d[g]=d[g]+1|0)}for(i=0;i<c;i++){for(g=0,a=1;a<l;a++)_[0]=a*c+i|0,_[1]=_[0]-c|0,h[_[0]]==h[_[1]]?g++:(g>1&&g<f&&(p[g]=p[g]+1|0),g=1);g>0&&g<f&&(p[g]=p[g]+1|0)}return o=t(d),s=t(p),{tileSize:(u=100*Math.max(o.certainty,s.certainty))===o.certainty?o.tileSize:s.tileSize,certainty:u}}}],[{key:"colorDifference",value:function(e,t){var n=Uint8Array.of(u((e>>24&255)-(t>>24&255)),u((e>>16&255)-(t>>16&255)),u((e>>8&255)-(t>>8&255))),r=Uint16Array.of(c(n[0],n[0]),c(n[1],n[1]),c(n[2],n[2]));return(0|Math.sqrt((((r[0]<<1)+r[0]|0)+(r[1]<<2)+(r[2]<<1)|0)/10))>>>0}},{key:"quantizeImageData",value:function(e,t){var n,r,i,o,u=e.getImageData(0,0,e.canvas.width,e.canvas.height),c=Date.now(),l=s.QuantiMat.split_image_data(u),h=a(l,2),f=h[0],d=h[1],p=Date.now(),g=(0,s.QuantiMat)({pxls:f,pxl_colors:d,number_of_color:Math.min(d.length,t),width:u.width,height:u.height}).init().run().output("split"),_=Date.now();for(console.log(p-c,_-p),n=g[0],r=g[1],i=new Uint32Array(n.length),o=0;o<n.length;o++)i[o]=r[n[o]];return u.data.set(new Uint8ClampedArray(i.buffer)),{imageData:u,clusterAssignments:n,centroids:r}}},{key:"_calculateDistortions",value:function(t,n){var r,i=t.imageData,a=t.clusterAssignments,o=t.centroids,s=Math.imul,u=0,c=new Uint32Array(n.data.buffer),l=new Uint32Array(i.data.buffer),h=new BigUint64Array(o.length),f=0;for(r=0;r<l.length;r++)u+=f=0|s(f=0|e.colorDifference(l[r],c[r]),f),h[a[r]]+=BigInt(f);return{totalDistortion:u,clustersDistortion:Array.from(h).map((function(e){return Number(e)})).sort((function(e,t){return t-e}))}}},{key:"_findElbowPoint",value:function(e){var t,n,r,i,a,o,s,u=[];for(e.forEach((function(e){e&&u.push(e)})),t=[],n=1;n<e.length;n++)r=e[n]-e[n-1],0!==(i=e[n-1])?t.push(r/i):t.push(0);for(a=0,o=t[0],s=1;s<t.length;s++)t[s]>o&&(a=s,o=t[s]);return a}},{key:"_calculateElbowStrength",value:function(e,t){var n,r,a,o=e.map((function(t,n){return n/(e.length-1)})),s=Math.max.apply(Math,i(e)),u=Math.min.apply(Math,i(e)),c=e.map((function(e){return(e-u)/(s-u)})),l=[0,c[0]],h=[1,c[c.length-1]],f=[o[t],c[t]],d=Math.sqrt(Math.pow(h[0]-l[0],2)+Math.pow(h[1]-l[1],2)),p=Math.abs(((a=h)[1]-(r=l)[1])*(n=f)[0]-(a[0]-r[0])*n[1]+a[0]*r[1]-a[1]*r[0])/Math.sqrt(Math.pow(a[1]-r[1],2)+Math.pow(a[0]-r[0],2));return Math.fround(p/d)}}]),e}(),t.default=l},663:function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"initializeCanvas",value:function(e,t,n){t=(e=e||{width:0,height:0}).width||t||1,n=e.height||n||1;var r=void 0,i=void 0;try{i=(r=new OffscreenCanvas(t,n)).getContext("2d",{willReadFrequently:!0,desynchronized:!0})}catch(a){(r=document.createElement("canvas")).width=t,r.height=n,i=r.getContext("2d",{willReadFrequently:!0,desynchronized:!0})}return e instanceof ImageData?i.putImageData(e,0,0):e.width&&i.drawImage(e,0,0,t,n),{canvas:r,context:i}}},{key:"canvasContextToImageData",value:function(e){return e.getImageData(0,0,e.canvas.width,e.canvas.height)}}]),e}(),t.default=i},664:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(665)),a=r(n(666));e.exports=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,i.default)(e);return n&&(t=/(?:#)[0-9a-f]{8}|(?:#)[0-9a-f]{6}|(?:#)[0-9a-f]{4}|(?:#)[0-9a-f]{3}/gi,r.match(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),3!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e.match(/\w\w/g).map((function(e){return parseInt(e,16)}))),n=t[0],i=t[1],a=t[2],o=Math.round((n+i+a)/3),s=function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n}(o,o,o);r=r.replace(e,s)}))),(0,a.default)(r)}},668:function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(i,a){var o,s;try{s=(o=t[i](a)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t,n){o(this,e),this.baseUrl=t,this.msgCallback=n||function(){}}var t,n,r,i,u;return s(e,[{key:"generateRandomSeed",value:function(){try{return crypto.getRandomValues(new Uint32Array(1))[0]}catch(e){return Math.round(4294967295*Math.random())}}},{key:"message",value:function(e){var t,n,r,i,a,o,s,u;try{if(n=(t=JSON.parse(e.slice(5))||{}).msg,(this.date_message||Date.now()-3e3)+3e3<=Date.now())switch(this.date_message=Date.now(),n){case"estimation":r=t.rank_eta||0,i=(t.queue_size||0)-1,a=t.rank||0,o="Estimated waiting duration: "+parseInt(r)+" seconds. "+(i>a?"Process will start after "+i+" remaining job"+(i?"s":""):"Process will start immediately"),this.msgCallback(o);break;case"progress":u="Processing: "+(s=(t.progress_data||[])[0]||{}).index+"/"+s.length+" "+s.unit+".",this.msgCallback(u)}}catch(c){}}},{key:"generateRandomId",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t="";e>=6;)t+=Math.round(16777215*Math.random()).toString(16).padStart(6,"0"),e-=6;return e>0&&(t+=Math.round(16777215*Math.random()).toString(16).padStart(6,"0").slice(0,e)),t}},{key:"getHeadersJson",value:function(){return{"Content-Type":"application/json"}}},{key:"getHeadersStream",value:function(){return{accept:"text/event-stream"}}},{key:"getHeadersAll",value:function(){return{accept:"*/*"}}},{key:"getUploadUrl",value:function(e){return this.baseUrl+"/upload?upload_id="+e}},{key:"getCreateImagePathUrl",value:function(e){return this.baseUrl+"/file="+e}},{key:"handleLoadComplete",value:(u=a(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=void 0===n?"blob":n,a=(t||"/unknown.webp").split("/"),o=a[a.length-1]||"unknown.png",s=o.split(".")[1]||"png",u="image/"+s,s="jpeg"===s?"jpg":s,e.prev=6,e.next=9,new Promise((function(e){var a=new Image;a.setAttribute("crossorigin","anonymous"),a.onload=function(){var t,o,s=a.naturalHeight||a.height,u=a.naturalWidth||a.width;i=i||s,r=r||u;try{switch(n.toLowerCase()){case"base64":!function(){var t=document.createElement("canvas");t.width=r,t.height=i,t.getContext("2d").drawImage(a,0,0,r,i);try{e(t.toDataURL("image/webp",.75))}catch(n){e(t.toDataURL("image/jpeg",.75))}}();break;case"blob":!function(){var t=document.createElement("canvas");t.width=r,t.height=i,t.getContext("2d").drawImage(a,0,0,r,i);try{t.toBlob(e,"image/webp",.75)}catch(n){t.toBlob(e,"image/jpeg",.75)}}();break;case"imagedata":(o=document.createElement("canvas")).width=r,o.height=i,(t=o.getContext("2d")).drawImage(a,0,0,r,i),e(t.getImageData(0,0,r,i,{colorSpace:"srgb"}))}}catch(c){}},a.setAttribute("src",t)}));case 9:c=e.sent,e.t0=n,e.next="blob"===e.t0?13:"base64"===e.t0?15:"imagedata"===e.t0?16:17;break;case 13:return l=new File([c],o,{type:u}),e.abrupt("return",Promise.resolve(l));case 15:case 16:return e.abrupt("return",Promise.resolve(c));case 17:e.next=23;break;case 19:return e.prev=19,e.t1=e.catch(6),console.error("Error creating file from URL:",e.t1),e.abrupt("return",Promise.reject());case 23:case"end":return e.stop()}}),e,this,[[6,19]])}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"uploadFile",value:(i=a(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("files",t),e.next=4,fetch(this.getUploadUrl(n),{method:"POST",body:r});case 4:return i=e.sent,e.next=7,i.json();case 7:return a=e.sent,e.abrupt("return",Promise.resolve(a[0]||a));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetchEventSource",value:(r=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:this.getHeadersAll(),method:"GET"});case 2:return n=e.sent,e.abrupt("return",Promise.resolve(n.body.getReader()));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchEventSourceJSON",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:this.getHeadersJson(),method:"GET"});case 2:return n=e.sent,e.next=5,n.clone().text();case 5:return r=e.sent,i=r.replaceAll("event: complete\ndata: ",""),e.prev=7,e.abrupt("return",Promise.resolve(JSON.parse(i)));case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return",Promise.reject());case 14:case"end":return e.stop()}}),e,this,[[7,11]])}))),function(e){return n.apply(this,arguments)})},{key:"readResponse",value:(t=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h,f,d,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i=!1,a=null;case 4:if(i){e.next=35;break}return e.next=7,t.read();case 7:for(o=e.sent,s=o.value,u=o.done,i=i||u,r+=n.decode(s||new Uint8Array,{stream:!0}),c=(r||"\n").split("\n"),l=!0,h=!1,f=void 0,e.prev=16,d=c[Symbol.iterator]();!(l=(p=d.next()).done);l=!0)g=(g=p.value).trim(),this.message(g),console.log(g),g.includes("complete")&&(i=!0,a=g);e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),h=!0,f=e.t0;case 24:e.prev=24,e.prev=25,!l&&d.return&&d.return();case 27:if(e.prev=27,!h){e.next=30;break}throw f;case 30:return e.finish(27);case 31:return e.finish(24);case 32:r=c[c.length-1],e.next=4;break;case 35:return e.abrupt("return",Promise.resolve(a));case 36:case"end":return e.stop()}}),e,this,[[16,20,24,32],[25,,27,31]])}))),function(e){return t.apply(this,arguments)})}]),e}(),c=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://gokaygokay-sd3-long-captioner-v2.hf.space",e))}var n,u,c;return i(t,e),s(t,[{key:"getCreateCaptionsUrl",value:function(){return this.baseUrl+"/call/create_captions_rich"}},{key:"getReadCaptions",value:function(e){try{return JSON.parse(e.slice(5))}catch(t){return""}}},{key:"readResponse",value:(c=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h,f,d,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i=!1,a=null;case 4:if(i){e.next=35;break}return e.next=7,t.read();case 7:for(o=e.sent,s=o.value,u=o.done,i=i||u,r+=n.decode(s||new Uint8Array,{stream:!0}),c=(r||"\n").split("\n"),l=!0,h=!1,f=void 0,e.prev=16,d=c[Symbol.iterator]();!(l=(p=d.next()).done);l=!0)g=(g=p.value).trim(),this.message(g),g.includes("complete")&&(i=!0,a=g);e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),h=!0,f=e.t0;case 24:e.prev=24,e.prev=25,!l&&d.return&&d.return();case 27:if(e.prev=27,!h){e.next=30;break}throw f;case 30:return e.finish(27);case 31:return e.finish(24);case 32:r=c[c.length-1],e.next=4;break;case 35:return e.abrupt("return",i?Promise.resolve(a):Promise.reject("Error"));case 36:case"end":return e.stop()}}),e,this,[[16,20,24,32],[25,,27,31]])}))),function(e){return c.apply(this,arguments)})},{key:"createCaptions",value:(u=a(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.getCreateCaptionsUrl(),{method:"POST",headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:t}]})});case 2:return n=e.sent,e.prev=3,e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",Promise.resolve(r.event_id));case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",Promise.reject("Error"));case 13:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e){return u.apply(this,arguments)})},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,"string"!=typeof t){e.next=7;break}return e.next=4,this.handleLoadComplete(t);case 4:n=e.sent,e.next=12;break;case 7:if(!(t instanceof Blob)){e.next=11;break}n=t,e.next=12;break;case 11:return e.abrupt("return",Promise.reject());case 12:return r=this.generateRandomId(),e.next=15,this.uploadFile(n,r);case 15:return i=e.sent,a=this.getCreateCaptionsUrl(),e.next=19,this.createCaptions(i);case 19:return o=e.sent,e.abrupt("return",this.fetchEventSourceJSON(a+"/"+o).then((function(e){return e[0]})).catch((function(){return""})));case 21:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),t}(u),l=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://gokaygokay-florence-2.hf.space",e))}var n;return i(t,e),s(t,[{key:"getPredictHeader",value:function(e,t,n,r,i,a){return a=a||1,{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+r.replaceAll("image/",""),size:n,mime_type:r,meta:{_type:"gradio.FileData"}},1===a?"Caption":2===a?"Detailed Caption":"More Detailed Caption","","microsoft/Florence-2-large"],event_data:null,fn_index:4,trigger_id:10,session_hash:i}),method:"POST"}}},{key:"getQueueJoinUrl",value:function(){return this.baseUrl+"/queue/join"}},{key:"getResultUrl",value:function(e){return this.baseUrl+"/queue/data?session_hash="+e}},{key:"readLine",value:function(e,t){var n,r,i;console.log(e),e=e.slice(5);try{return(n=JSON.parse(e)).success?(r=((n.output||{}).data||[])[0],i=1===t?r.slice(15,r.length-2):2===t?r.slice(24,r.length-2):r.slice(29,r.length-2),Promise.resolve(i.replaceAll("\\n","").replaceAll("\n",""))):Promise.reject("")}catch(a){return Promise.reject()}}},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,"string"!=typeof t){e.next=7;break}return e.next=4,this.handleLoadComplete(t);case 4:r=e.sent,e.next=12;break;case 7:if(!(t instanceof Blob)){e.next=11;break}r=t,e.next=12;break;case 11:case 32:return e.abrupt("return",Promise.reject());case 12:return i=this.generateRandomId(),e.next=15,this.uploadFile(r,i);case 15:return a=e.sent,o=this.getCreateImagePathUrl(a),s=this.getPredictHeader(a,o,r.size,r.type,i,n),e.next=20,fetch(this.getQueueJoinUrl(),s);case 20:return u=e.sent,e.next=23,u.json();case 23:if(!e.sent.event_id){e.next=32;break}return e.next=28,this.fetchEventSource(this.getResultUrl(i));case 28:return c=e.sent,e.abrupt("return",this.readResponse(c).then((function(e){return l.readLine(e,n)})).catch((function(){return Promise.reject()})));case 33:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),t}(u),h=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://kenjiedec-rembg.hf.space",e))}var n;return i(t,e),s(t,[{key:"getQueuePushUrl",value:function(){return this.baseUrl+"/api/queue/push/"}},{key:"getPredictHeader",value:function(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({action:"predict",data:[e,"Mask only","isnet-general-use"],fn_index:0,session_hash:t}),method:"POST"}}},{key:"getQueueStatusUrl",value:function(){return this.baseUrl+"/api/queue/status/"}},{key:"getResultHeader",value:function(e){return{headers:this.getHeadersJson(),body:JSON.stringify({hash:e}),method:"POST"}}},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t,n,r){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=a(regeneratorRuntime.mark((function e(o,s){var u,c,l,h,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=void 0,"string"==typeof t){e.next=7;break}return e.next=4,i.handleLoadComplete(t,"base64");case 4:u=e.sent,e.next=14;break;case 7:if(!t.startsWith("blob:")){e.next=13;break}return e.next=10,i.handleLoadComplete(t,"base64");case 10:u=e.sent,e.next=14;break;case 13:u=t;case 14:return c=i.generateRandomId(),e.next=17,fetch(i.getQueuePushUrl(),i.getPredictHeader(u,c));case 17:return e.next=19,e.sent.json();case 19:l=e.sent,h=l.hash,f=setTimeout((function(){clearInterval(d),s()}),1e4),d=setInterval(a(regeneratorRuntime.mark((function e(){var t,a,s,u,c,l,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(i.getQueueStatusUrl(),i.getResultHeader(h));case 2:return e.next=4,e.sent.json();case 4:if(t=e.sent,a=t.data||{},!(s=a.data||[]).length){e.next=18;break}return e.next=10,i.handleLoadComplete(s[0],"imagedata",n,r);case 10:for(u=e.sent,c=u.data,l=[],p=0,g=c.length;(0|p)<(0|g);p=p+4|0)(0|(c[0|p]+c[p+1|0]+c[p+2|0]|0)/3)<32&&l.push(p/4|0);o(l),clearInterval(d),clearTimeout(f);case 18:case"end":return e.stop()}}),e,i)}))),1e3);case 23:case"end":return e.stop()}}),e,i)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})}]),t}(u),f=function(e){function t(e){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://pixart-alpha-pixart-sigma.hf.space",e))}var n,u;return i(t,e),s(t,[{key:"getPredictHeader",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:512,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"(No style)",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"bad shape, disformed, photography, photo, realistic, photo-realistic.",s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"DPM-Solver",u=this.generateRandomSeed();return a="string"==typeof a?a:["(No style)","Pixel Art","Digital Art","Anime","Manga"][a],{headers:this.getHeadersJson(),body:JSON.stringify({data:["A pixel art (retro style video game palette artwork) of : "+e,o,a,!0,i,u,n,r,s,4.5,3.5,17,25,!0],event_data:null,fn_index:3,trigger_id:7,session_hash:t}),method:"POST"}}},{key:"getQueueJoinUrl",value:function(){return this.baseUrl+"/queue/join?__theme=light"}},{key:"getResultUrl",value:function(e){return this.baseUrl+"/queue/data?session_hash="+e}},{key:"readResponse",value:(u=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h,f,d,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i=!1,a=null;case 4:if(i){e.next=35;break}return e.next=7,t.read();case 7:for(o=e.sent,s=o.value,u=o.done,i=i||u,r+=n.decode(s||new Uint8Array,{stream:!0}),c=(r||"\n").split("\n"),l=!0,h=!1,f=void 0,e.prev=16,d=c[Symbol.iterator]();!(l=(p=d.next()).done);l=!0)g=(g=p.value).trim(),this.message(g),g.includes("complete")&&(i=!0,a=g);e.next=24;break;case 20:e.prev=20,e.t0=e.catch(16),h=!0,f=e.t0;case 24:e.prev=24,e.prev=25,!l&&d.return&&d.return();case 27:if(e.prev=27,!h){e.next=30;break}throw f;case 30:return e.finish(27);case 31:return e.finish(24);case 32:r=c[c.length-1],e.next=4;break;case 35:return e.abrupt("return",Promise.resolve(a));case 36:case"end":return e.stop()}}),e,this,[[16,20,24,32],[25,,27,31]])}))),function(e){return u.apply(this,arguments)})},{key:"extractLastImageUrl",value:function(e,t){var n,r,i,a,o,s,u;try{for(console.log(e),n=JSON.parse(e.slice(5).trim()),r=[],i=n.output.data||[],a=0;a<i.length;a++)for(o=i[a],s=0;s<o.length;s++)(u=o[s]).image&&u.image.url&&r.push(u.image.url);return r}catch(c){return console.error("Failed to parse JSON or extract image URLs:",c),[]}}},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,d=this,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"imagedata";return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.generateRandomId(),r=this.getPredictHeader(t,n,h,f,p,1),i=this.getQueueJoinUrl(),e.next=5,fetch(i,r);case 5:return a=e.sent,e.next=8,a.json();case 8:if(!e.sent.event_id){e.next=27;break}return e.next=13,this.fetchEventSource(this.getResultUrl(n));case 13:return o=e.sent,e.next=16,this.readResponse(o);case 16:if(s=e.sent,1!==(u=this.extractLastImageUrl(s)).length){e.next=26;break}return c=u[0],e.next=22,this.handleLoadComplete(c,g);case 22:return l=e.sent,e.abrupt("return",Promise.resolve(l));case 26:return e.abrupt("return",Promise.allSettled([u.map((function(){return d.handleLoadComplete(i,g)}))]));case 27:return e.abrupt("return",Promise.reject());case 28:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),t}(u),d={lucasArt:{url:"https://civitai.com/models/247890/lucasarts-adventure-game-style-xl",weight:1,face:.9,image:.12,scale:7.75,strength:.8,prompt:"A 2D illustration in retro game style pixel art of '${prompt}' in lucasarts style. Video game, low color number, high quality.",negative:"Realistic, photography, real."},thimbled:{url:"https://civitai.com/models/174301/pixelartthimbledweed",weight:1.2,face:.9,image:.15,scale:9,strength:.8,prompt:"A 2D illustration in retro game style pixel art of '${prompt}'. Video game, low color number, high quality.",negative:"Realistic, photography, real."},arsMJ:{url:"https://civitai.com/models/547343/pixel-art-pony-sdxl",weight:.8,face:.9,image:.2,scale:9,strength:.8,prompt:"A 2D illustration in retro game style Pixel Art of '${prompt}'. Video game, low color number, high quality.",negative:"Realistic, photography, real."}},p=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://abidlabs-face-to-all.hf.space",e));return n.styles=d,n}var n,u;return i(t,e),s(t,[{key:"getPredictUrl",value:function(){return this.baseUrl+"/run/predict"}},{key:"getPredictHeader",value:function(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}},{key:"getQueueJoinUrl",value:function(){return this.baseUrl+"/queue/join?__theme=light"}},{key:"extractSecondImageUrl",value:function(e){var t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}},{key:"getQueueJoinHeader",value:function(e,t,n,r,i,a,o){var s=this.styles[a],u=s.prompt.replace("${prompt}",i.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+r.replaceAll("image/",""),size:n,mime_type:r,meta:{_type:"gradio.FileData"}},u,s.negative,s.face,null,s.weight,s.image,s.scale,s.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:o}),method:"POST"}}},{key:"getQueueDataUrl",value:function(e){return this.baseUrl+"/queue/data?session_hash="+e}},{key:"readResponse",value:(u=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i="",a=!1;case 3:if(a){e.next=16;break}return e.next=6,t.read();case 6:for(o=e.sent,s=o.value,u=o.done,a=a||u,r+="".concat(n.decode(s||new Uint8Array,{stream:!0})),c=(r||"\n").split("\n"),l=0;l<c.length;l++)h=c[l].trim(),this.message(h),h.includes("complete")&&(a=!0,i=h);r=c[c.length-1],e.next=3;break;case 16:return e.abrupt("return",Promise.resolve(i));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,h,f,d,p,g,_,v,y,m,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lucasArt";return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,"string"!=typeof t){e.next=7;break}return e.next=4,this.handleLoadComplete(t);case 4:r=e.sent,e.next=12;break;case 7:if(!(t instanceof Blob)){e.next=11;break}r=t,e.next=12;break;case 11:case 47:return e.abrupt("return",Promise.reject());case 12:return i=this.generateRandomId(),a=this.generateRandomId(),o=this.getPredictHeader(this.styles[b].url,a),s=this.getPredictUrl(),e.next=18,fetch(s,o);case 18:return u=e.sent,c=u.ok,e.next=22,this.uploadFile(r,i);case 22:if(l=e.sent,h=this.getCreateImagePathUrl(l),!c||!h){e.next=47;break}return f=this.getQueueJoinHeader(l,h,r.size,r.type,n,b,a),d=this.getQueueJoinUrl(),e.next=29,fetch(d,f);case 29:return p=e.sent,e.next=32,p.json();case 32:if(void 0===e.sent.event_id){e.next=47;break}return g=this.getQueueDataUrl(a),e.next=38,this.fetchEventSource(g);case 38:return _=e.sent,e.next=41,this.readResponse(_);case 41:return v=e.sent,y=this.extractSecondImageUrl(v),e.next=45,this.handleLoadComplete(y);case 45:return m=e.sent,e.abrupt("return",Promise.resolve(m));case 48:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),t}(u),g=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://multimodalart-face-to-all.hf.space",e));return n.styles=d,n}var n,u;return i(t,e),s(t,[{key:"getPredictUrl",value:function(){return this.baseUrl+"/queue/join"}},{key:"getPredictHeader",value:function(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}},{key:"extractSecondImageUrl",value:function(e){var t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}},{key:"getQueueJoinHeader",value:function(e,t,n,r,i,a,o){var s=this.styles[a],u=s.prompt.replace("${prompt}",i.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+r.replaceAll("image/",""),size:n,mime_type:r,meta:{_type:"gradio.FileData"}},u,s.negative,s.face,null,s.weight,s.image,s.scale,s.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:o}),method:"POST"}}},{key:"readResponse",value:(u=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i="",a=!1;case 3:if(a){e.next=16;break}return e.next=6,t.read();case 6:for(o=e.sent,s=o.value,u=o.done,a=a||u,r+="".concat(n.decode(s||new Uint8Array,{stream:!0})),c=(r||"\n").split("\n"),l=0;l<c.length;l++)h=c[l].trim(),this.message(h),h.includes("complete")&&h.includes('success":true')&&!h.includes("custom_lora_card")&&!h.includes('data":[]')&&(a=!0,i=h);r=c[c.length-1],e.next=3;break;case 16:return e.abrupt("return",Promise.resolve(i));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,h,f,d,p,g,_,v,y,m,b,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lucasArt";return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,"string"!=typeof t){e.next=7;break}return e.next=4,this.handleLoadComplete(t);case 4:r=e.sent,e.next=12;break;case 7:if(!(t instanceof Blob)){e.next=11;break}r=t,e.next=12;break;case 11:case 57:return e.abrupt("return",Promise.reject());case 12:return i=this.generateRandomId(8),a=this.generateRandomId(11),o=this.getPredictHeader(this.styles[w].url,a),s=this.getPredictUrl(),e.next=18,fetch(s,o);case 18:return u=e.sent,c=u.ok,e.next=22,this.uploadFile(r,i);case 22:if(l=e.sent,h=this.getCreateImagePathUrl(l),!c||!h){e.next=57;break}return f=this.getQueueJoinHeader(l,h,r.size,r.type,n,w,a),d=this.getQueueJoinUrl(),e.next=29,fetch(d,f);case 29:if(!(p=e.sent).ok){e.next=57;break}return e.next=34,p.json();case 34:if(void 0===e.sent.event_id){e.next=57;break}return g=this.getQueueDataUrl(a),e.next=40,fetch(g,this.getUselessBullshit(a));case 40:if(!(_=e.sent).ok){e.next=57;break}return e.next=44,_.json();case 44:if(!e.sent.event_id){e.next=57;break}return e.next=48,this.fetchEventSource(g);case 48:return v=e.sent,e.next=51,this.readResponse(v);case 51:return y=e.sent,m=this.extractSecondImageUrl(y),e.next=55,this.handleLoadComplete(m);case 55:return b=e.sent,e.abrupt("return",Promise.resolve(b));case 58:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),t}(u),_=function(e){function t(e){o(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"https://neil-ni-face-to-all.hf.space",e));return n.styles=d,n}var n,u;return i(t,e),s(t,[{key:"getPredictUrl",value:function(){return this.baseUrl+"/run/predict"}},{key:"getPredictHeader",value:function(e,t){return{headers:this.getHeadersJson(),body:JSON.stringify({data:[e],event_data:null,fn_index:0,trigger_id:11,session_hash:t}),method:"POST"}}},{key:"extractSecondImageUrl",value:function(e){var t=e.match(/"url":"(https:\/\/[^"]+)"/g);return t&&t.length>1?t[1].match(/"url":"(https:\/\/[^"]+)"/)[1]:null}},{key:"getQueueJoinHeader",value:function(e,t,n,r,i,a,o){var s=this.styles[a],u=s.prompt.replace("${prompt}",i.replaceAll("\\n","").replaceAll("\\",""));return{headers:this.getHeadersJson(),body:JSON.stringify({data:[{path:e,url:t,orig_name:"image."+r.replaceAll("image/",""),size:n,mime_type:r,meta:{_type:"gradio.FileData"}},u,s.negative,s.face,null,s.weight,s.image,s.scale,s.strength,null,null],event_data:null,fn_index:6,trigger_id:18,session_hash:o}),method:"POST"}}},{key:"readResponse",value:(u=a(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,u,c,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new TextDecoder("utf-8"),r="",i="",a=!1;case 3:if(a){e.next=16;break}return e.next=6,t.read();case 6:for(o=e.sent,s=o.value,u=o.done,a=a||u,r+="".concat(n.decode(s||new Uint8Array,{stream:!0})),c=(r||"\n").split("\n"),l=0;l<c.length;l++)h=c[l].trim(),this.message(h),h.includes("complete")&&(a=!0,i=h);r=c[c.length-1],e.next=3;break;case 16:return e.abrupt("return",Promise.resolve(i));case 17:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"run",value:(n=a(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,u,c,l,h,f,d,p,g,_,v,y,m,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lucasArt";return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0,"string"!=typeof t){e.next=7;break}return e.next=4,this.handleLoadComplete(t);case 4:r=e.sent,e.next=12;break;case 7:if(!(t instanceof Blob)){e.next=11;break}r=t,e.next=12;break;case 11:case 49:return e.abrupt("return",Promise.reject());case 12:return i=this.generateRandomId(),a=this.generateRandomId(),o=this.getPredictHeader(this.styles[b].url,a),s=this.getPredictUrl(),e.next=18,fetch(s,o);case 18:return u=e.sent,e.next=21,u.json();case 21:return c=e.sent,e.next=24,this.uploadFile(r,i);case 24:if(l=e.sent,h=this.getCreateImagePathUrl(l),!c||!h){e.next=49;break}return f=this.getQueueJoinHeader(l,h,r.size,r.type,n,b,a),d=this.getQueueJoinUrl(),e.next=31,fetch(d,f);case 31:return p=e.sent,e.next=34,p.json();case 34:if(void 0===e.sent.event_id){e.next=49;break}return g=this.getQueueDataUrl(a),e.next=40,this.fetchEventSource(g);case 40:return _=e.sent,e.next=43,this.readResponse(_);case 43:return v=e.sent,y=this.extractSecondImageUrl(v),e.next=47,this.handleLoadComplete(y);case 47:return m=e.sent,e.abrupt("return",Promise.resolve(m));case 50:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),t}(u);e.exports={HuggingFaceAPI:u,FaceToAllAPI:p,FaceToAllAPI2:g,FaceToAllAPI3:_,FloranceCaptionerAPI:l,LongCaptionerAPI:c,RemoveBackgroundAPI:h,ImageCreatorAPI:f}},669:function(e,t,n){"use strict";var r=n(670);e.exports={createLocalBlob:function(e){var t,n,i,a,o=(e.match(/(data\:([a-z]+\/[a-z\+]+)\;base64\,)([a-zA-Z0-9\/\+]+\(\=+)?/)||[,,])[1];return o?(n=(t=o.match(/data\:([a-z]+\/[a-z\+]+)\;base64\,/)[1]).match(/[a-z]+\/([a-z\+]+)/)[1],e=e.replace(o,""),i=(0,r.base64ToBytes)(e),a=new File([i],"name."+n,{type:t}),URL.createObjectURL(a)):""}}},670:function(e,t,n){"use strict";var r=new(n(265).B64chromium);e.exports={bytesToBase64:r.bytesToBase64.bind(r),base64ToBytes:r.base64ToBytes.bind(r)}},677:function(e,t,n){"use strict";var r,i=n(678),a=Object.getPrototypeOf((r=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e,this)})),function(){var e=r.apply(this,arguments);return new Promise((function(t,n){return function r(i,a){var o,s;try{s=(o=e[i](a)).value}catch(u){return void n(u)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}("next")}))})).constructor,o=Object.getPrototypeOf((function(){})).constructor,s=new o('var t = function(file) {\n    "use strict";\n    \n    try {\n        \n        return new Promise(function(resolve, _) {\n            resolve(new FileReaderSync().readAsDataURL(file));\n        });\n        \n    } catch(error) {\n    \n        return new Promise(function(resolve, _) {\n            var reader = new FileReader();\n            reader.onload = function(){ resolve(reader.result)};\n            reader.readAsDataURL(file);\n        });\n    }\n    \n}; return t;')(),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(s,[e]).catch((function(t){return s(e)})).timeout(5e3).then((function(e){t(e)})):s(e).then((function(e){t(e)}))},c=new a('var t = async function(base64) {\n\n    "use strict";\n\n    return fetch(base64).then(function(res) {\n\n        return res.blob().then(function(blb){\n\n            return createImageBitmap(blb, {\n                resizeQuality: "pixelated",\n                premultiplyAlpha: \'premultiply\'\n            });\n        });\n    });\n\n}; return t;')(),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null!==n?n.exec(c,[e]).catch((function(t){return c(e)})).timeout(5e3).then((function(e){t(e)})):c(e).then((function(e){t(e)}))},h=function(e){for(var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2073600,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=1;Math.round(e.width*a)*Math.round(e.height*a)>r;)a-=.01;try{createImageBitmap(e,0,0,e.width,e.height,{resizeWidth:Math.round(e.width*a),resizeHeight:Math.round(e.height*a),resizeQuality:"pixelated",premultiplyAlpha:"premultiply"}).then((function(e){var t,n=void 0;try{n=new OffscreenCanvas(e.width,e.height)}catch(r){(n=document.createElement("canvas")).width=e.width,n.height=e.height}(t=n.getContext("2d")).imageSmoothingEnabled=!1,t.drawImage(e,0,0,e.width,e.height),i(t.getImageData(0,0,e.width,e.height))}))}catch(o){t=void 0;try{t=new OffscreenCanvas(Math.round(e.width*a),Math.round(e.height*a))}catch(s){(t=document.createElement("canvas")).width=Math.round(e.width*a),t.height=Math.round(e.height*a)}(n=t.getContext("2d")).imageSmoothingEnabled=!1,n.drawImage(e,0,0,t.width,t.height),i(n.getImageData(0,0,t.width,t.height))}},f=new o('var t = function(imagedata, type) {\n\n    "use strict"\n    type = type || "image/png";\n    var quality = type.includes("webp") ? 1: type.includes("png") ? undefined: 0.7;\n    try {\n    \n        return new Promise(function(resolve, _) {\n\n            createImageBitmap(imagedata, 0, 0, imagedata.width, imagedata.height, {\n                premultiplyAlpha: \'premultiply\',\n                resizeQuality: \'pixelated\'\n            }).then((bmp) => {\n            \n                var canvas;\n                    canvas = new OffscreenCanvas(imagedata.width, imagedata.height);\n                var ctx = canvas.getContext("bitmaprenderer");\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.transferFromImageBitmap(bmp);\n                \n                canvas.convertToBlob({type: type, quality: quality}).then((blb) => {\n                    try {\n                        resolve(new FileReaderSync().readAsDataURL(blb));\n                    } catch(e2) {\n                        var reader = new FileReader();\n                        reader.onload = function(){ resolve(reader.result)};\n                        reader.readAsDataURL(blb);\n                    }\n                });\n            });\n        });\n       \n    }catch (e) {\n    \n        return new Promise(function(resolve, _) {\n            var canvas = document.createElement("canvas");\n            canvas.width = imagedata.width;\n            canvas.height = imagedata.height;\n            var ctx = canvas.getContext("2d");\n            ctx.imageSmoothingEnabled = false;\n            ctx.putImageData(imagedata, 0, 0);\n            \n            var base64 = canvas.toDataURL(type, quality);\n            canvas = null;\n            resolve(base64);\n        });\n    }\n\n}; return t;')();e.exports={file_to_imagedata_resized:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Date.now(),e.type,"image/jpg"!==e.type&&e.type,e.type,u(e,(function(e){l(e,(function(e){h(e,t,(function(e){n(e)}),r)}),r)}),r)},file_to_base64:u,base64_to_bitmap:l,bitmap_to_imagedata:h,imagedata_to_base64:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;null!==r?r.exec(f,[e,t]).catch((function(n){return f(e,t)})).timeout(5e3).then((function(e){n(e)})):f(e,t).then((function(e){n(e)}))},base64_sanitize:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};(function(e,t,n){return n=n||"pixelize",new Promise((function(r,a){var o=new Image,s=e.startsWith("data:image/png;");o.onload=function(){var e,a,u=o.naturalWidth*t,c=o.naturalHeight*t,l=function(e,t,n,r){var a,o,s,u,c=void 0;if("pixelize"===r||"normal"===r){a=void 0,o=void 0;try{a=new OffscreenCanvas(e.width,e.height),o=new OffscreenCanvas(t,n)}catch(l){a=document.createElement("canvas"),o=document.createElement("canvas"),a.width=e.width,a.height=e.height,o.width=t,o.height=n}s=a.getContext("2d"),u=o.getContext("2d"),s.imageSmoothingEnabled=!("normal"!==r),u.imageSmoothingEnabled=!("normal"!==r),s.drawImage(e,0,0,e.width,e.height),u.drawImage(a,0,0,a.width,a.height,0,0,o.width,o.height),c=u}else"doppel"===r&&(c=i.scaler.processImage(e,t,n));return c}(o,0|u,0|c,n);try{e=l.getImageData(0,0,l.canvas.width,l.canvas.height),createImageBitmap(e).then((function(e){var t,n;try{t=new OffscreenCanvas(e.width,e.height)}catch(i){(t=document.createElement("canvas")).height=e.height,t.width=e.width}(n=t.getContext("bitmaprenderer")).imageSmoothingEnabled=!1,n.transferFromImageBitmap(e),t.convertToBlob({type:s?"image/png":"image/jpeg"}).then((function(e){try{r((new FileReaderSync).readAsDataURL(e))}catch(n){var t=new FileReader;t.onload=function(){r(t.result)},t.readAsDataURL(e)}}))}))}catch(h){a=l.canvas,r(a.toDataURL(s?"image/png":"image/jpeg"))}},o.onerror=function(){a()},o.src=e}))})(e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,arguments[4]).then((function(e){t(e)}))},file_to_bitmap:function(e,t){createImageBitmap(e).then(t)}}},678:function(e,t,n){"use strict";var r,i=(r=n(679))&&r.__esModule?r:{default:r},a=new i.default({strength:1,overlapFactor:1,despeckleStrength:.88});e.exports={scaler:a,ImageProcessor:i.default}},679:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h,f,d,p,g;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(662),o=r(a),s=n(680),u=r(s),c=n(682),l=r(c),h=n(663),f=r(h),d=n(655),p=r(d),g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.o=t||{},this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas,this.options={despeckleStrength:this.o.despeckleStrength||this.o.strength||1,quantizeStrength:this.o.quantizeStrength||this.o.strength||1,mergeStrength:this.o.mergeStrength||this.o.strength||1,overlapFactor:this.o.overlapFactor||this.o.strength||1}}return i(e,[{key:"updateFilters",value:function(e){this.filters=new l.default(this.options,this.tilesManager,e,this.finalWidth,this.finalHeight)}},{key:"computeSmartParameters",value:function(){this.imageManager=new o.default(this.context)}},{key:"updateTiles",value:function(){this.tilesManager=new u.default(this.context,this.targetContext,this.targetImageData,this.sizes),this.tilesManager.createTiles(),this.tilesManager.computeTiles()}},{key:"paintTiles",value:function(){this.tilesManager.paintTiles()}},{key:"filterTiles",value:function(){this.filters.applyFilters()}},{key:"setCanvas",value:function(e,t,n){var r,i;e=0|e||1,t=0|t||1,n=n||{width:0,height:0},r=f.default.initializeCanvas(n),this.canvas=r.canvas,this.context=r.context,i=f.default.initializeCanvas(void 0,e,t),this.targetCanvas=i.canvas,this.targetContext=i.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"changeFinalCanvasParameters",value:function(e,t){e=0|e||1,t=0|t||1;var n=f.default.initializeCanvas(void 0,e,t);this.targetCanvas=n.canvas,this.targetContext=n.context,this.targetImageData=this.targetContext.getImageData(0,0,e,t),this.finalWidth=e,this.finalHeight=t,this.tileWidth=Math.fround(this.canvas.width/this.targetCanvas.width),this.tileHeight=Math.fround(this.canvas.height/this.targetCanvas.height)}},{key:"updateThreshold",value:function(){var e,t,n,r,i,a=this,o=this.tilesManager.getTiles(),s=[];for(e=0;e<this.finalHeight;e++)for(t=function(t){var n=o[t+e*a.finalWidth];a.tilesManager.getExtendedNeighbors(t,e,1).forEach((function(e){s.push(p.default.colorDifference(n.meanColor,e.meanColor))}))},n=0;n<this.finalWidth;n++)t(n);return r=s.reduce((function(e,t){return e+t}),0)/s.length,i=Math.sqrt(s.map((function(e){return Math.pow(e-r,2)})).reduce((function(e,t){return e+t}))/s.length),(r+i)/25}},{key:"processImage",value:function(e,t,n){var r,i,a,o,s,u,c,l=Date.now();return this.setCanvas(t,n,e),e.width<=t&&e.height<=n?this.context:(r=Date.now(),this.computeSmartParameters(),i=Date.now(),this.updateTiles(),a=Date.now(),this.updateFilters(this.updateThreshold()),o=Date.now(),this.filterTiles(),s=Date.now(),this.paintTiles(),u=Date.now(),console.log({setCanvas:r-l,updateTilesManager:i-r,initializeTiles:a-i,"updateFilters+updateThreshold":o-a,filterTiles:s-o,paintTiles:u-o}),c=this.targetContext,this.reset(),c)}},{key:"reset",value:function(){var e=this;Array.of("targetContext","tileHeight","tileWidth","finalWidth","finalHeight","targetImageData","targetContext","targetCanvas","context","canvas","tilesManager","filters","imageManager").forEach((function(t){delete e[t]})),this.canvas=f.default.initializeCanvas(void 0,1,1).canvas,this.targetCanvas=f.default.initializeCanvas(void 0,1,1).canvas}},{key:"sizes",get:function(){return{finalWidth:this.finalWidth,finalHeight:this.finalHeight,tileWidth:this.tileWidth,tileHeight:this.tileHeight,overlapFactor:this.options.overlapFactor}}}]),e}(),t.default=g},680:function(e,t,n){"use strict";var r,i,a,o,s;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(681),a=(s=i)&&s.__esModule?s:{default:s},o=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contextSource=t,this.contextDestination=n,this.imageData=r,this.overlapFactor=i.overlapFactor,this.finalWidth=i.finalWidth,this.finalHeight=i.finalHeight,this.tileWidth=i.tileWidth,this.tileHeight=i.tileHeight,this.tiles=Array(this.finalWidth*this.finalHeight).fill(null),this.tilesColorUint32a=new Uint32Array(this.finalWidth*this.finalHeight),this.tilesColorUint8a=new Uint8ClampedArray(this.tilesColorUint32a.buffer),this.extendedTileWidth=this.tileWidth*this.overlapFactor|0,this.extendedTileHeight=this.tileHeight*this.overlapFactor|0,this.tilePaddingWidth=(this.extendedTileWidth-this.tileWidth)/2+1|0,this.tilePaddingHeight=(this.extendedTileHeight-this.tileHeight)/2+1|0}return r(e,[{key:"getTiles",value:function(){return this.tiles}},{key:"extractTileData",value:function(e,t){var n=Math.max(0,e*this.tileWidth-this.tilePaddingWidth|0),r=Math.max(0,t*this.tileHeight-this.tilePaddingHeight|0);return this.contextSource.getImageData(0|n,0|r,0|this.extendedTileWidth,0|this.extendedTileHeight)}},{key:"createTiles",value:function(){var e,t,n,r;for(e=0;e<this.finalHeight;e++)for(t=0;t<this.finalWidth;t++)r=4*(n=t+e*this.finalWidth),this.tiles[n]=new a.default(this.extractTileData(t,e),this.tilesColorUint8a.subarray(r,r+4),t,e)}},{key:"computeTiles",value:function(){for(var e=0;e<this.tiles.length;e++)this.tiles[e].calculateMeanColor()}},{key:"getExtendedNeighbors",value:function(e,t,n){var r,i,a,o,s=[];for(r=-n;r<=n;r++)for(i=-n;i<=n;i++)a=e+r,o=t+i,0===r&&0===i||a<0||o<0||a>=this.finalWidth||o>=this.finalHeight||s.push(this.tiles[a+o*this.finalWidth]);return s}},{key:"paintTiles",value:function(){this.imageData.data.set(this.tilesColorUint8a),this.contextDestination.putImageData(this.imageData,0,0)}}]),e}(),t.default=o},681:function(e,t,n){"use strict";var r,i,a,o,s,u,c;Object.defineProperty(t,"__esModule",{value:!0}),r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(654),o=(c=a)&&c.__esModule?c:{default:c},s=n(657),u=function(){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.imageData=t,this.meanColor=new o.default(n),this.coordinates=Uint16Array.of(i,a),r=this.imageData.data.length,this.k=r>=64?6:r>=16?4:r>=9?3:r>=2?2:1}return i(e,[{key:"quantizeColors",value:function(){var e,t=s.QuantiMat.split_image_data(this.imageData),n=r(t,2),i=n[0],a=n[1],o=(0,s.QuantiMat)({pxls:i,pxl_colors:a,number_of_color:Math.min(a.length,this.k),width:this.imageData.width,height:this.imageData.height}).init().run().output("split"),u=o[0],c=o[1],l=u<255?new Uint8Array(c.length):new Uint16Array(c.length);for(e=0;e<u.length;e++)l[u[e]]++;return[l,c]}},{key:"calculateMeanColor",value:function(){var e=this.quantizeColors(),t=r(e,2),n=t[0],i=t[1][n.indexOf(Math.max.apply(Math,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array.from(n))))];this.meanColor.setUint32(i)}},{key:"x",get:function(){return this.coordinates[0]}},{key:"y",get:function(){return this.coordinates[1]}}]),e}(),t.default=u},682:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(683),o=r(a),s=n(684),u=r(s),c=n(686),l=r(c),h=function(){function e(t,n,r,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mergeFilter=new o.default(r*t.mergeStrength,n,i,a),this.despeckleFilter=new u.default(r*t.despeckleStrength,n,i,a),this.quantizeFilter=new l.default(t.quantizeStrength,n,i,a)}return i(e,[{key:"applyFilters",value:function(){}}]),e}(),t.default=h},683:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(658)),o=n(655),s=r(o),u=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e,t,n,r=this,i=Array(this.width*this.height).fill(!1);for(e=0;e<this.height;e++)for(t=function(t){var n,a,o,u,c=t+e*r.width;if(i[c])return"continue";n=r.tiles[c],o=(a=r.tilesManager.getExtendedNeighbors(t,e,1)).length,(u=a.filter((function(e){return s.default.colorDifference(n.meanColor,e.meanColor)<r.strength}))).length>=o-2&&(u.forEach((function(e){e.meanColor.setRGBA(n.meanColor.rgba);var t=e.x+e.y*r.width;i[t]=!0})),i[c]=!0)},n=0;n<this.width;n++)t(n)}}]),t}(a.default),t.default=u},684:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l,h,f;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(658)),o=n(655),s=r(o),u=n(654),c=r(u),l=n(685),h=r(l),f=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e,t;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)this.adaptiveDespeckleTile(t,e,this.strength)}},{key:"adaptiveDespeckleTile",value:function(e,t,n){var r,i,a,o,u,l,f,d,p=this.tiles[e+t*this.width].meanColor,g=this.tilesManager.getExtendedNeighbors(e,t,4),_=this.tilesManager.getExtendedNeighbors(e,t,1),v=g.length,y=g.map((function(e){return e.meanColor})),m=new h.default(y.map((function(e){return e.rgba})),4).run(v),b=(m.centroids,m.centroidsSorted);switch(m.clusters,this.determineClassification(b,v)){case"AREA":r=new c.default(b[0].data),(i=s.default.colorDifference(r,p))>0&&i<60&&p.setRGBA(r.rgba);break;case"EDGE":a=new c.default(b[0].data),o=new c.default(b[1].data),u=s.default.colorDifference(a,o),l=s.default.colorDifference(a,p),f=s.default.colorDifference(o,p),5*Math.abs(l-f)>=u&&(d=new c.default(new h.default(_.map((function(e){return e.meanColor.rgba})),4).run(4).centroidsSorted[0].data),p.setRGBA(d.rgba))}}},{key:"determineClassification",value:function(e,t){return e[0].count>=.75*t?"AREA":Math.abs(e[0].count-e[1].count)*Math.abs(e[2].count-e[3].count)<25?"SHAPE":Math.abs(e[0].count-e[1].count)<.75*Math.abs(e[1].count-e[2].count)?"EDGE":"COMPLEX"}}]),t}(a.default),t.default=f},685:function(e,t,n){"use strict";var r,i,a;Object.defineProperty(t,"__esModule",{value:!0}),r=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(650),a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.k=Math.min(n,Math.ceil(Math.sqrt(this.data.length))),this.centroids=Array(this.k),this.clusters=new Uint32Array(this.data.length),this.c1=new i.Color(new ArrayBuffer(4)),this.c2=new i.Color(new ArrayBuffer(4))}return r(e,[{key:"initializeCentroids",value:function(){var e,t,n=new Set,r=[];for(e=0;e<this.k;e++){t=void 0;do{t=Math.floor(Math.random()*this.data.length)}while(n.has(t));n.add(t),r.push(Uint8Array.from(this.data[t]))}this.centroids=r}},{key:"assignClusters",value:function(){var e=this;this.data.forEach((function(t,n){var r=Number.MAX_VALUE,i=0;e.centroids.forEach((function(n,a){var o=e.distance(t,n);o<r&&(r=o,i=a)})),e.clusters[n]=i}))}},{key:"updateCentroids",value:function(){var e=this,t=Array.from({length:this.k},(function(){return new Uint32Array(e.data[0].length)})),n=new Uint32Array(this.k);return this.data.forEach((function(r,i){var a=e.clusters[i];t[a]=t[a].map((function(e,t){return e+r[t]})),n[a]++})),n}},{key:"findFarthestPointFromCentroids",value:function(){var e=this,t=0,n=0;return this.data.forEach((function(r,i){var a=Number.MAX_VALUE;e.centroids.forEach((function(t){var n=e.distance(r,t);n<a&&(a=n)})),a>t&&(t=a,n=i)})),n}},{key:"distance",value:function(e,t){return this.c1.set_from_array(e),this.c2.set_from_array(t),16192*this.c1.fast_match_with(this.c2)|0}},{key:"reassignCentroids",value:function(e){for(var t=0;t<e.length;t++)0===e[t]&&(this.centroids[t]=this.findFarthestPointFromCentroids())}},{key:"run",value:function(){var e,t,n,r,i,a,o=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.initializeCentroids(),e=0,t=!1,n=void 0,r=function(){var r=o.centroids.map((function(e){return Uint32Array.from(e)}));o.assignClusters(),n=o.updateCentroids(),e++,t=o.centroids.every((function(e,t){return o.distance(e,r[t])<2})),u&&!t&&o.reassignCentroids(n)};!t&&e<s;)r();return i=this.getCentroidsPopulationCount(this.centroids,this.clusters),a=Array.from(this.centroids).map((function(e,t){return{data:Uint8ClampedArray.from(e),count:i[t]}})).sort((function(e,t){return t.count-e.count})),{centroids:this.centroids,clusters:this.clusters,centroidsSorted:a}}},{key:"getCentroidsPopulationCount",value:function(e,t){var n=new Uint32Array(e.length);return t.forEach((function(e){n[e]++})),n}}]),e}(),t.default=a},686:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i,a,o,s,u,c,l;Object.defineProperty(t,"__esModule",{value:!0}),i=function(){function e(e,t){var n,r;for(n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(n(658)),o=n(662),s=r(o),u=n(663),c=r(u),l=function(e){function t(e,n,r,i){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"apply",value:function(){var e=this.strength,t=new ImageData(this.tilesManager.tilesColorUint8a,this.width,this.height),n=c.default.initializeCanvas(t).context,r=s.default.quantizeImageData(n,e).imageData;this.tilesManager.tilesColorUint8a.set(r.data)}}]),t}(a.default),t.default=l},693:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(737)),a=r(n(257));e.exports={UJS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"COMPRESS_OBJECT";return new Promise((function(n,r){"COMPRESS_OBJECT"===t?n(new Uint8ClampedArray(i.default.compress(a.default.pack(e)).buffer)):"DECOMPRESS_UINT8A"===t&&n(a.default.unpack(i.default.uncompress(e)))}))}}},828:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=r(n(660)),a=r(n(153)),o=r(n(829));e.exports={base64png_to_xbrz_svg:function(e,t,r,s){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"xbrz",l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]&&arguments[7],f=arguments.length>8&&void 0!==arguments[8]&&arguments[8],d=new Image;d.onload=function(){var e,p,g,_,v,y,m,b,w,x,k=document.createElement("canvas"),P=k.getContext("2d"),O=d.width,j=d.height;k.width=O,k.height=j,P.drawImage(d,0,0,O,j),e=P.getImageData(0,0,O,j),p=function(e,t){return new Promise((function(t,r){(0,a.default)((function(){return n.e(2).then(n.t.bind(null,722,7))})).then((function(n){(0,n.crt)(e,1).then(t).catch(r)}))}))},g=function(e,t,r,o,s){l?(0,a.default)((function(){return n.e(6).then(n.t.bind(null,721,7))})).then((function(u){(0,u.oxi_png)(e,3,!1,i.default).then((function(e){s(e,t,r,o)})).catch((function(){(0,a.default)((function(){return n.e(0).then(n.t.bind(null,659,7))})).then((function(n){(0,n.png_quant)(e,100,100,1,i.default).then((function(e){s(e,t,r,o)})).catch((function(){s(e,t,r,o)}))})).catch((function(){s(e,t,r,o)}))}))})).catch((function(){s(e,t,r,o)})):s(e,t,r,o)},_=function(e,t){h?(0,a.default)((function(){return n.e(23).then(n.t.bind(null,943,7))})).then((function(o){(0,o.image_tracer)(e,{pal:u.map((function(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16),a:parseInt(e.slice(7,9),16)}})),corsenabled:!1,ltres:t,qtres:t,pathomit:t,rightangleenhance:!1,colorsampling:2,numberofcolors:512,mincolorratio:0,colorquantcycles:1,layering:0,strokewidth:Math.ceil(t/2),linefilter:!0,scale:1,roundcoords:2,viewbox:!0,desc:!1,lcpr:0,qcpr:0,blurradius:t,blurdelta:4*t},i.default).then((function(e){l?(0,a.default)((function(){return n.e(1).then(n.bind(null,691))})).then((function(n){var i=n.optimize;e=i(e,{path:"path-to.svg",multipass:!0,mergePaths:!0,mergeStyles:!0,collapseGroups:!0,reusePaths:!0,plugin:["multipass","mergePaths","collapseGroups","reusePaths","mergeStyles"]}).data,r("data:image/svg+xml;base64,"+window.btoa(e),t)})):r("data:image/svg+xml;base64,"+window.btoa(e),t)}))})):r("",0)},"depixelize"===c?(y=(v=(0,o.default)(e,h))[0],m=v[1],(b=document.createElement("canvas")).width=y.width,b.height=y.height,(w=b.getContext("2d")).putImageData(y,0,0),x=w.canvas.toDataURL("image/png"),f&&p(y).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,10,e.width,e.height,s)})),h&&(l?(0,a.default)((function(){return n.e(1).then(n.bind(null,691))})).then((function(e){var t=e.optimize;m=t(m,{path:"path-to.svg",multipass:!0,plugin:["mergePaths"]}).data,r("data:image/svg+xml;base64,"+window.btoa(m),10)})):r("data:image/svg+xml;base64,"+window.btoa(m),10)),g(x,10,y.width,y.height,t)):"omniscale"===c?(0,a.default)((function(){return n.e(24).then(n.t.bind(null,944,7))})).then((function(n){(0,n.omniscale)(e,8,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,8,e.width,e.height,s)})),_(e,8),g(r,8,e.width,e.height,t)}))})):"hexagon"===c?(0,a.default)((function(){return n.e(5).then(n.t.bind(null,723,7))})).then((function(n){(0,n.hexagonrender)(e,16).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,16,e.width,e.height,s)})),_(e,32/6),g(r,32,e.width,e.height,t)}))})):"kikko"===c?(0,a.default)((function(){return n.e(42).then(n.t.bind(null,945,7))})).then((function(n){(0,n.kikkorender)(e,24,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,24,e.width,e.height,s)})),_(e,6),g(r,48,e.width,e.height,t)}))})):"hqnx"===c?(0,a.default)((function(){return n.e(22).then(n.t.bind(null,946,7))})).then((function(n){(0,n.hqnx)(e,4,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,4,e.width,e.height,s)})),_(e,4),g(r,4,e.width,e.height,t)}))})):"epx"===c?(0,a.default)((function(){return n.e(21).then(n.t.bind(null,947,7))})).then((function(n){(0,n.epx)(e,4,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,4,e.width,e.height,s)})),_(e,4),g(r,4,e.width,e.height,t)}))})):(0,a.default)((function(){return n.e(3).then(n.t.bind(null,724,7))})).then((function(n){n.default(e,6,i.default).then((function(e){var n,r,i=document.createElement("canvas");i.width=e.width,i.height=e.height,(n=i.getContext("2d")).putImageData(e,0,0),r=n.canvas.toDataURL("image/png"),f&&p(e).then((function(e){var t,n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").putImageData(e,0,0),t=n.toDataURL("image/png"),g(t,6,e.width,e.height,s)})),_(e,6),g(r,6,e.width,e.height,t)}))}))},d.src=e}}},829:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==y(Symbol.iterator)?function(e){return void 0===e?"undefined":y(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":y(e)},r(e)}function i(){function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,r){var i=t&&t.prototype instanceof a?t:a,o=Object.create(i.prototype),s=new p(r||[]);return b(o,"_invoke",{value:l(e,n,s)}),o}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function a(){}function o(){}function s(){}function u(t){["next","throw","return"].forEach((function(n){e(t,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function i(a,o,s,u){var c,l,h=n(e[a],e,o);if("throw"!==h.type)return(l=(c=h.arg).value)&&"object"==r(l)&&m.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,s,u)}),(function(e){i("throw",e,s,u)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return i("throw",e,s,u)}));u(h.arg)}var a;b(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){i(e,n,t,r)}))}return a=a?a.then(r,r):r()}})}function l(e,t,r){var i="suspendedStart";return function(a,o){var s,u,c;if("executing"===i)throw Error("Generator is already running");if("completed"===i){if("throw"===a)throw o;return{value:void 0,done:!0}}for(r.method=a,r.arg=o;;){if((s=r.delegate)&&(u=h(s,r))){if(u===O)continue;return u}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);if(i="executing","normal"===(c=n(e,t,r)).type){if(i=r.done?"completed":"suspendedYield",c.arg===O)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i="completed",r.method="throw",r.arg=c.arg)}}}function h(e,t){var r,i,a=t.method,o=e.iterator[a];return void 0===o?(t.delegate=null,"throw"===a&&e.iterator.return&&(t.method="return",t.arg=void 0,h(e,t),"throw"===t.method)||"return"!==a&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+a+"' method")),O):"throw"===(r=n(o,e.iterator,t.arg)).type?(t.method="throw",t.arg=r.arg,t.delegate=null,O):(i=r.arg)?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,O):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,O)}function f(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(f,this),this.reset(!0)}function g(e){var t,n,r;if(e){if(t=e[x])return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return n=-1,(r=function t(){for(;++n<e.length;)if(m.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=r}return{next:_}}function _(){return{value:void 0,done:!0}}var v,y,m,b,w,x,k,P,O,j,S,C,A;i=function(){return v},v={},m=(y=Object.prototype).hasOwnProperty,b=Object.defineProperty||function(e,t,n){e[t]=n.value},w="function"==typeof Symbol?Symbol:{},x=w.iterator||"@@iterator",k=w.asyncIterator||"@@asyncIterator",P=w.toStringTag||"@@toStringTag";try{e({},"")}catch(E){e=function(e,t,n){return e[t]=n}}return v.wrap=t,O={},e(j={},x,(function(){return this})),(C=(S=Object.getPrototypeOf)&&S(S(g([]))))&&C!==y&&m.call(C,x)&&(j=C),A=s.prototype=a.prototype=Object.create(j),o.prototype=s,b(A,"constructor",{value:s,configurable:!0}),b(s,"constructor",{value:o,configurable:!0}),o.displayName=e(s,P,"GeneratorFunction"),v.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},v.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,e(t,P,"GeneratorFunction")),t.prototype=Object.create(A),t},v.awrap=function(e){return{__await:e}},u(c.prototype),e(c.prototype,k,(function(){return this})),v.AsyncIterator=c,v.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new c(t(e,n,r,i),a);return v.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},u(A),e(A,P,"Generator"),e(A,x,(function(){return this})),e(A,"toString",(function(){return"[object Generator]"})),v.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},v.values=g,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return a.type="throw",a.arg=e,n.next=t,r&&(n.method="next",n.arg=void 0),!!r}var n,r,i,a,o,s;if(this.done)throw e;for(n=this,r=this.tryEntries.length-1;r>=0;--r){if(i=this.tryEntries[r],a=i.completion,"root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev)if(o=m.call(i,"catchLoc"),s=m.call(i,"finallyLoc"),o&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}},abrupt:function(e,t){var n,r,i,a;for(n=this.tryEntries.length-1;n>=0;--n)if((r=this.tryEntries[n]).tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){i=r;break}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(a=i?i.completion:{}).type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,O):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),O},finish:function(e){var t,n;for(t=this.tryEntries.length-1;t>=0;--t)if((n=this.tryEntries[t]).finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),O},catch:function(e){var t,n,r,i;for(t=this.tryEntries.length-1;t>=0;--t)if((n=this.tryEntries[t]).tryLoc===e)return"throw"===(r=n.completion).type&&(i=r.arg,d(n)),i;throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:g(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),O}},v}function a(e,t){var n,r,i,a,o,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=f(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),n=0,{s:r=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return i=!0,a=!1,{s:function(){s=s.call(e)},n:function(){var e=s.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==s.return||s.return()}finally{if(a)throw o}}}}function o(e){var t="function"==typeof Map?new Map:void 0;return o=function(e){function n(){return s(e,arguments,l(this).constructor)}if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,e)},o(e)}function s(e,t,n){return s=u()?Reflect.construct.bind():function(e,t,n){var r,i=[null];return i.push.apply(i,t),r=new(Function.bind.apply(e,i)),n&&c(r,n.prototype),r},s.apply(null,arguments)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i,a,o,s,u,c=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=c){o=[],s=!0,u=!1;try{if(i=(c=c.call(e)).next,0===t){if(Object(c)!==c)return;s=!1}else for(;!(s=(n=i.call(c)).done)&&(o.push(n.value),o.length!==t);s=!0);}catch(l){u=!0,r=l}finally{try{if(!s&&null!=c.return&&(a=c.return(),Object(a)!==a))return}finally{if(u)throw r}}return o}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){var n,i,a;for(n=0;n<t.length;n++)(i=t[n]).enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(a=function(e,t){var n,i;if("object"!==r(e)||null===e)return e;if(void 0!==(n=e[Symbol.toPrimitive])){if("object"!==r(i=n.call(e,"string")))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return e+""}(i.key),"symbol"===r(a)?a:a+""),i)}function _(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e){var t=e.length;return e.forEach((function(e,n,r){e.addEdge(r[(n+1)%t])})),e}var y,m,b;Object.defineProperty(t,"__esModule",{value:!0}),y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=function(){function e(e,t,n){return[f(e,t,n),d(e,t,n),f(e,t+1,n),d(e,t,n+1)]}function t(e,t,n,r,i){var a,o=Array(i);for(a=0;a<i;++a)o[a]=e[a+n].slice(t,t+r);return o}function n(){this.vertices=[]}var s,f,d,g,v,y,m,b,w,x=function(){function e(t){var n,r=h(t,3),i=r[0],a=r[1],o=r[2];p(this,e),n=.299*i+.587*a+.114*o,this.y=Math.round(n),this.u=Math.round(.492*(o-n)),this.v=Math.round(.877*(i-n)),this.r=i,this.g=a,this.b=o,this.rgb=[i,a,o]}return _(e,[{key:"dissimilar",value:function(e){return Math.abs(this.r-e.r)+Math.abs(this.g-e.g)+Math.abs(this.b-e.b)>=1}},{key:"toString",value:function(){return"rgb("+this.rgb.join()+")"}}]),e}(),k=function(){function e(t,n){p(this,e),this.x=t,this.y=n,this.edges=[]}return _(e,[{key:"split",value:function(t){return new e((this.x+t.x)/2,(this.y+t.y)/2)}},{key:"adjust",value:function(e,t){return this.x+=e,this.y+=t,this}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"addEdge",value:function(e){-1==this.edges.indexOf(e)&&(this.edges.push(e),e.addEdge(this))}}]),e}(),P=function(e){function t(e){var n;return p(this,t),(n=o.call(this,1))[0]=e,n.circular=!1,n}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(t,e);var n,i,o=(n=t,i=u(),function(){var e,t,a=l(n);return i?(t=l(this).constructor,e=Reflect.construct(a,arguments,t)):e=a.apply(this,arguments),function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});return _(t,[{key:"splitAt",value:function(e){var n,r,i,o,s;if(1!==this.length){if(this[0]===e)this.shift();else if(this[this.length-1]===e)this.pop();else if(this.circular)for(n=this.shift();n!==e;n=this.shift())this.push(n);else{r=this.indexOf(e),o=a(i=this.slice(r+1));try{for(o.s();!(s=o.n()).done;)s.value.curve=i}catch(u){o.e(u)}finally{o.f()}this.length=r}e.curve=new t(e)}}},{key:"merge",value:function(e){var t,n,r,i,a,o;if(this!==e)for(n=(t=h([this,e].sort((function(e,t){return e.length-t.length})),2))[0],-1!==(r=t[1])[0].edges.indexOf(n[0])?(i=this.shift,a=this.unshift):-1!==r[0].edges.indexOf(n[n.length-1])?(i=this.pop,a=this.unshift):-1!==r[r.length-1].edges.indexOf(n[0])?(i=this.shift,a=this.push):-1!==r[r.length-1].edges.indexOf(n[n.length-1])&&(i=this.pop,a=this.push);n.length;)o=i.call(n),a.call(r,o),o.curve=r;else this.circular=e.length>2}}],[{key:"curve",value:function(e,t){return e.curve===t.curve?e.curve.length:0}}]),t}(o(Array)),O=function(){function e(t,n,r,i){p(this,e),this.x=t,this.y=n,this.edges=[,,,,,,,,],this.vertices=i||[],this.color=r,this.marked=!1,this.curve=new P(this)}return _(e,[{key:"relativePosition",value:function(e){var t=e.x,n=e.y-this.y;return(t-this.x+3*n+8)%9}},{key:"invalidCurve",value:function(){return this.valence()>2&&this.curve.length>1}},{key:"updateCurves",value:function(){this.valence()>2&&this.curve.splitAt(this)}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}},{key:"removeEdge",value:function(t){e.removeEdge(this,t)}},{key:"canReach",value:function(e){return e&&!!this.edges[this.relativePosition(e)]}},{key:"valence",value:function(){return this.edges.filter((function(e){return e})).length}},{key:"toString",value:function(){return"("+[this.x,this.y].join()+") => "+this.edges.filter((function(e){return e})).map((function(e){return"("+[e.x,e.y].join()+")"})).join()}},{key:"edge",value:function(e,t){return this.edges[(e+3*t+8)%9]}},{key:"right",value:function(){return this.edges[0]}},{key:"left",value:function(){return this.edges[7]}},{key:"up",value:function(){return this.edges[5]}},{key:"down",value:function(){return this.edges[2]}},{key:"isEdge",value:function(){return this.edges.filter((function(e){return e})).length<4}},{key:"follow",value:i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this;case 1:if(!(n.canReach(t)&&n.valence()<3)){e.next=14;break}return e.next=4,t;case 4:if(!(t.valence()>2)){e.next=6;break}return e.abrupt("break",14);case 6:if(r=t.edges.filter((function(e){return e})),a=r[0]!=n?r[0]:r[1],n=t,(t=a)!=this){e.next=12;break}return e.abrupt("break",14);case 12:e.next=1;break;case 14:case"end":return e.stop()}}),e,this)}))},{key:"square",value:function(){var e=h(this.edges,3),t=e[0],n=e[2],r=t&&n&&t.down()&&n.right();return[this,t,n,r].filter((function(e){return e}))}}],[{key:"addSimilarEdge",value:function(e,t){e.color&&t.color&&!e.color.dissimilar(t.color)&&(e.edges[e.relativePosition(t)]=t,t.edges[t.relativePosition(e)]=e,e.valence()>2&&e.curve.splitAt(e),t.valence()>2&&t.curve.splitAt(t),e.valence()<3&&t.valence()<3&&e.curve.merge(t.curve))}},{key:"removeEdge",value:function(e,t){e.edges[e.relativePosition(t)]=void 0,t.edges[t.relativePosition(e)]=void 0}}]),e}(),j=function(){function e(t,n,r){if(p(this,e),t.length!=n*r*4)throw Error("Wrong dimension of pixel buffer");this.width=n,this.height=r,this.pixels=t}return _(e,[{key:"create",value:i().mark((function e(){var t,n,r,a,o,s,u,c,l,h,f,d,p,g,_;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.width,n=this.height,r=Array(n),(a=Array(n+1))[0]=Array(t+1),o=0;o<t+1;++o)a[0][o]=new k(o,0);s=new O,u=Array(t).fill(s),o=0;case 9:if(!(o<n)){e.next=31;break}c=[s,s],l=r[o]=Array(t),h=a[o],(f=a[o+1]=Array(t+1))[0]=new k(0,o+1),d=0;case 16:if(!(d<t)){e.next=27;break}return f[d+1]=new k(d+1,o+1),p=[h[d],h[d+1],f[d+1],f[d]],g=l[d]=new O(d,o,this.pixel(d,o),p),_=[u[d],g],e.next=23,[c,_];case 23:c=_;case 24:++d,e.next=16;break;case 27:u=l;case 28:++o,e.next=9;break;case 31:this.nodes_old=r,this.vertices=r;case 33:case"end":return e.stop()}}),e,this)}))},{key:"createSimilarityGraph",value:function(){var e,t,n,r,i,o,s,u,c=a(this.create());try{for(c.s();!(e=c.n()).done;)t=h(e.value,2),r=(n=h(t[0],2))[0],i=n[1],s=(o=h(t[1],2))[0],u=o[1],O.addSimilarEdge(s,u),O.addSimilarEdge(i,u),4!==r.square().length&&(O.addSimilarEdge(s,i),O.addSimilarEdge(r,u))}catch(l){c.e(l)}finally{c.f()}return this}},{key:"graph",value:function(){this.height,this.width}},{key:"nodes",value:i().mark((function(){var e,t,n,r,a;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n=this.width,r=this.height,a=this.nodes_old,t=0;case 2:if(!(t<r)){i.next=13;break}e=0;case 4:if(!(e<n)){i.next=10;break}return i.next=7,a[t][e];case 7:++e,i.next=4;break;case 10:++t,i.next=2;break;case 13:case"end":return i.stop()}}),a,this)}))},{key:"diagonals",value:i().mark((function e(){var t,n,r,a,o,s,u,c,l,h,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=this.width,s=this.height,u=this.nodes_old,n=1;case 2:if(!(n<s)){e.next=22;break}r=u[n-1],a=u[n],t=1;case 6:if(!(t<o)){e.next=19;break}if(c=r[t-1],l=r[t],h=a[t-1],f=a[t],!(c.canReach(l)||c.canReach(h)||f.canReach(l)||f.canReach(h))){e.next=13;break}return e.abrupt("continue",16);case 13:if(!c.canReach(f)||!l.canReach(h)){e.next=16;break}return e.next=16,[[c,f],[h,l]];case 16:++t,e.next=6;break;case 19:++n,e.next=2;break;case 22:case"end":return e.stop()}}),e,this)}))},{key:"pixel",value:function(e,t){var n=t*this.width*4+4*e;return new x(this.pixels.subarray(n,n+3))}}]),e}();return j.diagonals=function(e){return e[0][0].canReach(e[0][1])+e[1][0].canReach(e[1][1])},f=(s=function(e,t){var n=e,r=t;return function(e,t,i){return[e[i][t],e[i+r][t+n]]}})(0,1),d=s(1,0),g=s(1,1),v=s(1,-1),j.prototype.getDiagonals=function(e,t){return[g(this.nodes_old,e,t),v(this.nodes_old,e,t+1)]},y=function(e){return e[0].canReach(e[1])},m=function(e){return!e},b=function(e,t,n,r){return function(i){var a,o;for(i=i[0].edges.filter((function(e){return e})),a=[];i.length>0;)o=i.pop(),-1==a.indexOf(o)&&o.x>e&&o.x<t&&o.y>n&&o.y<r&&(a.push(o),i=i.concat(o.edges.filter((function(e){return e}))));return a}},j.prototype.linearize=function(){var t,n,r,i,a,o,s,u,c;for(t=1;t<this.width;++t)for(n=1;n<this.height;++n)e(this.nodes_old,t-1,n-1).map(y).every(m)&&(i=[0,0],a=(r=this.getDiagonals(t-1,n-1)).map(b(t-3,t+2,n-3,n+2)),(s=(o=r.map((function(e){return P.curve(e[0],e[1])})))[0]-o[1])>0?i[0]+=s:i[1]-=s,(u=a[0].length-a[1].length)>0?i[1]+=u:i[0]-=u,(c=r.map((function(e){return 1==e[0].valence()||1==e[1].valence()})))[0]&&!c[1]?i[0]+=5:!c[0]&&c[1]&&(i[1]+=5),i[0]>i[1]?O.removeEdge(r[1][0],r[1][1]):i[0]<i[1]?O.removeEdge(r[0][0],r[0][1]):(O.removeEdge(r[0][0],r[0][1]),O.removeEdge(r[1][0],r[1][1])));return this},w=function(e){var t,n,r,i=e[0][1];i.edge(-1,1)&&(r=(n=(t=i.vertices)[3]).clone(),i.down()||n.adjust(.25,.25),i.left()||r.adjust(-.25,-.25),e[0][0].vertices[2]=r,t.splice(4,0,r),r=(t=e[1][0].vertices).splice(0,1,r).pop(),t.push(r)),i.edge(1,1)&&(r=(n=(t=i.vertices)[2]).clone(),i.down()||n.adjust(-.25,.25),i.right()||r.adjust(.25,-.25),e[0][2].vertices[3]=r,t.splice(2,0,r),r=(t=e[1][2].vertices).splice(0,1,r).pop(),t.push(r))},j.prototype.createVoronoiDiagram=function(){var e,n,r,i=this.width-2,a=this.height-1,o=this.nodes_old;for(e=0;e<a;++e){for((n=t(o,0,e,2,2))[0].unshift(new O),n[1].unshift(new O),w(n),r=0;r<i;++r)w(t(o,r,e,3,2));(n=t(o,r,e,2,2))[0].push(new O),n[1].push(new O),w(n)}return this},j.prototype.contour=function(e){var t,n,r,i,a,o,s,u,c,l,h=e,f=[];if(0===h.valence())return h.vertices.slice();if(h.marked||!h.isEdge()||[[-1,-1],[0,-1],[1,-1]].some((function(e){return null!=this.edge.apply(this,e)}),h))return f;for(n=[],r=1,i=0,h.vertices[0],o=null;;){switch(h.marked=!0,n.push(h),t=void 0,r){case 1:if(t=h.edge(1,-1)){r=7;break}case 2:if(t=h.edge(1,0)){r=0;break}case 3:if(t=h.edge(1,1)){r=1;break}case 4:if(t=h.edge(0,1)){r=2;break}case 5:if(t=h.edge(-1,1)){r=3;break}case 6:if(t=h.edge(-1,0)){r=4;break}case 7:if(t=h.edge(-1,-1)){r=5;break}case 0:r=(t=h.edge(0,-1))?6:1}if(t){for(s=i,u=h.vertices.length,o&&t.equals(o)&&(a=h.vertices[s++%u],f.push(a));;){if(a=h.vertices[s++%u],-1!=(c=t.vertices.indexOf(a))){i=c;break}f.push(a)}if(e.equals(t)&&e.edges.filter((function(e){return e})).every((function(e){return e.marked||!e.isEdge()}))){for(s=i,u=t.vertices.length;s<u;)a=t.vertices[s++],f.push(a);break}o=h,h=t}}for(;0!=n.length;)(l=n.pop().edges.filter((function(e){return e&&!e.marked}))).forEach((function(e){e.marked=!0})),n.push.apply(n,l);return f},n.prototype=Object.create(null,{push:{enumerable:!1,value:function(e){this.vertices.push(e),e.addPath(this)}},splitAt:{enumerable:!1,value:function(e){var t=new n;t.vertices=this.vertices.slice(e),this.vertices.length=e+1,t.vertices.forEach((function(e){e.removePath(this),e.addPath(t)}))}}}),j.prototype.paths=function(e){new n},function(e,t,n){return new j(e,t,n)}}(),b=function(e,t,n){var r,i=m(e.data,e.width,e.height);return i.createSimilarityGraph(),i.createVoronoiDiagram(),i.linearize(),r=function(e,t){var n,r,i,a,o,s,u,c=e.width,l=e.height,h=e.nodes(),f=[],d=!0,p=!1,g=void 0;try{for(n=h[Symbol.iterator]();!(d=(r=n.next()).done);d=!0){for(i=r.value,a="L",s=(o=v(i.vertices))[0],u=0;u<o.length;++u)s=o[u],a+=Math.ceil(s.x*t)+","+Math.ceil(s.y*t)+" ";f.push('<path fill="'+i.color+'" d="M'+Math.ceil(o[0].x*t)+","+Math.ceil(o[0].y*t)+" "+a+'Z"/>')}}catch(_){p=!0,g=_}finally{try{!d&&n.return&&n.return()}finally{if(p)throw g}}return'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+c*t+" "+l*t+'">'+f.join("\n\t")+"</svg>"}(i,t),r},t.default=b},830:function(e,t,n){"use strict";var r=n(831);e.exports={loadJSON:function(e,t){var n=new XMLHttpRequest;try{n=new XMLHttpRequest}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){t("Cannot load data",null)}}}n.open("GET",e,!0),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)try{var e=JSON.parse(n.responseText);t(null,e)}catch(r){t("Cannot understand response from network.",null)}else 4==n.readyState&&404==n.status&&t("Error 404",null)};try{n.send()}catch(r){t("Failed to fetch",null)}},postJSON:function(e,t,n){var i,a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/x-www-form-urlencoded",s=new Headers;s.append("Content-Type",o),i="multipart/form-data"===o?new FormData:new URLSearchParams,Object.entries(t).forEach((function(e){var t=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n,r,i=[],a=!0,o=!1,s=void 0;try{for(n=e[Symbol.iterator]();!(a=(r=n.next()).done)&&(i.push(r.value),2!==i.length);a=!0);}catch(u){o=!0,s=u}finally{try{!a&&n.return&&n.return()}finally{if(o)throw s}}return i}(e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e),n=t[0],r=t[1];i.append(n,r)})),a={method:"POST",redirect:"follow",headers:s,body:"application/text"===o?t:"application/json"===o?(0,r.clean_json_text)(JSON.stringify(t)):i},fetch(e,a).then((function(e){return e.text()})).then((function(e){return n(null,e)})).catch((function(e){return n(e,null)}))},postDATA:function(e,t,n){var r=new XMLHttpRequest;try{r=new XMLHttpRequest}catch(i){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{r=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){return void n("Cannot load data",null)}}}r.open("POST",e,!0),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.onreadystatechange=function(){if(4==r.readyState&&200==r.status)try{var e=JSON.parse(r.responseText);n(null,e)}catch(i){n("Cannot understand response from network.",null)}else 4==r.readyState&&404==r.status&&n("Error 404",null)};try{r.send(t)}catch(i){n("Failed to post",null)}}}},831:function(e,t,n){"use strict";e.exports={clean_json_text:function(e){return(e=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")).replace(/[\u0000-\u0019]+/g,"")}}}}]);