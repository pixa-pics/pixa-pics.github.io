"use strict";

import {bytesToBase64, base64ToBytes} from "./base64";

var return_char_code = `@`.charCodeAt(0);
var tab_char_code = `?`.charCodeAt(0);

var runLengthStringify = function(string) {

    var total_length = string.length;
    var removed_similars = 0;
    var added_groups = 0;
    var added_hex = 0;
    var chars = string.split("");
    var last_char_code = string.charCodeAt(0);
    var current_char_code = -1;
    var similar = 1;

    for(var i = 1; (i|0) < (total_length|0); i = (i+1|0)>>>0){


        current_char_code = string.charCodeAt(i|0) & 0xFF;
        if((last_char_code|0) == (current_char_code|0)) {

            similar = (similar + 1 | 0) >>> 0;
        }else {

            if((similar|0) > 8) {
                removed_similars = removed_similars + similar|0;
                chars.splice(i-removed_similars+added_hex|0, similar, `@${similar.toString(16)}?${String.fromCharCode(last_char_code)}`);
                added_hex = added_hex + (""+similar.toString(16)).length|0;
                added_groups = added_groups + 1 | 0;
            }

            last_char_code = current_char_code & 0xFF;
            similar = 1;
        }
    }

    if((similar|0) > 8) {
        removed_similars = removed_similars + similar|0;
        chars.splice(i-removed_similars+added_hex+added_groups*2|0, similar, `@${similar.toString(16)}?${String.fromCharCode(last_char_code)}`);
        added_hex = added_hex + (""+similar.toString(16)).length|0;
        added_groups = added_groups + 1 | 0;
    }

    return chars.join("");
}
var runLengthParse = function(string) {

    var total_length = string.length;
    var chars_less_charlength = 0;
    var chars = string.split("");
    var current_char_code = -1;
    var has_return = false;
    var has_tab = false;
    var has_pattern = false;
    var post_return_hex = "";
    var post_tab_charcode = 0;
    var removed_groups = 0;
    var removed_hex = 0;
    var added_patterns = 0;

    for(var i = 0; (i|0) < (total_length|0); i = (i+1|0)>>>0){

        current_char_code = string.charCodeAt(i) & 0xFF;

        if(has_pattern) {
            removed_groups += 1;
            removed_hex = post_return_hex.length;
            added_patterns = added_patterns + parseInt(post_return_hex, 16) | 0;
            chars.splice(
                i-(removed_hex+removed_groups*3)|0,
                3+post_return_hex.length,
                String.fromCharCode.apply(null, new Uint8Array(parseInt(post_return_hex, 16)).fill(post_tab_charcode))
            );
            has_pattern = false;
            post_return_hex = "";
        }

        if(has_tab) {
            post_tab_charcode = current_char_code & 0xFF;
            has_tab = false;
            has_pattern = true;
        }else if(has_return) {
            if((tab_char_code|0) == (current_char_code|0)) {
                has_return = false;
                has_tab = true;
            }else {
                post_return_hex = post_return_hex.concat(string.charAt(i|0));
            }

        }else if((return_char_code|0) == (current_char_code|0)) {

            has_return = true;
        }
    }

    return chars.join("");
}

// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>
// This work is free. You can redistribute it and/or modify it
// under the terms of the WTFPL, Version 2
// For more information see LICENSE.txt or http://www.wtfpl.net/
//
// For more information, the home page:
// http://pieroxy.net/blog/pages/lz-string/testing.html
//
// LZ-based compression algorithm, version 1.4.4

var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",t={},i={compressToBase64:function(o){if(null==o)return"";var r=i._compress(o,6,function(o){return n.charAt(o)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}},decompressFromBase64:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},compressToUTF16:function(o){return null==o?"":i._compress(o,15,function(o){return r(o+32)})+" "},decompressFromUTF16:function(o){return null==o?"":""==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(""))},compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return e.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:(r=r.replace(/ /g,"+"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return"";var e,t,i,s={},p={},u="",c="",a="",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(""!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join("")},decompress:function(o){return null==o?"":""==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v="",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return""}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return"";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join("")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);

/*!
Copyright (c) 2014-2018, Rotem Dan <rotemdan@gmail.com>

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
*/

var LZUTF8;(function(a){a.runningInNodeJS=function(){return typeof process==='object'&&typeof process.versions==='object'&&typeof process.versions.node==='string';},a.runningInMainNodeJSModule=function(){return a.runningInNodeJS()&&require.main===module;},a.commonJSAvailable=function(){return typeof module==='object'&&typeof module.exports==='object';},a.runningInWebWorker=function(){return typeof window==='undefined'&&typeof self==='object'&&typeof self.addEventListener==='function'&&typeof self.close==='function';},a.runningInNodeChildProcess=function(){return a.runningInNodeJS()&&typeof process.send==='function';},a.runningInNullOrigin=function(){return typeof window!=='object'||typeof window.location!=='object'||typeof document!=='object'?!1:document.location.protocol!=='http:'&&document.location.protocol!=='https:';},a.webWorkersAvailable=function(){return typeof Worker!=='function'||a.runningInNullOrigin()?!1:a.runningInNodeJS()?!1:navigator&&navigator.userAgent&&navigator.userAgent.indexOf('Android 4.3')>=0?!1:!0;},a.log=function(b,a){if(a===void 0&&(a=!1),typeof console!=='object')return;console.log(b),a&&typeof document=='object'&&(document.body.innerHTML+=b+'<br/>');},a.createErrorMessage=function(c,b){if(b===void 0&&(b='Unhandled exception'),c==null)return b;if(b+=': ',typeof c.content==='object')if(a.runningInNodeJS())return b+c.content.stack;else{var d=JSON.stringify(c.content);return d!=='{}'?b+d:b+c.content;}else return typeof c.content==='string'?b+c.content:b+c;},a.printExceptionAndStackTraceToConsole=function(c,b){b===void 0&&(b='Unhandled exception'),a.log(a.createErrorMessage(c,b));},a.getGlobalObject=function(){return typeof global==='object'?global:typeof window==='object'?window:typeof self==='object'?self:{};},a.toString=Object.prototype.toString,a.commonJSAvailable()&&(module.exports=a);}(LZUTF8||(LZUTF8={})));var IE10SubarrayBugPatcher;(function(e,d,c,a,b){if(typeof Uint8Array==='function'&&new Uint8Array(1).subarray(1).byteLength!==0&&(d=function(a,b){var d=function(a,b,c){return a<b?b:a>c?c:a;};a|=0,b|=0,arguments.length<1&&(a=0),arguments.length<2&&(b=this.length),a<0&&(a=this.length+a),b<0&&(b=this.length+b),a=d(a,0,this.length),b=d(b,0,this.length);var c=b-a;return c<0&&(c=0),new this.constructor(this.buffer,this.byteOffset+a*this.BYTES_PER_ELEMENT,c);},c=['Int8Array','Uint8Array','Uint8ClampedArray','Int16Array','Uint16Array','Int32Array','Uint32Array','Float32Array','Float64Array'],a=void 0,typeof window==='object'?a=window:typeof self==='object'&&(a=self),a!==undefined))for(b=0;b<c.length;b++)a[c[b]]&&(a[c[b]].prototype.subarray=d);}(IE10SubarrayBugPatcher||(IE10SubarrayBugPatcher={})));var LZUTF8;(function(a,b){b=function(){function b(){}return b.compressAsync=function(b,h,d){var e=new a.Timer();var i=new a.Compressor();if(!d)throw new TypeError('compressAsync: No callback argument given');if(typeof b==='string')b=a.encodeUTF8(b);else if(b==null||!(b instanceof Uint8Array)){d(undefined,new TypeError("compressAsync: Invalid input argument, only 'string' and 'Uint8Array' are supported"));return;}var f=a.ArrayTools.splitByteArray(b,h.blockSize);var g=[];var c=function(b){if(b<f.length){var j=void 0;try{j=i.compressBlock(f[b]);}catch(e){callback(undefined,e);return;}g.push(j),e.getElapsedTime()<=20?c(b+1):(a.enqueueImmediate(function(){return c(b+1);}),e.restart());}else{var k=a.ArrayTools.concatUint8Arrays(g);a.enqueueImmediate(function(){var b;try{b=a.CompressionCommon.encodeCompressedBytes(k,h.outputEncoding);}catch(e){callback(undefined,e);return;}a.enqueueImmediate(function(){return d(b);});});}};a.enqueueImmediate(function(){return c(0);});},b.createCompressionStream=function(){var c=new a.Compressor();var d=require('readable-stream');var b=new d.Transform({decodeStrings:!0,highWaterMark:65536});return b._transform=function(e,g,f){var d;try{d=a.BufferTools.uint8ArrayToBuffer(c.compressBlock(a.BufferTools.bufferToUint8Array(e)));}catch(e){compressionStream.emit('error',e);return;}b.push(d),f();},b;},b;}(),a.AsyncCompressor=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(){}return b.decompressAsync=function(c,d,h){if(!h)throw new TypeError('decompressAsync: No callback argument given');var e=new a.Timer();try{c=a.CompressionCommon.decodeCompressedBytes(c,d.inputEncoding);}catch(e){callback(undefined,e);return;}var i=new a.Decompressor();var f=a.ArrayTools.splitByteArray(c,d.blockSize);var g=[];var b=function(c){if(c<f.length){var j=void 0;try{j=i.decompressBlock(f[c]);}catch(e){callback(undefined,e);return;}g.push(j),e.getElapsedTime()<=20?b(c+1):(a.enqueueImmediate(function(){return b(c+1);}),e.restart());}else{var k=a.ArrayTools.concatUint8Arrays(g);a.enqueueImmediate(function(){var b;try{b=a.CompressionCommon.encodeDecompressedBytes(k,d.outputEncoding);}catch(e){callback(undefined,e);return;}a.enqueueImmediate(function(){return h(b);});});}};a.enqueueImmediate(function(){return b(0);});},b.createDecompressionStream=function(){var c=new a.Decompressor();var d=require('readable-stream');var b=new d.Transform({decodeStrings:!0,highWaterMark:65536});return b._transform=function(e,g,f){var d;try{d=a.BufferTools.uint8ArrayToBuffer(c.decompressBlock(a.BufferTools.bufferToUint8Array(e)));}catch(e){decompressionStream.emit('error',e);return;}b.push(d),f();},b;},b;}(),a.AsyncDecompressor=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(b){b.compressAsync=function(f,a,c){if(a.inputEncoding=='ByteArray'&&!(f instanceof Uint8Array)){c(undefined,new TypeError('compressAsync: input is not a Uint8Array'));return;}var d={token:Math.random().toString(),type:'compress',data:f,inputEncoding:a.inputEncoding,outputEncoding:a.outputEncoding};var e=function(f){var a=f.data;if(!a||a.token!=d.token)return;b.globalWorker.removeEventListener('message',e),a.type=='error'?c(undefined,new Error(a.error)):c(a.data);};b.globalWorker.addEventListener('message',e),b.globalWorker.postMessage(d,[]);},b.decompressAsync=function(f,d,e){var a={token:Math.random().toString(),type:'decompress',data:f,inputEncoding:d.inputEncoding,outputEncoding:d.outputEncoding};var c=function(f){var d=f.data;if(!d||d.token!=a.token)return;b.globalWorker.removeEventListener('message',c),d.type=='error'?e(undefined,new Error(d.error)):e(d.data);};b.globalWorker.addEventListener('message',c),b.globalWorker.postMessage(a,[]);},b.installWebWorkerIfNeeded=function(){typeof self=='object'&&self.document===undefined&&self.addEventListener!=undefined&&(self.addEventListener('message',function(f){var b=f.data;if(b.type=='compress'){var d=void 0;try{d=a.compress(b.data,{outputEncoding:b.outputEncoding});}catch(e){self.postMessage({token:request.token,type:'error',error:LZUTF8.createErrorMessage(e)},[]);return;}var c={token:b.token,type:'compressionResult',data:d,encoding:b.outputEncoding};c.data instanceof Uint8Array&&navigator.appVersion.indexOf('MSIE 10')===-1?self.postMessage(c,[c.data.buffer]):self.postMessage(c,[]);}else if(b.type=='decompress'){var e=void 0;try{e=a.decompress(b.data,{inputEncoding:b.inputEncoding,outputEncoding:b.outputEncoding});}catch(e){self.postMessage({token:request.token,type:'error',error:LZUTF8.createErrorMessage(e)},[]);return;}var c={token:b.token,type:'decompressionResult',data:e,encoding:b.outputEncoding};c.data instanceof Uint8Array&&navigator.appVersion.indexOf('MSIE 10')===-1?self.postMessage(c,[c.data.buffer]):self.postMessage(c,[]);}}),self.addEventListener('error',function(b){a.log(a.createErrorMessage(b.error,'Unexpected LZUTF8 WebWorker exception'));}));},b.createGlobalWorkerIfNeeded=function(){if(b.globalWorker)return!0;if(!a.webWorkersAvailable())return!1;if(!b.scriptURI&&typeof document==='object'){var c=document.getElementById('lzutf8');c!=null&&(b.scriptURI=c.getAttribute('src')||undefined);}return b.scriptURI?(b.globalWorker=new Worker(b.scriptURI),!0):!1;},b.terminate=function(){b.globalWorker&&(b.globalWorker.terminate(),b.globalWorker=undefined);};}(b=a.WebWorker||(a.WebWorker={})),b.installWebWorkerIfNeeded());}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(b,a){a=function(){function a(a,b,c){this.container=a,this.startPosition=b,this.length=c;}return a.prototype.get=function(a){return this.container[this.startPosition+a];},a.prototype.getInReversedOrder=function(a){return this.container[this.startPosition+this.length-1-a];},a.prototype.set=function(a,b){this.container[this.startPosition+a]=b;},a;}(),b.ArraySegment=a;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a){a.copyElements=function(a,b,c,d,e){while(e--)c[d++]=a[b++];},a.zeroElements=function(a,b,c){while(c--)a[b++]=0;},a.countNonzeroValuesInArray=function(c){var b=0;for(var a=0;a<c.length;a++)c[a]&&b++;return b;},a.truncateStartingElements=function(a,c){if(a.length<=c)throw new RangeError('truncateStartingElements: Requested length should be smaller than array length');var d=a.length-c;for(var b=0;b<c;b++)a[b]=a[d+b];a.length=c;},a.doubleByteArrayCapacity=function(b){var a=new Uint8Array(b.length*2);return a.set(b),a;},a.concatUint8Arrays=function(i){var d=0;for(var b=0,e=i;b<e.length;b++){var a=e[b];d+=a.length;}var f=new Uint8Array(d);var g=0;for(var c=0,h=i;c<h.length;c++){var a=h[c];f.set(a,g),g+=a.length;}return f;},a.splitByteArray=function(b,e){var c=[];for(var a=0;a<b.length;){var d=Math.min(e,b.length-a);c.push(b.subarray(a,a+d)),a+=d;}return c;};}(b=a.ArrayTools||(a.ArrayTools={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a){a.convertToUint8ArrayIfNeeded=function(b){return typeof Buffer==='function'&&Buffer.isBuffer(b)?a.bufferToUint8Array(b):b;},a.uint8ArrayToBuffer=function(a){if(Buffer.prototype instanceof Uint8Array){var c=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);return Object.setPrototypeOf(c,Buffer.prototype),c;}else{var d=a.length;var e=new Buffer(d);for(var b=0;b<d;b++)e[b]=a[b];return e;}},a.bufferToUint8Array=function(a){if(Buffer.prototype instanceof Uint8Array)return new Uint8Array(a.buffer,a.byteOffset,a.byteLength);else{var c=a.length;var d=new Uint8Array(c);for(var b=0;b<c;b++)d[b]=a[b];return d;}};}(b=a.BufferTools||(a.BufferTools={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(b){b.getCroppedBuffer=function(e,c,d,a){a===void 0&&(a=0);var b=new Uint8Array(d+a);return b.set(e.subarray(c,c+d)),b;},b.getCroppedAndAppendedByteArray=function(c,b,d,e){return a.ArrayTools.concatUint8Arrays([c.subarray(b,b+d),e]);},b.detectCompressionSourceEncoding=function(a){if(a==null)throw new TypeError('detectCompressionSourceEncoding: input is null or undefined');if(typeof a==='string')return'String';else if(a instanceof Uint8Array||typeof Buffer==='function'&&Buffer.isBuffer(a))return'ByteArray';else throw new TypeError("detectCompressionSourceEncoding: input must be of type 'string', 'Uint8Array' or 'Buffer'");},b.encodeCompressedBytes=function(b,c){switch(c){case'ByteArray':return b;case'Buffer':return a.BufferTools.uint8ArrayToBuffer(b);case'Base64':return a.encodeBase64(b);case'BinaryString':return a.encodeBinaryString(b);case'StorageBinaryString':return a.encodeStorageBinaryString(b);default:throw new TypeError('encodeCompressedBytes: invalid output encoding requested');}},b.decodeCompressedBytes=function(b,c){if(c==null)throw new TypeError('decodeCompressedData: Input is null or undefined');switch(c){case'ByteArray':case'Buffer':var d=a.BufferTools.convertToUint8ArrayIfNeeded(b);if(!(d instanceof Uint8Array))throw new TypeError("decodeCompressedData: 'ByteArray' or 'Buffer' input type was specified but input is not a Uint8Array or Buffer");return d;case'Base64':if(typeof b!=='string')throw new TypeError("decodeCompressedData: 'Base64' input type was specified but input is not a string");return a.decodeBase64(b);case'BinaryString':if(typeof b!=='string')throw new TypeError("decodeCompressedData: 'BinaryString' input type was specified but input is not a string");return a.decodeBinaryString(b);case'StorageBinaryString':if(typeof b!=='string')throw new TypeError("decodeCompressedData: 'StorageBinaryString' input type was specified but input is not a string");return a.decodeStorageBinaryString(b);default:throw new TypeError("decodeCompressedData: invalid input encoding requested: '".concat(c,"'"));}},b.encodeDecompressedBytes=function(b,c){switch(c){case'String':return a.decodeUTF8(b);case'ByteArray':return b;case'Buffer':if(typeof Buffer!=='function')throw new TypeError("encodeDecompressedBytes: a 'Buffer' type was specified but is not supported at the current envirnment");return a.BufferTools.uint8ArrayToBuffer(b);default:throw new TypeError('encodeDecompressedBytes: invalid output encoding requested');}};}(b=a.CompressionCommon||(a.CompressionCommon={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(d,b,c){b=[],d.enqueueImmediate=function(a){b.push(a),b.length===1&&c();},d.initializeScheduler=function(){var d=function(){for(var a=0,c=b;a<c.length;a++){var d=c[a];try{d.call(undefined);}catch(exception){LZUTF8.printExceptionAndStackTraceToConsole(exception,'enqueueImmediate exception');}}b.length=0;};if(a.runningInNodeJS())c=function(){return setImmediate(function(){return d();});};else if(typeof window==='object'&&typeof window.addEventListener==='function'&&typeof window.postMessage==='function'){var e='enqueueImmediate-'+Math.random().toString();window.addEventListener('message',function(a){a.data===e&&d();});var f;a.runningInNullOrigin()?f='*':f=window.location.href,c=function(){return window.postMessage(e,f);};}else if(typeof MessageChannel==='function'&&typeof MessagePort==='function'){var g=new MessageChannel();g.port1.onmessage=function(){return d();},c=function(){return g.port2.postMessage(0);};}else c=function(){return setTimeout(function(){return d();},0);};},d.initializeScheduler();}(b=a.EventLoop||(a.EventLoop={})),a.enqueueImmediate=function(a){return b.enqueueImmediate(a);});}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a){a.override=function(b,c){return a.extend(b,c);},a.extend=function(b,a){if(b==null)throw new TypeError('obj is null or undefined');if(typeof b!=='object')throw new TypeError('obj is not an object');if(a==null&&(a={}),typeof a!=='object')throw new TypeError('newProperties is not an object');if(a!=null)for(var c in a)b[c]=a[c];return b;};}(b=a.ObjectTools||(a.ObjectTools={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a){a.getRandomIntegerInRange=function(a,b){return a+Math.floor(Math.random()*(b-a));},a.getRandomUTF16StringOfLength=function(e){var c='';for(var d=0;d<e;d++){var b=void 0;do b=a.getRandomIntegerInRange(0,1114112);while(b>=55296&&b<=57343);c+=a.Encoding.CodePoint.decodeToString(b);}return c;};}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(b,a){a=function(){function a(a){a===void 0&&(a=1024),this.outputBufferCapacity=a,this.outputPosition=0,this.outputString='',this.outputBuffer=new Uint16Array(this.outputBufferCapacity);}return a.prototype.appendCharCode=function(a){this.outputBuffer[this.outputPosition++]=a,this.outputPosition===this.outputBufferCapacity&&this.flushBufferToOutputString();},a.prototype.appendCharCodes=function(b){for(var a=0,c=b.length;a<c;a++)this.appendCharCode(b[a]);},a.prototype.appendString=function(b){for(var a=0,c=b.length;a<c;a++)this.appendCharCode(b.charCodeAt(a));},a.prototype.appendCodePoint=function(a){if(a<=65535)this.appendCharCode(a);else if(a<=1114111)this.appendCharCode(55296+(a-65536>>>10)),this.appendCharCode(56320+(a-65536&1023));else throw new Error('appendCodePoint: A code point of '.concat(a,' cannot be encoded in UTF-16'));},a.prototype.getOutputString=function(){return this.flushBufferToOutputString(),this.outputString;},a.prototype.flushBufferToOutputString=function(){this.outputPosition===this.outputBufferCapacity?this.outputString+=String.fromCharCode.apply(null,this.outputBuffer):this.outputString+=String.fromCharCode.apply(null,this.outputBuffer.subarray(0,this.outputPosition)),this.outputPosition=0;},a;}(),b.StringBuilder=a;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(){this.restart();}return b.prototype.restart=function(){this.startTime=b.getTimestamp();},b.prototype.getElapsedTime=function(){return b.getTimestamp()-this.startTime;},b.prototype.getElapsedTimeAndRestart=function(){var a=this.getElapsedTime();return this.restart(),a;},b.prototype.logAndRestart=function(e,b){b===void 0&&(b=!0);var c=this.getElapsedTime();var d=''.concat(e,': ').concat(c.toFixed(3),'ms');return a.log(d,b),this.restart(),c;},b.getTimestamp=function(){return this.timestampFunc||this.createGlobalTimestampFunction(),this.timestampFunc();},b.getMicrosecondTimestamp=function(){return Math.floor(b.getTimestamp()*1000);},b.createGlobalTimestampFunction=function(){if(typeof process==='object'&&typeof process.hrtime==='function'){var a=0;this.timestampFunc=function(){var b=process.hrtime();var c=b[0]*1000+b[1]/1000000;return a+c;},a=Date.now()-this.timestampFunc();}else if(typeof chrome==='object'&&chrome.Interval){var c=Date.now();var b=new chrome.Interval();b.start(),this.timestampFunc=function(){return c+b.microseconds()/1000;};}else if(typeof performance==='object'&&performance.now){var d=Date.now()-performance.now();this.timestampFunc=function(){return d+performance.now();};}else Date.now?this.timestampFunc=function(){return Date.now();}:this.timestampFunc=function(){return new Date().getTime();};},b;}(),a.Timer=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(b){b===void 0&&(b=!0),this.MinimumSequenceLength=4,this.MaximumSequenceLength=31,this.MaximumMatchDistance=32767,this.PrefixHashTableSize=65537,this.inputBufferStreamOffset=1,b&&typeof Uint32Array=='function'?this.prefixHashTable=new a.CompressorCustomHashTable(this.PrefixHashTableSize):this.prefixHashTable=new a.CompressorSimpleHashTable(this.PrefixHashTableSize);}return b.prototype.compressBlock=function(b){if(b===undefined||b===null)throw new TypeError('compressBlock: undefined or null input received');return typeof b=='string'&&(b=a.encodeUTF8(b)),b=a.BufferTools.convertToUint8ArrayIfNeeded(b),this.compressUtf8Block(b);},b.prototype.compressUtf8Block=function(d){if(!d||d.length==0)return new Uint8Array(0);var i=this.cropAndAddNewBytesToInputBuffer(d);var j=this.inputBuffer;var e=this.inputBuffer.length;this.outputBuffer=new Uint8Array(d.length),this.outputBufferPosition=0;var f=0;for(var a=i;a<e;a++){var g=j[a];var b=a<f;if(a>e-this.MinimumSequenceLength){b||this.outputRawByte(g);continue;}var h=this.getBucketIndexForPrefix(a);if(!b){var c=this.findLongestMatch(a,h);c!=null&&(this.outputPointerBytes(c.length,c.distance),f=a+c.length,b=!0);}b||this.outputRawByte(g);var k=this.inputBufferStreamOffset+a;this.prefixHashTable.addValueToBucket(h,k);}return this.outputBuffer.subarray(0,this.outputBufferPosition);},b.prototype.findLongestMatch=function(e,k){var h=this.prefixHashTable.getArraySegmentForBucketIndex(k,this.reusableArraySegmentObject);if(h==null)return null;var c=this.inputBuffer;var f;var d=0;for(var i=0;i<h.length;i++){var j=h.getInReversedOrder(i)-this.inputBufferStreamOffset;var g=e-j;var a=void 0;if(f===undefined?a=this.MinimumSequenceLength-1:f<128&&g>=128?a=d+(d>>>1):a=d,g>this.MaximumMatchDistance||a>=this.MaximumSequenceLength||e+a>=c.length)break;if(c[j+a]!==c[e+a])continue;for(var b=0;;b++)if(e+b===c.length||c[j+b]!==c[e+b]){b>a&&(f=g,d=b);break;}else if(b===this.MaximumSequenceLength)return{distance:g,length:this.MaximumSequenceLength};}return f!==undefined?{distance:f,length:d}:null;},b.prototype.getBucketIndexForPrefix=function(a){return(this.inputBuffer[a]*7880599+this.inputBuffer[a+1]*39601+this.inputBuffer[a+2]*199+this.inputBuffer[a+3])%this.PrefixHashTableSize;},b.prototype.outputPointerBytes=function(b,a){a<128?(this.outputRawByte(192|b),this.outputRawByte(a)):(this.outputRawByte(224|b),this.outputRawByte(a>>>8),this.outputRawByte(a&255));},b.prototype.outputRawByte=function(a){this.outputBuffer[this.outputBufferPosition++]=a;},b.prototype.cropAndAddNewBytesToInputBuffer=function(d){if(this.inputBuffer===undefined)return this.inputBuffer=d,0;else{var b=Math.min(this.inputBuffer.length,this.MaximumMatchDistance);var c=this.inputBuffer.length-b;return this.inputBuffer=a.CompressionCommon.getCroppedAndAppendedByteArray(this.inputBuffer,c,b,d),this.inputBufferStreamOffset+=c,b;}},b;}(),a.Compressor=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(a){this.minimumBucketCapacity=4,this.maximumBucketCapacity=64,this.bucketLocators=new Uint32Array(a*2),this.storage=new Uint32Array(a*2),this.storageIndex=1;}return b.prototype.addValueToBucket=function(d,f){d<<=1,this.storageIndex>=this.storage.length>>>1&&this.compact();var c=this.bucketLocators[d];var b;if(c===0)c=this.storageIndex,b=1,this.storage[this.storageIndex]=f,this.storageIndex+=this.minimumBucketCapacity;else{b=this.bucketLocators[d+1],b===this.maximumBucketCapacity-1&&(b=this.truncateBucketToNewerElements(c,b,this.maximumBucketCapacity/2));var e=c+b;this.storage[e]===0?(this.storage[e]=f,e===this.storageIndex&&(this.storageIndex+=b)):(a.ArrayTools.copyElements(this.storage,c,this.storage,this.storageIndex,b),c=this.storageIndex,this.storageIndex+=b,this.storage[this.storageIndex++]=f,this.storageIndex+=b),b++;}this.bucketLocators[d]=c,this.bucketLocators[d+1]=b;},b.prototype.truncateBucketToNewerElements=function(c,d,b){var e=c+d-b;return a.ArrayTools.copyElements(this.storage,e,this.storage,c,b),a.ArrayTools.zeroElements(this.storage,c+b,d-b),b;},b.prototype.compact=function(){var c=this.bucketLocators;var f=this.storage;this.bucketLocators=new Uint32Array(this.bucketLocators.length),this.storageIndex=1;for(var b=0;b<c.length;b+=2){var d=c[b+1];if(d===0)continue;this.bucketLocators[b]=this.storageIndex,this.bucketLocators[b+1]=d,this.storageIndex+=Math.max(Math.min(d*2,this.maximumBucketCapacity),this.minimumBucketCapacity);}this.storage=new Uint32Array(this.storageIndex*8);for(var b=0;b<c.length;b+=2){var e=c[b];if(e===0)continue;var g=this.bucketLocators[b];var h=this.bucketLocators[b+1];a.ArrayTools.copyElements(f,e,this.storage,g,h);}},b.prototype.getArraySegmentForBucketIndex=function(b,c){b<<=1;var d=this.bucketLocators[b];return d===0?null:(c===undefined&&(c=new a.ArraySegment(this.storage,d,this.bucketLocators[b+1])),c);},b.prototype.getUsedBucketCount=function(){return Math.floor(a.ArrayTools.countNonzeroValuesInArray(this.bucketLocators)/2);},b.prototype.getTotalElementCount=function(){var b=0;for(var a=0;a<this.bucketLocators.length;a+=2)b+=this.bucketLocators[a+1];return b;},b;}(),a.CompressorCustomHashTable=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(a){this.maximumBucketCapacity=64,this.buckets=new Array(a);}return b.prototype.addValueToBucket=function(c,d){var b=this.buckets[c];b===undefined?this.buckets[c]=[d]:(b.length===this.maximumBucketCapacity-1&&a.ArrayTools.truncateStartingElements(b,this.maximumBucketCapacity/2),b.push(d));},b.prototype.getArraySegmentForBucketIndex=function(d,c){var b=this.buckets[d];return b===undefined?null:(c===undefined&&(c=new a.ArraySegment(b,0,b.length)),c);},b.prototype.getUsedBucketCount=function(){return a.ArrayTools.countNonzeroValuesInArray(this.buckets);},b.prototype.getTotalElementCount=function(){var b=0;for(var a=0;a<this.buckets.length;a++)this.buckets[a]!==undefined&&(b+=this.buckets[a].length);return b;},b;}(),a.CompressorSimpleHashTable=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){b=function(){function b(){this.MaximumMatchDistance=32767,this.outputPosition=0;}return b.prototype.decompressBlockToString=function(b){return b=a.BufferTools.convertToUint8ArrayIfNeeded(b),a.decodeUTF8(this.decompressBlock(b));},b.prototype.decompressBlock=function(c){this.inputBufferRemainder&&(c=a.ArrayTools.concatUint8Arrays([this.inputBufferRemainder,c]),this.inputBufferRemainder=undefined);var h=this.cropOutputBufferToWindowAndInitialize(Math.max(c.length*4,1024));for(var b=0,e=c.length;b<e;b++){var d=c[b];if(d>>>6!=3){this.outputByte(d);continue;}var i=d>>>5;if(b==e-1||b==e-2&&i==7){this.inputBufferRemainder=c.subarray(b);break;}if(c[b+1]>>>7===1)this.outputByte(d);else{var j=d&31;var f=void 0;i==6?(f=c[b+1],b+=1):(f=c[b+1]<<8|c[b+2],b+=2);var k=this.outputPosition-f;for(var g=0;g<j;g++)this.outputByte(this.outputBuffer[k+g]);}}return this.rollBackIfOutputBufferEndsWithATruncatedMultibyteSequence(),a.CompressionCommon.getCroppedBuffer(this.outputBuffer,h,this.outputPosition-h);},b.prototype.outputByte=function(b){this.outputPosition===this.outputBuffer.length&&(this.outputBuffer=a.ArrayTools.doubleByteArrayCapacity(this.outputBuffer)),this.outputBuffer[this.outputPosition++]=b;},b.prototype.cropOutputBufferToWindowAndInitialize=function(d){if(!this.outputBuffer)return this.outputBuffer=new Uint8Array(d),0;var b=Math.min(this.outputPosition,this.MaximumMatchDistance);if(this.outputBuffer=a.CompressionCommon.getCroppedBuffer(this.outputBuffer,this.outputPosition-b,b,d),this.outputPosition=b,this.outputBufferRemainder){for(var c=0;c<this.outputBufferRemainder.length;c++)this.outputByte(this.outputBufferRemainder[c]);this.outputBufferRemainder=undefined;}return b;},b.prototype.rollBackIfOutputBufferEndsWithATruncatedMultibyteSequence=function(){for(var a=1;a<=4&&this.outputPosition-a>=0;a++){var b=this.outputBuffer[this.outputPosition-a];if(a<4&&b>>>3===30||a<3&&b>>>4===14||a<2&&b>>>5===6){this.outputBufferRemainder=this.outputBuffer.subarray(this.outputPosition-a,this.outputPosition),this.outputPosition-=a;return;}}},b;}(),a.Decompressor=b;}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(b,c){(function(b,f,d,e,c){f=new Uint8Array([65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47]),d=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,255,255,255,255]),e='=',c=61,b.encode=function(c){return!c||c.length==0?'':a.runningInNodeJS()?a.BufferTools.uint8ArrayToBuffer(c).toString('base64'):b.encodeWithJS(c);},b.decode=function(c){return c?a.runningInNodeJS()?a.BufferTools.bufferToUint8Array(Buffer.from(c,'base64')):b.decodeWithJS(c):new Uint8Array(0);},b.encodeWithJS=function(h,j){if(j===void 0&&(j=!0),!h||h.length==0)return'';var g=f;var b=new a.StringBuilder();var d;for(var e=0,i=h.length;e<i;e+=3)e<=i-3?(d=h[e]<<16|h[e+1]<<8|h[e+2],b.appendCharCode(g[d>>>18&63]),b.appendCharCode(g[d>>>12&63]),b.appendCharCode(g[d>>>6&63]),b.appendCharCode(g[d&63]),d=0):e===i-2?(d=h[e]<<16|h[e+1]<<8,b.appendCharCode(g[d>>>18&63]),b.appendCharCode(g[d>>>12&63]),b.appendCharCode(g[d>>>6&63]),j&&b.appendCharCode(c)):e===i-1&&(d=h[e]<<16,b.appendCharCode(g[d>>>18&63]),b.appendCharCode(g[d>>>12&63]),j&&(b.appendCharCode(c),b.appendCharCode(c)));return b.getOutputString();},b.decodeWithJS=function(a,g){if(!a||a.length==0)return new Uint8Array(0);var h=a.length%4;if(h===1)throw new Error('Invalid Base64 string: length % 4 == 1');h===2?a+=e+e:h===3&&(a+=e),g||(g=new Uint8Array(a.length));var b=0;var i=a.length;for(var f=0;f<i;f+=4){var j=d[a.charCodeAt(f)]<<18|d[a.charCodeAt(f+1)]<<12|d[a.charCodeAt(f+2)]<<6|d[a.charCodeAt(f+3)];g[b++]=j>>>16&255,g[b++]=j>>>8&255,g[b++]=j&255;}return a.charCodeAt(i-1)==c&&b--,a.charCodeAt(i-2)==c&&b--,g.subarray(0,b);};}(c=b.Base64||(b.Base64={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(b,c){(function(b){b.encode=function(d){if(d==null)throw new TypeError('BinaryString.encode: undefined or null input received');if(d.length===0)return'';var g=d.length;var e=new a.StringBuilder();var f=0;var b=1;for(var c=0;c<g;c+=2){var h=void 0;c==g-1?h=d[c]<<8:h=d[c]<<8|d[c+1],e.appendCharCode(f<<16-b|h>>>b),f=h&(1<<b)-1,b===15?(e.appendCharCode(f),f=0,b=1):b+=1,c>=g-2&&e.appendCharCode(f<<16-b);}return e.appendCharCode(32768|g%2),e.getOutputString();},b.decode=function(c){if(typeof c!=='string')throw new TypeError('BinaryString.decode: invalid input type');if(c=='')return new Uint8Array(0);var e=new Uint8Array(c.length*3);var d=0;var h=function(a){e[d++]=a>>>8,e[d++]=a&255;};var f=0;var a=0;for(var g=0;g<c.length;g++){var b=c.charCodeAt(g);if(b>=32768){b==32769&&d--,a=0;continue;}a==0?f=b:(h(f<<a|b>>>15-a),f=b&(1<<15-a)-1),a==15?a=0:a+=1;}return e.subarray(0,d);};}(c=b.BinaryString||(b.BinaryString={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a,b){(function(a){a.encodeFromString=function(c,d){var a=c.charCodeAt(d);if(a<55296||a>56319)return a;else{var b=c.charCodeAt(d+1);if(b>=56320&&b<=57343)return 65536+((a-55296<<10)+(b-56320));else throw new Error('getUnicodeCodePoint: Received a lead surrogate character, char code '.concat(a,', followed by ').concat(b,', which is not a trailing surrogate character code.'));}},a.decodeToString=function(a){if(a<=65535)return String.fromCharCode(a);else if(a<=1114111)return String.fromCharCode(55296+(a-65536>>>10),56320+(a-65536&1023));else throw new Error('getStringFromUnicodeCodePoint: A code point of '.concat(a,' cannot be encoded in UTF-16'));};}(b=a.CodePoint||(a.CodePoint={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a,b){(function(b,a){a=['000','001','002','003','004','005','006','007','008','009','010','011','012','013','014','015','016','017','018','019','020','021','022','023','024','025','026','027','028','029','030','031','032','033','034','035','036','037','038','039','040','041','042','043','044','045','046','047','048','049','050','051','052','053','054','055','056','057','058','059','060','061','062','063','064','065','066','067','068','069','070','071','072','073','074','075','076','077','078','079','080','081','082','083','084','085','086','087','088','089','090','091','092','093','094','095','096','097','098','099','100','101','102','103','104','105','106','107','108','109','110','111','112','113','114','115','116','117','118','119','120','121','122','123','124','125','126','127','128','129','130','131','132','133','134','135','136','137','138','139','140','141','142','143','144','145','146','147','148','149','150','151','152','153','154','155','156','157','158','159','160','161','162','163','164','165','166','167','168','169','170','171','172','173','174','175','176','177','178','179','180','181','182','183','184','185','186','187','188','189','190','191','192','193','194','195','196','197','198','199','200','201','202','203','204','205','206','207','208','209','210','211','212','213','214','215','216','217','218','219','220','221','222','223','224','225','226','227','228','229','230','231','232','233','234','235','236','237','238','239','240','241','242','243','244','245','246','247','248','249','250','251','252','253','254','255'],b.encode=function(d){var c=[];for(var b=0;b<d.length;b++)c.push(a[d[b]]);return c.join(' ');};}(b=a.DecimalString||(a.DecimalString={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(a,b){(function(b){b.encode=function(b){return a.BinaryString.encode(b).replace(/\0/g,'è€‚');},b.decode=function(b){return a.BinaryString.decode(b.replace(/\u8002/g,'\0'));};}(b=a.StorageBinaryString||(a.StorageBinaryString={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a,b){(function(b,c){(function(c,d,e){c.encode=function(b){return!b||b.length==0?new Uint8Array(0):a.runningInNodeJS()?a.BufferTools.bufferToUint8Array(Buffer.from(b,'utf8')):c.createNativeTextEncoderAndDecoderIfAvailable()?d.encode(b):c.encodeWithJS(b);},c.decode=function(b){return!b||b.length==0?'':a.runningInNodeJS()?a.BufferTools.uint8ArrayToBuffer(b).toString('utf8'):c.createNativeTextEncoderAndDecoderIfAvailable()?e.decode(b):c.decodeWithJS(b);},c.encodeWithJS=function(e,c){if(!e||e.length==0)return new Uint8Array(0);c||(c=new Uint8Array(e.length*4));var d=0;for(var f=0;f<e.length;f++){var a=b.CodePoint.encodeFromString(e,f);if(a<=127)c[d++]=a;else if(a<=2047)c[d++]=192|a>>>6,c[d++]=128|a&63;else if(a<=65535)c[d++]=224|a>>>12,c[d++]=128|a>>>6&63,c[d++]=128|a&63;else if(a<=1114111)c[d++]=240|a>>>18,c[d++]=128|a>>>12&63,c[d++]=128|a>>>6&63,c[d++]=128|a&63,f++;else throw new Error('Invalid UTF-16 string: Encountered a character unsupported by UTF-8/16 (RFC 3629)');}return c.subarray(0,d);},c.decodeWithJS=function(c,g,e){if(g===void 0&&(g=0),!c||c.length==0)return'';e===undefined&&(e=c.length);var h=new a.StringBuilder();var f;var d;for(var b=g,i=e;b<i;){if(d=c[b],d>>>7===0)f=d,b+=1;else if(d>>>5===6){if(b+1>=e)throw new Error('Invalid UTF-8 stream: Truncated codepoint sequence encountered at position '+b);f=(d&31)<<6|c[b+1]&63,b+=2;}else if(d>>>4===14){if(b+2>=e)throw new Error('Invalid UTF-8 stream: Truncated codepoint sequence encountered at position '+b);f=(d&15)<<12|(c[b+1]&63)<<6|c[b+2]&63,b+=3;}else if(d>>>3===30){if(b+3>=e)throw new Error('Invalid UTF-8 stream: Truncated codepoint sequence encountered at position '+b);f=(d&7)<<18|(c[b+1]&63)<<12|(c[b+2]&63)<<6|c[b+3]&63,b+=4;}else throw new Error('Invalid UTF-8 stream: An invalid lead byte value encountered at position '+b);h.appendCodePoint(f);}return h.getOutputString();},c.createNativeTextEncoderAndDecoderIfAvailable=function(){return d?!0:typeof TextEncoder=='function'?(d=new TextEncoder('utf-8'),e=new TextDecoder('utf-8'),!0):!1;};}(c=b.UTF8||(b.UTF8={})));}(b=a.Encoding||(a.Encoding={})));}(LZUTF8||(LZUTF8={})));var LZUTF8;(function(a){function b(c,b){if(b===void 0&&(b={}),c==null)throw new TypeError('compress: undefined or null input received');var d=a.CompressionCommon.detectCompressionSourceEncoding(c);b=a.ObjectTools.override({inputEncoding:d,outputEncoding:'ByteArray'},b);var e=new a.Compressor();var f=e.compressBlock(c);return a.CompressionCommon.encodeCompressedBytes(f,b.outputEncoding);}function c(c,b){if(b===void 0&&(b={}),c==null)throw new TypeError('decompress: undefined or null input received');b=a.ObjectTools.override({inputEncoding:'ByteArray',outputEncoding:'String'},b);var d=a.CompressionCommon.decodeCompressedBytes(c,b.inputEncoding);var e=new a.Decompressor();var f=e.decompressBlock(d);return a.CompressionCommon.encodeDecompressedBytes(f,b.outputEncoding);}function d(d,b,c){c==null&&(c=function(){});var e;try{e=a.CompressionCommon.detectCompressionSourceEncoding(d);}catch(e){callback(undefined,e);return;}b=a.ObjectTools.override({inputEncoding:e,outputEncoding:'ByteArray',useWebWorker:!0,blockSize:65536},b),a.enqueueImmediate(function(){b.useWebWorker&&a.WebWorker.createGlobalWorkerIfNeeded()?a.WebWorker.compressAsync(d,b,c):a.AsyncCompressor.compressAsync(d,b,c);});}function e(d,b,c){if(c==null&&(c=function(){}),d==null){c(undefined,new TypeError('decompressAsync: undefined or null input received'));return;}b=a.ObjectTools.override({inputEncoding:'ByteArray',outputEncoding:'String',useWebWorker:!0,blockSize:65536},b);var e=a.BufferTools.convertToUint8ArrayIfNeeded(d);a.EventLoop.enqueueImmediate(function(){b.useWebWorker&&a.WebWorker.createGlobalWorkerIfNeeded()?a.WebWorker.decompressAsync(e,b,c):a.AsyncDecompressor.decompressAsync(d,b,c);});}function f(){return a.AsyncCompressor.createCompressionStream();}function g(){return a.AsyncDecompressor.createDecompressionStream();}function h(b){return a.Encoding.UTF8.encode(b);}function i(b){return a.Encoding.UTF8.decode(b);}function j(b){return a.Encoding.Base64.encode(b);}function k(b){return a.Encoding.Base64.decode(b);}function l(b){return a.Encoding.BinaryString.encode(b);}function m(b){return a.Encoding.BinaryString.decode(b);}function n(b){return a.Encoding.StorageBinaryString.encode(b);}function o(b){return a.Encoding.StorageBinaryString.decode(b);}a.compress=b,a.decompress=c,a.compressAsync=d,a.decompressAsync=e,a.createCompressionStream=f,a.createDecompressionStream=g,a.encodeUTF8=h,a.decodeUTF8=i,a.encodeBase64=j,a.decodeBase64=k,a.encodeBinaryString=l,a.decodeBinaryString=m,a.encodeStorageBinaryString=n,a.decodeStorageBinaryString=o;}(LZUTF8||(LZUTF8={})));

function fu(uint8a_or_string, mode) {
    "use strict";
    if(mode.startsWith("COMPRESS")) {
        //  JS -> json_str -> ui8a -> compressed ui8a
        return LZUTF8.compress(LZString.compressToBase64(uint8a_or_string), {inputEncoding: "Base64", outputEncoding: "Base64"});

    }else if(mode.startsWith("DECOMPRESS")) {
        // ui8a decompressed -> ui8a -> json_str -> JS
        return LZString.decompressFromBase64(LZUTF8.decompress(uint8a_or_string, {inputEncoding: "Base64"}));

    }else {

        return null;
    }
}

var AFunction = Object.getPrototypeOf( function(){}).constructor;
module.exports = function (text, log, only_text){
    "use strict";
    log = log || false;
    only_text = only_text || false;
    if(log) {
        console.log(fu(text, "DECOMPRESS"));
        return null;
    }else {

        if(only_text){
            return fu(text, "DECOMPRESS");
        }else {

            return new AFunction(fu(text, "DECOMPRESS"))();
        }
    }
};