(window.webpackJsonp=window.webpackJsonp||[]).push([["main~c1dd23ef"],{170:function(e,t,n){"use strict";var c=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return}}()?Object.assign:function(e,t){for(var n,r=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),o=1;o<arguments.length;o++){for(var i in n=Object(arguments[o]))u.call(n,i)&&(r[i]=n[i]);if(c)for(var s=c(n),a=0;a<s.length;a++)f.call(n,s[a])&&(r[s[a]]=n[s[a]])}return r}},307:function(e,W,t){"use strict";!function(e){var n="undefined"!=typeof window&&"undefined"!=typeof document&&"undefined"!=typeof navigator,r=function(){for(var e=["Edge","Trident","Firefox"],t=0;t<e.length;t+=1)if(n&&0<=navigator.userAgent.indexOf(e[t]))return 1;return 0}(),o=n&&window.Promise?function(e){var t=!1;return function(){t||(t=!0,window.Promise.resolve().then(function(){t=!1,e()}))}}:function(e){var t=!1;return function(){t||(t=!0,setTimeout(function(){t=!1,e()},r))}};function i(e){return e&&"[object Function]"==={}.toString.call(e)}function l(e,t){if(1!==e.nodeType)return[];e=e.ownerDocument.defaultView.getComputedStyle(e,null);return t?e[t]:e}function u(e){return"HTML"===e.nodeName?e:e.parentNode||e.host}function f(e){if(!e)return document.body;switch(e.nodeName){case"HTML":case"BODY":return e.ownerDocument.body;case"#document":return e.body}var t=l(e);return/(auto|scroll|overlay)/.test(t.overflow+t.overflowY+t.overflowX)?e:f(u(e))}function d(e){return e&&e.referenceNode?e.referenceNode:e}var t=n&&!(!window.MSInputMethodContext||!document.documentMode),s=n&&/MSIE 10/.test(navigator.userAgent);function p(e){return 11===e?t:10!==e&&t||s}function g(e){if(!e)return document.documentElement;for(var t=p(10)?document.body:null,n=e.offsetParent||null;n===t&&e.nextElementSibling;)n=(e=e.nextElementSibling).offsetParent;var r=n&&n.nodeName;return r&&"BODY"!==r&&"HTML"!==r?-1!==["TH","TD","TABLE"].indexOf(n.nodeName)&&"static"===l(n,"position")?g(n):n:(e?e.ownerDocument:document).documentElement}function a(e){return null!==e.parentNode?a(e.parentNode):e}function h(e,t){if(!(e&&e.nodeType&&t&&t.nodeType))return document.documentElement;var n=e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING,r=n?e:t,o=n?t:e,n=document.createRange();n.setStart(r,0),n.setEnd(o,0);n=n.commonAncestorContainer;if(e!==n&&t!==n||r.contains(o))return"BODY"===(o=(r=n).nodeName)||"HTML"!==o&&g(r.firstElementChild)!==r?g(n):n;n=a(e);return n.host?h(n.host,t):h(e,a(t).host)}function v(e,t){var n=e.nodeName;return("BODY"!==n&&"HTML"!==n?e:e.ownerDocument.scrollingElement||e.ownerDocument.documentElement)["top"===(1<arguments.length&&void 0!==t?t:"top")?"scrollTop":"scrollLeft"]}function c(e,t){var n="x"===t?"Left":"Top",t="Left"==n?"Right":"Bottom";return parseFloat(e["border"+n+"Width"])+parseFloat(e["border"+t+"Width"])}function m(e,t,n,r){return Math.max(t["offset"+e],t["scroll"+e],n["client"+e],n["offset"+e],n["scroll"+e],p(10)?parseInt(n["offset"+e])+parseInt(r["margin"+("Height"===e?"Top":"Left")])+parseInt(r["margin"+("Height"===e?"Bottom":"Right")]):0)}function y(e){var t=e.body,n=e.documentElement,e=p(10)&&getComputedStyle(n);return{height:m("Height",t,n,e),width:m("Width",t,n,e)}}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function k(e){return w({},e,{right:e.left+e.width,bottom:e.top+e.height})}function O(e){var t={};try{p(10)?(t=e.getBoundingClientRect(),n=v(e,"top"),r=v(e,"left"),t.top+=n,t.left+=r,t.bottom+=n,t.right+=r):t=e.getBoundingClientRect()}catch(e){}var n={left:t.left,top:t.top,width:t.right-t.left,height:t.bottom-t.top},r="HTML"===e.nodeName?y(e.ownerDocument):{},t=e.offsetWidth-(r.width||e.clientWidth||n.width),r=e.offsetHeight-(r.height||e.clientHeight||n.height);return(t||r)&&(t-=c(e=l(e),"x"),r-=c(e,"y"),n.width-=t,n.height-=r),k(n)}function j(e,t,n){var r=2<arguments.length&&void 0!==n&&n,o=p(10),i="HTML"===t.nodeName,s=O(e),a=O(t),c=f(e),u=l(t),n=parseFloat(u.borderTopWidth),e=parseFloat(u.borderLeftWidth);r&&i&&(a.top=Math.max(a.top,0),a.left=Math.max(a.left,0));s=k({top:s.top-a.top-n,left:s.left-a.left-e,width:s.width,height:s.height});return s.marginTop=0,s.marginLeft=0,!o&&i&&(i=parseFloat(u.marginTop),u=parseFloat(u.marginLeft),s.top-=n-i,s.bottom-=n-i,s.left-=e-u,s.right-=e-u,s.marginTop=i,s.marginLeft=u),(o&&!r?t.contains(c):t===c&&"BODY"!==c.nodeName)?function(e,t){var n=2<arguments.length&&!1,r=v(t,"top"),t=v(t,"left"),n=n?-1:1;return e.top+=r*n,e.bottom+=r*n,e.left+=t*n,e.right+=t*n,e}(s,t):s}function E(e){if(!e||!e.parentElement||p())return document.documentElement;for(var t=e.parentElement;t&&"none"===l(t,"transform");)t=t.parentElement;return t||document.documentElement}function x(e,t,n,r,o){var i=4<arguments.length&&void 0!==o&&o,s={top:0,left:0},a=i?E(e):h(e,d(t));"viewport"===r?s=function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=e.ownerDocument.documentElement,o=j(e,r),i=Math.max(r.clientWidth,window.innerWidth||0),t=Math.max(r.clientHeight,window.innerHeight||0),e=n?0:v(r),r=n?0:v(r,"left");return k({top:e-o.top+o.marginTop,left:r-o.left+o.marginLeft,width:i,height:t})}(a,i):(o=void 0,"scrollParent"===r?"BODY"===(o=f(u(t))).nodeName&&(o=e.ownerDocument.documentElement):o="window"===r?e.ownerDocument.documentElement:r,c=j(o,a,i),"HTML"!==o.nodeName||function e(t){var n=t.nodeName;if("BODY"===n||"HTML"===n)return!1;if("fixed"===l(t,"position"))return!0;t=u(t);return!!t&&e(t)}(a)?s=c:(e=(a=y(e.ownerDocument)).height,a=a.width,s.top+=c.top-c.marginTop,s.bottom=e+c.top,s.left+=c.left-c.marginLeft,s.right=a+c.left));var c="number"==typeof(n=n||0);return s.left+=c?n:n.left||0,s.top+=c?n:n.top||0,s.right-=c?n:n.right||0,s.bottom-=c?n:n.bottom||0,s}function q(e,t,n,r,o,i){i=5<arguments.length&&void 0!==i?i:0;if(-1===e.indexOf("auto"))return e;var o=x(n,r,i,o),s={top:{width:o.width,height:t.top-o.top},right:{width:o.right-t.right,height:o.height},bottom:{width:o.width,height:o.bottom-t.bottom},left:{width:t.left-o.left,height:o.height}},t=Object.keys(s).map(function(e){return w({key:e},s[e],{area:(e=s[e]).width*e.height})}).sort(function(e,t){return t.area-e.area}),o=t.filter(function(e){return n.clientWidth<=e.width&&n.clientHeight<=e.height}),t=(0<o.length?o:t)[0].key,e=e.split("-")[1];return t+(e?"-"+e:"")}function S(e,t,n,r){r=3<arguments.length&&void 0!==r?r:null;return j(n,r?E(t):h(t,d(n)),r)}function A(e){var t=e.ownerDocument.defaultView.getComputedStyle(e),n=parseFloat(t.marginTop||0)+parseFloat(t.marginBottom||0),t=parseFloat(t.marginLeft||0)+parseFloat(t.marginRight||0);return{width:e.offsetWidth+t,height:e.offsetHeight+n}}function P(e){var t={left:"right",right:"left",bottom:"top",top:"bottom"};return e.replace(/left|right|bottom|top/g,function(e){return t[e]})}function D(e,t,n){n=n.split("-")[0];var r=A(e),o={width:r.width,height:r.height},i=-1!==["right","left"].indexOf(n),s=i?"top":"left",a=i?"left":"top",e=i?"height":"width",i=i?"width":"height";return o[s]=t[s]+t[e]/2-r[e]/2,o[a]=n===a?t[a]-r[i]:t[P(a)],o}function C(e,t){return Array.prototype.find?e.find(t):e.filter(t)[0]}function L(e,n,t){return(void 0===t?e:e.slice(0,function(e,t){if(Array.prototype.findIndex)return e.findIndex(function(e){return e.name===t});var n=C(e,function(e){return e.name===t});return e.indexOf(n)}(e,t))).forEach(function(e){var t=e.function||e.fn;e.enabled&&i(t)&&(n.offsets.popper=k(n.offsets.popper),n.offsets.reference=k(n.offsets.reference),n=t(n,e))}),n}function $(e,t){return e.some(function(e){return e.enabled&&e.name===t})}function I(e){for(var t=[!1,"ms","Webkit","Moz","O"],n=e.charAt(0).toUpperCase()+e.slice(1),r=0;r<t.length;r++){var o=t[r],o=o?""+o+n:e;if(void 0!==document.body.style[o])return o}return null}function T(e){e=e.ownerDocument;return e?e.defaultView:window}function B(e){return""!==e&&!isNaN(parseFloat(e))&&isFinite(e)}function N(n,r){Object.keys(r).forEach(function(e){var t="";-1!==["width","height","top","right","bottom","left"].indexOf(e)&&B(r[e])&&(t="px"),n.style[e]=r[e]+t})}var R=n&&/Firefox/i.test(navigator.userAgent);function M(e,t,n){var r=C(e,function(e){return e.name===t});return!!r&&e.some(function(e){return e.name===n&&e.enabled&&e.order<r.order})}var F=["auto-start","auto","auto-end","top-start","top","top-end","right-start","right","right-end","bottom-end","bottom","bottom-start","left-end","left","left-start"],K=F.slice(3);function J(e,t){t=1<arguments.length&&void 0!==t&&t,e=K.indexOf(e),e=K.slice(e+1).concat(K.slice(0,e));return t?e.reverse():e}var z={placement:"bottom",positionFixed:!1,eventsEnabled:!0,removeOnDestroy:!1,onCreate:function(){},onUpdate:function(){},modifiers:{shift:{order:100,enabled:!0,fn:function(e){var t,n,r=e.placement,o=r.split("-")[0],i=r.split("-")[1];return i&&(t=(n=e.offsets).reference,r=n.popper,o=(n=-1!==["bottom","top"].indexOf(o))?"width":"height",o={start:b({},n=n?"left":"top",t[n]),end:b({},n,t[n]+t[o]-r[o])},e.offsets.popper=w({},r,o[i])),e}},offset:{order:200,enabled:!0,fn:function(e,t){var n=t.offset,r=e.placement,o=e.offsets,t=o.popper,o=o.reference,i=r.split("-")[0],o=B(+n)?[+n,0]:function(e,a,c){var o=[0,0],r=-1!==["right","left"].indexOf(i),t=e.split(/(\+|\-)/).map(function(e){return e.trim()}),n=t.indexOf(C(t,function(e){return-1!==e.search(/,|\s/)}));t[n]&&t[n].indexOf(",");e=/\s*,\s*|\s+/;return(-1!==n?[t.slice(0,n).concat([t[n].split(e)[0]]),[t[n].split(e)[1]].concat(t.slice(n+1))]:[t]).map(function(e,t){var s=(1===t?!r:r)?"height":"width",n=!1;return e.reduce(function(e,t){return""===e[e.length-1]&&-1!==["+","-"].indexOf(t)?(e[e.length-1]=t,n=!0,e):n?(e[e.length-1]+=t,n=!1,e):e.concat(t)},[]).map(function(e){return n=s,r=a,o=c,e=(i=(t=e).match(/((?:\-|\+)?\d*\.?\d*)(.*)/))[2],(i=+i[1])?0===e.indexOf("%")?k("%p"===e?r:o)[n]/100*i:"vh"!==e&&"vw"!==e?i:("vh"===e?Math.max(document.documentElement.clientHeight,window.innerHeight||0):Math.max(document.documentElement.clientWidth,window.innerWidth||0))/100*i:t;var t,n,r,o,i})}).forEach(function(n,r){n.forEach(function(e,t){B(e)&&(o[r]+=e*("-"===n[t-1]?-1:1))})}),o}(n,t,o);return"left"===i?(t.top+=o[0],t.left-=o[1]):"right"===i?(t.top+=o[0],t.left+=o[1]):"top"===i?(t.left+=o[0],t.top-=o[1]):"bottom"===i&&(t.left+=o[0],t.top+=o[1]),e.popper=t,e},offset:0},preventOverflow:{order:300,enabled:!0,fn:function(e,r){var t=r.boundariesElement||g(e.instance.popper);e.instance.reference===t&&(t=g(t));var n=I("transform"),o=e.instance.popper.style,i=o.top,s=o.left,a=o[n];o.top="",o.left="",o[n]="";var c=x(e.instance.popper,e.instance.reference,r.padding,t,e.positionFixed);o.top=i,o.left=s,o[n]=a,r.boundaries=c;var a=r.priority,u=e.offsets.popper,f={primary:function(e){var t=u[e];return b({},e,t=u[e]<c[e]&&!r.escapeWithReference?Math.max(u[e],c[e]):t)},secondary:function(e){var t="right"===e?"left":"top",n=u[t];return b({},t,n=c[e]<u[e]&&!r.escapeWithReference?Math.min(u[t],c[e]-("right"===e?u.width:u.height)):n)}};return a.forEach(function(e){var t=-1!==["left","top"].indexOf(e)?"primary":"secondary";u=w({},u,f[t](e))}),e.offsets.popper=u,e},priority:["left","right","top","bottom"],padding:5,boundariesElement:"scrollParent"},keepTogether:{order:400,enabled:!0,fn:function(e){var t=e.offsets,n=t.popper,r=t.reference,o=e.placement.split("-")[0],i=Math.floor,s=-1!==["top","bottom"].indexOf(o),t=s?"right":"bottom",o=s?"left":"top",s=s?"width":"height";return n[t]<i(r[o])&&(e.offsets.popper[o]=i(r[o])-n[s]),n[o]>i(r[t])&&(e.offsets.popper[o]=i(r[t])),e}},arrow:{order:500,enabled:!0,fn:function(e,t){if(!M(e.instance.modifiers,"arrow","keepTogether"))return e;var n=t.element;if("string"==typeof n){if(!(n=e.instance.popper.querySelector(n)))return e}else if(!e.instance.popper.contains(n))return e;var r=e.placement.split("-")[0],o=e.offsets,i=o.popper,s=o.reference,a=-1!==["left","right"].indexOf(r),c=a?"height":"width",u=a?"Top":"Left",f=u.toLowerCase(),t=a?"left":"top",o=a?"bottom":"right",r=A(n)[c];s[o]-r<i[f]&&(e.offsets.popper[f]-=i[f]-(s[o]-r)),i[o]<s[f]+r&&(e.offsets.popper[f]+=s[f]+r-i[o]),e.offsets.popper=k(e.offsets.popper);a=s[f]+s[c]/2-r/2,o=l(e.instance.popper),s=parseFloat(o["margin"+u]),u=parseFloat(o["border"+u+"Width"]),u=a-e.offsets.popper[f]-s-u,u=Math.max(Math.min(i[c]-r,u),0);return e.arrowElement=n,e.offsets.arrow=(b(n={},f,Math.round(u)),b(n,t,""),n),e},element:"[x-arrow]"},flip:{order:600,enabled:!0,fn:function(c,u){if($(c.instance.modifiers,"inner"))return c;if(c.flipped&&c.placement===c.originalPlacement)return c;var f=x(c.instance.popper,c.instance.reference,u.padding,u.boundariesElement,c.positionFixed),l=c.placement.split("-")[0],d=P(l),p=c.placement.split("-")[1]||"",h=[];switch(u.behavior){case"flip":h=[l,d];break;case"clockwise":h=J(l);break;case"counterclockwise":h=J(l,!0);break;default:h=u.behavior}return h.forEach(function(e,t){if(l!==e||h.length===t+1)return c;l=c.placement.split("-")[0],d=P(l);var n=c.offsets.popper,r=c.offsets.reference,o=Math.floor,i="left"===l&&o(n.right)>o(r.left)||"right"===l&&o(n.left)<o(r.right)||"top"===l&&o(n.bottom)>o(r.top)||"bottom"===l&&o(n.top)<o(r.bottom),s=o(n.left)<o(f.left),a=o(n.right)>o(f.right),e=o(n.top)<o(f.top),r=o(n.bottom)>o(f.bottom),n="left"===l&&s||"right"===l&&a||"top"===l&&e||"bottom"===l&&r,o=-1!==["top","bottom"].indexOf(l),e=!!u.flipVariations&&(o&&"start"===p&&s||o&&"end"===p&&a||!o&&"start"===p&&e||!o&&"end"===p&&r)||!!u.flipVariationsByContent&&(o&&"start"===p&&a||o&&"end"===p&&s||!o&&"start"===p&&r||!o&&"end"===p&&e);(i||n||e)&&(c.flipped=!0,(i||n)&&(l=h[t+1]),e&&(p="end"===p?"start":"start"===p?"end":p),c.placement=l+(p?"-"+p:""),c.offsets.popper=w({},c.offsets.popper,D(c.instance.popper,c.offsets.reference,c.placement)),c=L(c.instance.modifiers,c,"flip"))}),c},behavior:"flip",padding:5,boundariesElement:"viewport",flipVariations:!1,flipVariationsByContent:!1},inner:{order:700,enabled:!1,fn:function(e){var t=e.placement,n=t.split("-")[0],r=e.offsets,o=r.popper,i=r.reference,s=-1!==["left","right"].indexOf(n),r=-1===["top","left"].indexOf(n);return o[s?"left":"top"]=i[n]-(r?o[s?"width":"height"]:0),e.placement=P(t),e.offsets.popper=k(o),e}},hide:{order:800,enabled:!0,fn:function(e){if(!M(e.instance.modifiers,"hide","preventOverflow"))return e;var t=e.offsets.reference,n=C(e.instance.modifiers,function(e){return"preventOverflow"===e.name}).boundaries;if(t.bottom<n.top||n.right<t.left||n.bottom<t.top||t.right<n.left){if(!0===e.hide)return e;e.hide=!0,e.attributes["x-out-of-boundaries"]=""}else{if(!1===e.hide)return e;e.hide=!1,e.attributes["x-out-of-boundaries"]=!1}return e}},computeStyle:{order:850,enabled:!0,fn:function(e,t){var n,r,o,i=t.x,s=t.y,a=e.offsets.popper,c=C(e.instance.modifiers,function(e){return"applyStyle"===e.name}).gpuAcceleration,u=void 0!==c?c:t.gpuAcceleration,f=g(e.instance.popper),l=O(f),d={position:a.position},p=(p=e,n=window.devicePixelRatio<2||!R,v=(o=p.offsets).popper,r=Math.round,h=Math.floor,c=r(o.reference.width),t=r(v.width),a=-1!==["left","right"].indexOf(p.placement),o=-1!==p.placement.indexOf("-"),p=n?r:m,{left:(h=n?a||o||c%2==t%2?r:h:m)(c%2==1&&t%2==1&&!o&&n?v.left-1:v.left),top:p(v.top),bottom:p(v.bottom),right:h(v.right)}),h="bottom"===i?"top":"bottom",v="right"===s?"left":"right",i=I("transform"),s="bottom"==h?"HTML"===f.nodeName?-f.clientHeight+p.bottom:-l.height+p.bottom:p.top,p="right"==v?"HTML"===f.nodeName?-f.clientWidth+p.right:-l.width+p.right:p.left;function m(e){return e}return u&&i?(d[i]="translate3d("+p+"px, "+s+"px, 0)",d[h]=0,d[v]=0,d.willChange="transform"):(i="right"==v?-1:1,d[h]=s*("bottom"==h?-1:1),d[v]=p*i,d.willChange=h+", "+v),e.attributes=w({},{"x-placement":e.placement},e.attributes),e.styles=w({},d,e.styles),e.arrowStyles=w({},e.offsets.arrow,e.arrowStyles),e},gpuAcceleration:!0,x:"bottom",y:"right"},applyStyle:{order:900,enabled:!0,fn:function(e){var t,n;return N(e.instance.popper,e.styles),t=e.instance.popper,n=e.attributes,Object.keys(n).forEach(function(e){!1!==n[e]?t.setAttribute(e,n[e]):t.removeAttribute(e)}),e.arrowElement&&Object.keys(e.arrowStyles).length&&N(e.arrowElement,e.arrowStyles),e},onLoad:function(e,t,n,r,o){o=S(o,t,e,n.positionFixed),e=q(n.placement,o,t,e,n.modifiers.flip.boundariesElement,n.modifiers.flip.padding);return t.setAttribute("x-placement",e),N(t,{position:n.positionFixed?"fixed":"absolute"}),n},gpuAcceleration:void 0}}},U=(_(H.prototype,[{key:"update",value:function(){return function(){var e;this.state.isDestroyed||((e={instance:this,styles:{},arrowStyles:{},attributes:{},flipped:!1,offsets:{}}).offsets.reference=S(this.state,this.popper,this.reference,this.options.positionFixed),e.placement=q(this.options.placement,e.offsets.reference,this.popper,this.reference,this.options.modifiers.flip.boundariesElement,this.options.modifiers.flip.padding),e.originalPlacement=e.placement,e.positionFixed=this.options.positionFixed,e.offsets.popper=D(this.popper,e.offsets.reference,e.placement),e.offsets.popper.position=this.options.positionFixed?"fixed":"absolute",e=L(this.modifiers,e),this.state.isCreated?this.options.onUpdate(e):(this.state.isCreated=!0,this.options.onCreate(e)))}.call(this)}},{key:"destroy",value:function(){return function(){return this.state.isDestroyed=!0,$(this.modifiers,"applyStyle")&&(this.popper.removeAttribute("x-placement"),this.popper.style.position="",this.popper.style.top="",this.popper.style.left="",this.popper.style.right="",this.popper.style.bottom="",this.popper.style.willChange="",this.popper.style[I("transform")]=""),this.disableEventListeners(),this.options.removeOnDestroy&&this.popper.parentNode.removeChild(this.popper),this}.call(this)}},{key:"enableEventListeners",value:function(){return function(){this.state.eventsEnabled||(this.state=function(e,t,n){t.updateBound=n,T(e).addEventListener("resize",t.updateBound,{passive:!0});e=f(e);return function e(t,n,r,o){var i="BODY"===t.nodeName,t=i?t.ownerDocument.defaultView:t;t.addEventListener(n,r,{passive:!0}),i||e(f(t.parentNode),n,r,o),o.push(t)}(e,"scroll",t.updateBound,t.scrollParents),t.scrollElement=e,t.eventsEnabled=!0,t}(this.reference,this.state,this.scheduleUpdate))}.call(this)}},{key:"disableEventListeners",value:function(){return function(){var t;this.state.eventsEnabled&&(cancelAnimationFrame(this.scheduleUpdate),this.state=(t=this.state,T(this.reference).removeEventListener("resize",t.updateBound),t.scrollParents.forEach(function(e){e.removeEventListener("scroll",t.updateBound)}),t.updateBound=null,t.scrollParents=[],t.scrollElement=null,t.eventsEnabled=!1,t))}.call(this)}}]),H);function H(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(e){if(!(e instanceof H))throw new TypeError("Cannot call a class as a function")}(this),this.scheduleUpdate=function(){return requestAnimationFrame(n.update)},this.update=o(this.update.bind(this)),this.options=w({},H.Defaults,r),this.state={isDestroyed:!1,isCreated:!1,scrollParents:[]},this.reference=e&&e.jquery?e[0]:e,this.popper=t&&t.jquery?t[0]:t,this.options.modifiers={},Object.keys(w({},H.Defaults.modifiers,r.modifiers)).forEach(function(e){n.options.modifiers[e]=w({},H.Defaults.modifiers[e]||{},r.modifiers?r.modifiers[e]:{})}),this.modifiers=Object.keys(this.options.modifiers).map(function(e){return w({name:e},n.options.modifiers[e])}).sort(function(e,t){return e.order-t.order}),this.modifiers.forEach(function(e){e.enabled&&i(e.onLoad)&&e.onLoad(n.reference,n.popper,n.options,e,n.state)}),this.update();t=this.options.eventsEnabled;t&&this.enableEventListeners(),this.state.eventsEnabled=t}U.Utils=("undefined"!=typeof window?window:e).PopperUtils,U.placements=F,U.Defaults=z,W.a=U}.call(this,t(77))},431:function(e,ir,sr){"use strict";sr.r(ir),function(i){var _,e=sr(54),T=sr.n(e),n=sr(321),e=sr(137),d=sr.n(e),e=sr(180),r=sr.n(e),e=sr(76),u=sr.n(e),e=sr(52),t=sr.n(e),e=sr(38),a=sr.n(e);function o(){this._store={}}function s(e){if(this._store=new o,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}o.prototype.get=function(e){return this._store["$"+e]},o.prototype.set=function(e,t){return this._store["$"+e]=t,!0},o.prototype.has=function(e){return"$"+e in this._store},o.prototype.delete=function(e){var t="$"+e,e=t in this._store;return delete this._store[t],e},o.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var o=t[n];e(this._store[o],o=o.substring(1))}},Object.defineProperty(o.prototype,"size",{get:function(){return Object.keys(this._store).length}}),s.prototype.add=function(e){return this._store.set(e,!0)},s.prototype.has=function(e){return this._store.has(e)},s.prototype.forEach=function(n){this._store.forEach(function(e,t){n(t)})},Object.defineProperty(s.prototype,"size",{get:function(){return this._store.size}});var f,S=function(){if("undefined"!=typeof Symbol&&"undefined"!=typeof Map&&"undefined"!=typeof Set){var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}}()?(_=Set,Map):(_=s,o),c=Function.prototype.toString,l=c.call(Object);function B(t){var e,n,r,o;if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=B(t[n]);return e}if(t instanceof Date)return t.toISOString();if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer||"undefined"!=typeof Blob&&t instanceof Blob)return function(e){if(e instanceof ArrayBuffer)return function(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),e=new Uint8Array(e);return n.set(e),t}(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}(t);if(!function(){var e=Object.getPrototypeOf(t);if(null===e)return 1;e=e.constructor;return"function"==typeof e&&e instanceof e&&c.call(e)==l}())return t;for(n in e={},t)!Object.prototype.hasOwnProperty.call(t,n)||void 0!==(o=B(t[n]))&&(e[n]=o);return e}function p(t){var n=!1;return u()(function(e){if(n)throw new Error("once called more than once");n=!0,t.apply(this,e)})}function v(s){return u()(function(o){o=B(o);var i=this,t="function"==typeof o[o.length-1]&&o.pop(),e=new Promise(function(n,r){var e;try{var t=p(function(e,t){e?r(e):n(t)});o.push(t),(e=s.apply(i,o))&&"function"==typeof e.then&&n(e)}catch(e){r(e)}});return t&&e.then(function(e){t(null,e)},t),e})}function h(i,e){return v(u()(function(r){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var o=this;return function(r,o,e){if(r.constructor.listeners("debug").length){for(var t=["api",r.name,o],n=0;n<e.length-1;n++)t.push(e[n]);r.constructor.emit("debug",t);var i=e[e.length-1];e[e.length-1]=function(e,t){var n=(n=["api",r.name,o]).concat(e?["error",e]:["success",t]);r.constructor.emit("debug",n),i(e,t)}}}(o,i,r),this.taskqueue.isReady?e.apply(this,r):new Promise(function(t,n){o.taskqueue.addTask(function(e){e?n(e):t(o[i].apply(o,r))})})}))}function b(e,t){for(var n={},r=0,o=t.length;r<o;r++){var i=t[r];i in e&&(n[i]=e[i])}return n}function m(e){return e}function g(e){return[{ok:e}]}function w(a,c,u){var e=c.docs,f=new S;e.forEach(function(e){f.has(e.id)?f.get(e.id).push(e):f.set(e.id,[e])});var l=f.size,d=0,p=new Array(l),r=[];f.forEach(function(e,t){r.push(t)});var t=0;!function s(){var e,n;r.length<=t||(e=Math.min(t+6,r.length),e=r.slice(t,e),n=t,e.forEach(function(r,e){var o=n+e,e=f.get(r),t=b(e[0],["atts_since","attachments"]);t.open_revs=e.map(function(e){return e.rev}),t.open_revs=t.open_revs.filter(m);var i=m;0===t.open_revs.length&&(delete t.open_revs,i=g),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in c&&(t[e]=c[e])}),a.get(r,t,function(e,t){var n,t=e?[{error:e}]:i(t);p[o]={id:r,docs:t},++d===l&&(n=[],p.forEach(function(t){t.docs.forEach(function(e){n.push({id:t.id,docs:[e]})})}),u(null,{results:n})),s()})}),t+=e.length)}()}try{localStorage.setItem("_pouch_check_localstorage",1),f=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){f=!1}function y(){var t;a.a.call(this),this._listeners={},t=this,f&&addEventListener("storage",function(e){t.emit(e.key)})}function k(e){"undefined"!=typeof console&&"function"==typeof console[e]&&Array.prototype.slice.call(arguments,1)}function N(e){var e=(t=e)?0:2e3,t=parseInt(t,10)||0;return(e=parseInt(e,10))!=e||e<=t?e=(t||1)<<1:e+=1,6e5<e&&(t=3e5,e=6e5),~~((e-t)*Math.random()+t)}function O(e,t){k("info","The above "+e+" is totally normal. "+t)}t()(y,a.a),y.prototype.addListener=function(e,t,n,r){var o,i;function s(){var e;o._listeners[t]&&(i?i="waiting":(i=!0,e=b(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]),n.changes(e).on("change",function(e){r.since<e.seq&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===i&&T()(s),i=!1}).on("error",function(){i=!1})))}this._listeners[t]||(i=!1,(o=this)._listeners[t]=s,this.on(e,s))},y.prototype.removeListener=function(e,t){t in this._listeners&&(a.a.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},y.prototype.notifyLocalWindows=function(e){f&&(localStorage[e]="a"===localStorage[e]?"b":"a")},y.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var j="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t};function E(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}t()(E,Error),E.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})},new E(401,"unauthorized","Name or password is incorrect.");var x=new E(400,"bad_request","Missing JSON list of 'docs'"),q=new E(404,"not_found","missing"),A=new E(409,"conflict","Document update conflict"),P=new E(400,"bad_request","_id field must contain a string"),D=new E(412,"missing_id","_id is required for puts"),C=new E(400,"bad_request","Only reserved document ids may start with underscore."),L=(new E(412,"precondition_failed","Database not open"),new E(500,"unknown_error","Database encountered an unknown error")),$=new E(500,"badarg","Some query argument is invalid"),I=(new E(400,"invalid_request","Request was invalid"),new E(400,"query_parse_error","Some query parameter is invalid")),R=new E(500,"doc_validation","Bad special document member"),M=new E(400,"bad_request","Something wrong with the request"),F=new E(400,"bad_request","Document must be a JSON object"),K=(new E(404,"not_found","Database not found"),new E(500,"indexed_db_went_bad","unknown")),J=(new E(500,"web_sql_went_bad","unknown"),new E(500,"levelDB_went_went_bad","unknown"),new E(403,"forbidden","Forbidden by design doc validate_doc_update function"),new E(400,"bad_request","Invalid rev format")),z=(new E(412,"file_exists","The database could not be created, the file already exists."),new E(412,"missing_stub","A pre-existing attachment stub wasn't found"));function U(o,e){function t(e){for(var t=Object.getOwnPropertyNames(o),n=0,r=t.length;n<r;n++)"function"!=typeof o[t[n]]&&(this[t[n]]=o[t[n]]);void 0!==e&&(this.reason=e)}return t.prototype=E.prototype,new t(e)}function H(e){var t;return"object"!=typeof e&&(t=e,(e=L).data=t),"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function W(r){var o={},i=r.filter&&"function"==typeof r.filter;return o.query=r.query_params,function(e){e.doc||(e.doc={});var t=i&&function(e,t,n){try{return!e(t,n)}catch(e){n="Filter function threw: "+e.toString();return U(M,n)}}(r.filter,e.doc,o);if("object"==typeof t)return t;if(t)return!1;if(r.include_docs){if(!r.attachments)for(var n in e.doc._attachments)e.doc._attachments.hasOwnProperty(n)&&(e.doc._attachments[n].stub=!0)}else delete e.doc;return!0}}function V(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function G(e){var t;if(e?"string"!=typeof e?t=U(P):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=U(C)):t=U(D),t)throw t}function Y(e){return"boolean"==typeof e._remote?e._remote:"function"==typeof e.type&&(k("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),"http"===e.type())}function Q(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function X(e){e=Q(e);return e?e.join("/"):null}new E(413,"invalid_url","Provided URL is invalid");var Z=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ee="queryKey",te=/(?:^|&)([^&=]*)=?([^&]*)/g,ne=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function re(e){for(var t=ne.exec(e),r={},n=14;n--;){var o=Z[n],i=t[n]||"",s=-1!==["user","password"].indexOf(o);r[o]=s?decodeURIComponent(i):i}return r[ee]={},r[Z[12]].replace(te,function(e,t,n){t&&(r[ee][t]=n)}),r}function oe(e,t){var n,r=[],o=[];for(n in t)t.hasOwnProperty(n)&&(r.push(n),o.push(t[n]));return r.push(e),Function.apply(null,r).apply(null,o)}function ie(a,c,u){return new Promise(function(i,s){a.get(c,function(e,t){if(e){if(404!==e.status)return s(e);t={}}var n,r,o,e=t._rev,t=u(t);if(!t)return i({updated:!1,rev:e});t._id=c,t._rev=e,i((o=u,(n=a).put(r=t).then(function(e){return{updated:!0,rev:e.rev}},function(e){if(409!==e.status)throw e;return ie(n,r._id,o)})))})})}function se(e){return atob(e)}var ae=function(e){return btoa(e)};function ce(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(e){if("TypeError"!==e.name)throw e;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),o=0;o<t.length;o+=1)r.append(t[o]);return r.getBlob(n.type)}}function ue(e,t){return ce([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(e)],{type:t})}function fe(e,t){return ue(se(e),t)}function le(e,t){var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var o=e.target.result||"";if(r)return t(o);t(function(){for(var e="",t=new Uint8Array(o),n=t.byteLength,r=0;r<n;r++)e+=String.fromCharCode(t[r]);return e}())},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function de(e,t){le(e,function(e){t(e)})}function pe(e,t){de(e,function(e){t(ae(e))})}var he=self.setImmediate||self.setTimeout;function ve(t,e,n,r,o){var i,s;(0<n||r<e.size)&&(n=n,i=r,e=(r=e).webkitSlice?r.webkitSlice(n,i):r.slice(n,i)),i=e,s=function(e){t.append(e),o()},(e=new FileReader).onloadend=function(e){e=e.target.result||new ArrayBuffer(0);s(e)},e.readAsArrayBuffer(i)}function me(e,t,n,r,o){(0<n||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),o()}function ge(t,n){var e="string"==typeof t,r=e?t.length:t.size,o=Math.min(32768,r),i=Math.ceil(r/o),s=0,a=new(e?d.a:d.a.ArrayBuffer),c=e?me:ve;function u(){he(l)}function f(){var e=a.end(!0),e=ae(e);n(e),a.destroy()}function l(){var e=s*o;c(a,t,e,e+o,++s<i?u:f)}l()}function ye(e){return d.a.hash(e)}function _e(e,t){e=B(e);return t?(delete e._rev_tree,ye(JSON.stringify(e))):Object(n.a)().replace(/-/g,"").toLowerCase()}var be=n.a;function we(e){for(var t,n,r,o=e.rev_tree.slice();f=o.pop();){var i=f.ids,s=i[2],a=f.pos;if(s.length)for(var c=0,u=s.length;c<u;c++)o.push({pos:a+1,ids:s[c]});else{var f=!!i[1].deleted,i=i[0];t&&!(r!==f?r:n!==a?n<a:t<i)||(t=i,n=a,r=f)}}return n+"-"+t}function ke(e,t){for(var n,r=e.slice();n=r.pop();)for(var o=n.pos,i=n.ids,s=i[2],a=t(0===s.length,o,i[0],n.ctx,i[1]),c=0,u=s.length;c<u;c++)r.push({pos:o+1,ids:s[c],ctx:a})}function Oe(e,t){return e.pos-t.pos}function je(e){var i=[];ke(e,function(e,t,n,r,o){e&&i.push({rev:t+"-"+n,pos:t,opts:o})}),i.sort(Oe).reverse();for(var t=0,n=i.length;t<n;t++)delete i[t].pos;return i}function Ee(e){for(var t=we(e),n=je(e.rev_tree),r=[],o=0,i=n.length;o<i;o++){var s=n[o];s.rev===t||s.opts.deleted||r.push(s.rev)}return r}function xe(e){for(var t,n=[],r=e.slice();t=r.pop();){var o=t.pos,i=t.ids,s=i[0],a=i[1],c=i[2],i=0===c.length,u=t.history?t.history.slice():[];u.push({id:s,opts:a}),i&&n.push({pos:o+1-u.length,ids:u});for(var f=0,l=c.length;f<l;f++)r.push({pos:o+1,ids:c[f],history:u})}return n.reverse()}function qe(e,t){return e.pos-t.pos}function Se(e,t){for(var n,r,o=t,i=e.length;o<i;o++){var s=e[o],s=[s.id,s.opts,[]];r?(r[2].push(s),r=s):n=r=s}return n}function Ae(e,t){return e[0]<t[0]?-1:1}function Pe(e,t){for(var n,r,o,i=[{tree1:e,tree2:t}],s=!1;0<i.length;){var a=i.pop(),c=a.tree1,u=a.tree2;(c[1].status||u[1].status)&&(c[1].status="available"===c[1].status||"available"===u[1].status?"available":"missing");for(var f=0;f<u[2].length;f++)if(c[2][0]){for(var l=!1,d=0;d<c[2].length;d++)c[2][d][0]===u[2][f][0]&&(i.push({tree1:c[2][d],tree2:u[2][f]}),l=!0);l||(s="new_branch",o=function(e,t,n){for(var r,o=0,i=e.length;o<i;)n(e[r=o+i>>>1],t)<0?o=1+r:i=r;return o}(n=c[2],r=u[2][f],Ae),n.splice(o,0,r))}else s="new_leaf",c[2][0]=u[2][f]}return{conflicts:s,tree:e}}function De(e,t,n){var r,o=[],i=!1,s=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var a=0,c=e.length;a<c;a++){var u=e[a];if(u.pos===t.pos&&u.ids[0]===t.ids[0])r=Pe(u.ids,t.ids),o.push({pos:u.pos,ids:r.tree}),i=i||r.conflicts,s=!0;else if(!0!==n){var f=u.pos<t.pos?u:t,l=u.pos<t.pos?t:u,d=[],p=[];for(p.push({ids:f.ids,diff:l.pos-f.pos,parent:null,parentIdx:null});0<p.length;){var h=p.pop();if(0!==h.diff)for(var v=h.ids[2],m=0,g=v.length;m<g;m++)p.push({ids:v[m],diff:h.diff-1,parent:h.ids,parentIdx:m});else h.ids[0]===l.ids[0]&&d.push(h)}var y=d[0];y?(r=Pe(y.ids,l.ids),y.parent[2][y.parentIdx]=r.tree,o.push({pos:f.pos,ids:f.ids}),i=i||r.conflicts,s=!0):o.push(u)}else o.push(u)}return s||o.push(t),o.sort(qe),{tree:o,conflicts:i||"internal_node"}}function Ce(e,t,n){var l=De(e,t),n=function(e){for(var t,n=xe(l.tree),r=0,o=n.length;r<o;r++){var i=n[r],s=i.ids;if(e<s.length)for(var a=a||{},c=s.length-e,u={pos:i.pos+c,ids:Se(s,c)},f=0;f<c;f++)a[i.pos+f+"-"+s[f].id]=!0;else u={pos:i.pos,ids:Se(s,0)};t=t?De(t,u,!0).tree:[u]}return a&&ke(t,function(e,t,n){delete a[t+"-"+n]}),{tree:t,revs:a?Object.keys(a):[]}}(n);return{tree:n.tree,stemmedRevs:n.revs,conflicts:l.conflicts}}function Le(e){return e.ids}function $e(e,t){for(var n,r=(t=t||we(e)).substring(t.indexOf("-")+1),o=e.rev_tree.map(Le);n=o.pop();){if(n[0]===r)return!!n[1].deleted;o=o.concat(n[2])}}function Ie(e){return/^_local/.test(e)}function Te(r,t,n){a.a.call(this);var o=this;this.db=r;var i=(t=t?B(t):{}).complete=p(function(e,t){var n;e?0<("listenerCount"in(n=o)?n.listenerCount("error"):a.a.listenerCount(n,"error"))&&o.emit("error",e):o.emit("complete",t),o.removeAllListeners(),r.removeListener("destroyed",s)});function s(){o.cancel()}n&&(o.on("complete",function(e){n(null,e)}),o.on("error",n)),r.once("destroyed",s),t.onChange=function(e,t,n){o.isCancelled||function(e,t,n,r){try{e.emit("change",t,n,r)}catch(e){k("error",'Error in .on("change", function):',e)}}(o,e,t,n)};var e=new Promise(function(n,r){t.complete=function(e,t){e?r(e):n(t)}});o.once("cancel",function(){r.removeListener("destroyed",s),t.complete(null,{status:"cancelled"})}),this.then=e.then.bind(e),this.catch=e.catch.bind(e),this.then(function(e){i(null,e)},i),r.taskqueue.isReady?o.validateChanges(t):r.taskqueue.addTask(function(e){e?t.complete(e):o.isCancelled?o.emit("cancel"):o.validateChanges(t)})}function Be(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=je(t.rev_tree).map(function(e){return{rev:e.rev}}));r={id:t.id,changes:r,doc:e};return $e(t,e._rev)&&(r.deleted=!0),n.conflicts&&(r.doc._conflicts=Ee(t),r.doc._conflicts.length||delete r.doc._conflicts),r}function Ne(e,t){return e<t?-1:t<e?1:0}function Re(n,r){return function(e,t){e||t[0]&&t[0].error?((e=e||t[0]).docId=r,n(e)):n(null,t.length?t[0]:t)}}function Me(e,t){var n=Ne(e._id,t._id);return 0!==n?n:Ne(e._revisions?e._revisions.start:0,t._revisions?t._revisions.start:0)}function Fe(){for(var e in a.a.call(this),Fe.prototype)"function"==typeof this[e]&&(this[e]=this[e].bind(this))}function Ke(){this.isReady=!1,this.failed=!1,this.queue=[]}function Je(e,t){if(!(this instanceof Je))return new Je(e,t);var o=this;if(t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),void 0===t.deterministic_revs&&(t.deterministic_revs=!0),this.__opts=t=B(t),o.auto_compaction=t.auto_compaction,o.prefix=Je.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var n=function(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=Je.adapters,o=Je.preferredAdapters,i=Je.prefix,s=t.adapter;if(!s)for(var a=0;a<o.length&&"idb"===(s=o[a])&&"websql"in r&&f&&localStorage["_pouch__websqldb_"+i+e];++a)k("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');t=r[s];return{name:t&&"use_prefix"in t&&!t.use_prefix?e:i+e,adapter:s}}((t.prefix||"")+e,t);if(t.name=n.name,t.adapter=t.adapter||n.adapter,o.name=e,o._adapter=t.adapter,Je.emit("debug",["adapter","Picked adapter: ",t.adapter]),!Je.adapters[t.adapter]||!Je.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);Fe.call(o),o.taskqueue=new Ke,o.adapter=t.adapter,Je.adapters[t.adapter].call(o,t,function(e){return e?o.taskqueue.fail(e):((r=o).once("destroyed",t),r.once("closed",n),r.constructor.emit("ref",r),o.emit("created",o),Je.emit("created",o.name),void o.taskqueue.ready(o));function t(e){r.removeListener("closed",n),e||r.constructor.emit("destroyed",r.name)}function n(){r.removeListener("destroyed",t),r.constructor.emit("unref",r)}var r})}t()(Te,a.a),Te.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},Te.prototype.validateChanges=function(t){var n=t.complete,r=this;Je._changesFilterPlugin?Je._changesFilterPlugin.validate(t,function(e){return e?n(e):void r.doChanges(t)}):r.doChanges(t)},Te.prototype.doChanges=function(t){var n=this,r=t.complete;if("live"in(t=B(t))&&!("continuous"in t)&&(t.continuous=t.live),t.processChange=Be,"latest"===t.since&&(t.since="now"),t.since||(t.since=0),"now"!==t.since){if(Je._changesFilterPlugin){if(Je._changesFilterPlugin.normalize(t),Je._changesFilterPlugin.shouldFilter(this,t))return Je._changesFilterPlugin.filter(this,t)}else["doc_ids","filter","selector","view"].forEach(function(e){e in t&&k("warn",'The "'+e+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in t||(t.descending=!1),t.limit=0===t.limit?1:t.limit,t.complete=r;var o,i=this.db._changes(t);i&&"function"==typeof i.cancel&&(o=n.cancel,n.cancel=u()(function(e){i.cancel(),o.apply(this,e)}))}else this.db.info().then(function(e){n.isCancelled?r(null,{status:"cancelled"}):(t.since=e.update_seq,n.doChanges(t))},r)},t()(Fe,a.a),Fe.prototype.post=h("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?n(U(F)):void this.bulkDocs({docs:[e]},t,Re(n,e._id))}),Fe.prototype.put=h("put",function(t,n,r){if("function"==typeof n&&(r=n,n={}),"object"!=typeof t||Array.isArray(t))return r(U(F));if(G(t._id),Ie(t._id)&&"function"==typeof this._putLocal)return t._deleted?this._removeLocal(t,r):this._putLocal(t,r);var e,o,i,s=this;function a(e){"function"==typeof s._put&&!1!==n.new_edits?s._put(t,n,e):s.bulkDocs({docs:[t]},n,Re(e,t._id))}n.force&&t._rev?(e=(i=t._rev.split("-"))[1],o=parseInt(i[0],10)+1,i=_e(),t._revisions={start:o,ids:[i,e]},t._rev=o+"-"+i,n.new_edits=!1,a(function(e){r(e,e?null:{ok:!0,id:t._id,rev:t._rev})})):a(r)}),Fe.prototype.putAttachment=h("putAttachment",function(t,n,r,o,i){var s=this;function a(e){var t="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[n]={content_type:i,data:o,revpos:++t},s.put(e)}return"function"==typeof i&&(i=o,o=r,r=null),void 0===i&&(i=o,o=r,r=null),i||k("warn","Attachment",n,"on document",t,"is missing content_type"),s.get(t).then(function(e){if(e._rev!==r)throw U(A);return a(e)},function(e){if(e.reason===q.message)return a({_id:t});throw e})}),Fe.prototype.removeAttachment=h("removeAttachment",function(e,n,r,o){var i=this;i.get(e,function(e,t){if(e)o(e);else if(t._rev===r){if(!t._attachments)return o();delete t._attachments[n],0===Object.keys(t._attachments).length&&delete t._attachments,i.put(t,o)}else o(U(A))})}),Fe.prototype.remove=h("remove",function(e,t,n,r){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(o=e,n="function"==typeof t?(r=t,{}):(r=n,t)),(n=n||{}).was_delete=!0;t={_id:o._id,_rev:o._rev||n.rev,_deleted:!0};if(Ie(t._id)&&"function"==typeof this._removeLocal)return this._removeLocal(o,r);this.bulkDocs({docs:[t]},n,Re(r,t._id))}),Fe.prototype.revsDiff=h("revsDiff",function(o,e,a){"function"==typeof e&&(a=e,e={});var c=Object.keys(o);if(!c.length)return a(null,{});var u=0,f=new S;function l(e,t){f.has(e)||f.set(e,{missing:[]}),f.get(e).missing.push(t)}c.map(function(r){this._getRevisionTree(r,function(e,t){if(e&&404===e.status&&"missing"===e.message)f.set(r,{missing:o[r]});else{if(e)return a(e);t=t,s=o[i=r].slice(0),ke(t,function(e,t,n,r,o){t=t+"-"+n,n=s.indexOf(t);-1!==n&&(s.splice(n,1),"available"!==o.status&&l(i,t))}),s.forEach(function(e){l(i,e)})}var i,s;if(++u===c.length){var n={};return f.forEach(function(e,t){n[t]=e}),a(null,n)}})},this)}),Fe.prototype.bulkGet=h("bulkGet",function(e,t){w(this,e,t)}),Fe.prototype.compactDocument=h("compactDocument",function(r,c,u){var f=this;this._getRevisionTree(r,function(e,t){if(e)return u(e);var o,i,n=(o={},i=[],ke(t,function(e,t,n,r){n=t+"-"+n;return e&&(o[n]=0),void 0!==r&&i.push({from:r,to:n}),n}),i.reverse(),i.forEach(function(e){o[e.from]=void 0===o[e.from]?1+o[e.to]:Math.min(o[e.from],1+o[e.to])}),o),s=[],a=[];Object.keys(n).forEach(function(e){c<n[e]&&s.push(e)}),ke(t,function(e,t,n,r,o){n=t+"-"+n;"available"===o.status&&-1!==s.indexOf(n)&&a.push(n)}),f._doCompaction(r,a,u)})}),Fe.prototype.compact=h("compact",function(e,t){"function"==typeof e&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),1===n._compactionQueue.length&&function n(r){var e=r._compactionQueue[0],t=e.opts,o=e.callback;r.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(t.last_seq=e.last_seq),r._compact(t,function(e,t){e?o(e):o(null,t),T()(function(){r._compactionQueue.shift(),r._compactionQueue.length&&n(r)})})})}(n)}),Fe.prototype._compact=function(e,n){var r=this,o=[];r.changes({return_docs:!1,last_seq:e.last_seq||0}).on("change",function(e){o.push(r.compactDocument(e.id,0))}).on("complete",function(e){var t=e.last_seq;Promise.all(o).then(function(){return ie(r,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<t)&&(e.last_seq=t,e)})}).then(function(){n(null,{ok:!0})}).catch(n)}).on("error",n)},Fe.prototype.get=h("get",function(g,y,_){if("function"==typeof y&&(_=y,y={}),"string"!=typeof g)return _(U(P));if(Ie(g)&&"function"==typeof this._getLocal)return this._getLocal(g,_);var n=[],b=this;function r(){var s=[],a=n.length;if(!a)return _(null,s);n.forEach(function(i){b.get(g,{rev:i,revs:y.revs,latest:y.latest,attachments:y.attachments,binary:y.binary},function(e,t){if(e)s.push({missing:i});else{for(var n,r=0,o=s.length;r<o;r++)if(s[r].ok&&s[r].ok._rev===t._rev){n=!0;break}n||s.push({ok:t})}--a||_(null,s)})})}if(!y.open_revs)return this._get(g,y,function(e,t){if(e)return e.docId=g,_(e);var o=t.doc,n=t.metadata,i=t.ctx;if(!y.conflicts||(r=Ee(n)).length&&(o._conflicts=r),$e(n,o._rev)&&(o._deleted=!0),y.revs||y.revs_info){for(var r=o._rev.split("-"),s=parseInt(r[0],10),a=r[1],c=xe(n.rev_tree),u=null,f=0;f<c.length;f++){var l=c[f],d=l.ids.map(function(e){return e.id}).indexOf(a);d!==s-1&&(u||-1===d)||(u=l)}if(!u)return(e=new Error("invalid rev tree")).docId=g,_(e);var p,e=u.ids.map(function(e){return e.id}).indexOf(o._rev.split("-")[1])+1;u.ids.splice(e,u.ids.length-e),u.ids.reverse(),y.revs&&(o._revisions={start:u.pos+u.ids.length-1,ids:u.ids.map(function(e){return e.id})}),y.revs_info&&(p=u.pos+u.ids.length,o._revs_info=u.ids.map(function(e){return{rev:--p+"-"+e.id,status:e.opts.status}}))}if(y.attachments&&o._attachments){var h=o._attachments,v=Object.keys(h).length;if(0===v)return _(null,o);Object.keys(h).forEach(function(r){this._getAttachment(o._id,r,h[r],{rev:o._rev,binary:y.binary,ctx:i},function(e,t){var n=o._attachments[r];n.data=t,delete n.stub,delete n.length,--v||_(null,o)})},b)}else{if(o._attachments)for(var m in o._attachments)o._attachments.hasOwnProperty(m)&&(o._attachments[m].stub=!0);_(null,o)}});if("all"===y.open_revs)this._getRevisionTree(g,function(e,t){return e?_(e):(n=je(t).map(function(e){return e.rev}),void r())});else{if(!Array.isArray(y.open_revs))return _(U(L,"function_clause"));for(var n=y.open_revs,e=0;e<n.length;e++){var t=n[e];if("string"!=typeof t||!/^\d+-/.test(t))return _(U(J))}r()}}),Fe.prototype.getAttachment=h("getAttachment",function(n,r,o,i){var s=this;o instanceof Function&&(i=o,o={}),this._get(n,o,function(e,t){return e?i(e):t.doc._attachments&&t.doc._attachments[r]?(o.ctx=t.ctx,o.binary=!0,void s._getAttachment(n,r,t.doc._attachments[r],o,i)):i(U(q))})}),Fe.prototype.allDocs=h("allDocs",function(t,e){if("function"==typeof t&&(e=t,t={}),t.skip=void 0!==t.skip?t.skip:0,t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"keys"in t){if(!Array.isArray(t.keys))return e(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(e){return e in t})[0];if(n)return void e(U(I,"Query parameter `"+n+"` is not compatible with multi-get"));if(!Y(this)&&(n="limit"in(r=t)?r.keys.slice(r.skip,r.limit+r.skip):0<r.skip?r.keys.slice(r.skip):r.keys,r.keys=n,r.skip=0,delete r.limit,r.descending&&(n.reverse(),r.descending=!1),0===t.keys.length))return this._allDocs({limit:0},e)}var r;return this._allDocs(t,e)}),Fe.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),(e=e||{}).return_docs="return_docs"in e?e.return_docs:!e.live,new Te(this,e,t)},Fe.prototype.close=h("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),Fe.prototype.info=h("info",function(n){var r=this;this._info(function(e,t){return e?n(e):(t.db_name=t.db_name||r.name,t.auto_compaction=!(!r.auto_compaction||Y(r)),t.adapter=r.adapter,void n(null,t))})}),Fe.prototype.id=h("id",function(e){return this._id(e)}),Fe.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},Fe.prototype.bulkDocs=h("bulkDocs",function(e,o,i){if("function"==typeof o&&(i=o,o={}),o=o||{},!(e=Array.isArray(e)?{docs:e}:e)||!e.docs||!Array.isArray(e.docs))return i(U(x));for(var r,t=0;t<e.docs.length;++t)if("object"!=typeof e.docs[t]||Array.isArray(e.docs[t]))return i(U(F));if(e.docs.forEach(function(n){n._attachments&&Object.keys(n._attachments).forEach(function(e){var t;r=r||"_"===(t=e).charAt(0)&&t+" is not a valid attachment name, attachment names cannot start with '_'",n._attachments[e].content_type||k("warn","Attachment",e,"on document",n._id,"is missing content_type")})}),r)return i(U(M,r));"new_edits"in o||("new_edits"in e?o.new_edits=e.new_edits:o.new_edits=!0);var s=this;o.new_edits||Y(s)||e.docs.sort(Me),function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),o=0;o<r.length;o++){var i=r[o];n._attachments[i]=b(n._attachments[i],["data","digest","content_type","length","revpos","stub"])}}}(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,o,function(e,t){if(e)return i(e);if(o.new_edits||(t=t.filter(function(e){return e.error})),!Y(s))for(var n=0,r=t.length;n<r;n++)t[n].id=t[n].id||a[n];i(null,t)})}),Fe.prototype.registerDependentDatabase=h("registerDependentDatabase",function(t,e){var n=new this.constructor(t,this.__opts);ie(this,"_local/_pouch_dependentDbs",function(e){return e.dependentDbs=e.dependentDbs||{},!e.dependentDbs[t]&&(e.dependentDbs[t]=!0,e)}).then(function(){e(null,{db:n})}).catch(e)}),Fe.prototype.destroy=h("destroy",function(e,r){"function"==typeof e&&(r=e,e={});var o=this,i=!("use_prefix"in o)||o.use_prefix;function s(){o._destroy(e,function(e,t){return e?r(e):(o._destroyed=!0,o.emit("destroyed"),void r(null,t||{ok:!0}))})}if(Y(o))return s();o.get("_local/_pouch_dependentDbs",function(e,t){if(e)return 404!==e.status?r(e):s();var n=o.constructor,t=Object.keys(t.dependentDbs).map(function(e){e=i?e.replace(new RegExp("^"+n.prefix),""):e;return new n(e,o.__opts).destroy()});Promise.all(t).then(s,r)})}),Ke.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},Ke.prototype.fail=function(e){this.failed=e,this.execute()},Ke.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},Ke.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},t()(Je,Fe);var ze="undefined"!=typeof AbortController?AbortController:function(){return{abort:function(){}}},Ue=fetch,He=Headers;Je.adapters={},Je.preferredAdapters=[],Je.prefix="_pouch_";var We=new a.a;function Ve(e,t){for(var n=e,r=0,o=t.length;r<o&&(n=n[t[r]]);r++);return n}function Ge(e){for(var t=[],n="",r=0,o=e.length;r<o;r++){var i=e[r];"."===i?n=0<r&&"\\"===e[r-1]?n.substring(0,n.length-1)+".":(t.push(n),""):n+=i}return t.push(n),t}!function(t){Object.keys(a.a.prototype).forEach(function(e){"function"==typeof a.a.prototype[e]&&(t[e]=We[e].bind(We))});var r=t._destructionListeners=new S;t.on("ref",function(e){r.has(e.name)||r.set(e.name,[]),r.get(e.name).push(e)}),t.on("unref",function(e){var t,n;r.has(e.name)&&((n=(t=r.get(e.name)).indexOf(e))<0||(t.splice(n,1),1<t.length?r.set(e.name,t):r.delete(e.name)))}),t.on("destroyed",function(e){var t;r.has(e)&&(t=r.get(e),r.delete(e),t.forEach(function(e){e.emit("destroyed",!0)}))})}(Je),Je.adapter=function(e,t,n){t.valid()&&(Je.adapters[e]=t,n&&Je.preferredAdapters.push(e))},Je.plugin=function(t){if("function"==typeof t)t(Je);else{if("object"!=typeof t||0===Object.keys(t).length)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){Je.prototype[e]=t[e]})}return this.__defaults&&(Je.__defaults=j({},this.__defaults)),Je},Je.defaults=function(e){function n(e,t){if(!(this instanceof n))return new n(e,t);t=t||{},e&&"object"==typeof e&&(e=(t=e).name,delete t.name),t=j({},n.__defaults,t),Je.call(this,e,t)}return t()(n,Je),n.preferredAdapters=Je.preferredAdapters.slice(),Object.keys(Je).forEach(function(e){e in n||(n[e]=Je[e])}),n.__defaults=j({},this.__defaults,e),n},Je.fetch=function(e,t){return Ue(e,t)};var Ye=["$or","$nor","$not"];function Qe(e){return-1<Ye.indexOf(e)}function Xe(e){return Object.keys(e)[0]}function Ze(e){var n={};return e.forEach(function(t){Object.keys(t).forEach(function(e){var a,c=t[e];"object"!=typeof c&&(c={$eq:c}),Qe(e)?c instanceof Array?n[e]=c.map(function(e){return Ze([e])}):n[e]=Ze([c]):(a=n[e]=n[e]||{},Object.keys(c).forEach(function(e){var t,n,r,o,i,s=c[e];return"$gt"===e||"$gte"===e?(r=e,o=s,void(void 0===(i=a).$eq&&(void 0!==i.$gte?"$gte"===r?i.$gte<o&&(i.$gte=o):i.$gte<=o&&(delete i.$gte,i.$gt=o):void 0!==i.$gt?"$gte"===r?i.$gt<o&&(delete i.$gt,i.$gte=o):i.$gt<o&&(i.$gt=o):i[r]=o))):"$lt"===e||"$lte"===e?(i=e,r=s,void(void 0===(o=a).$eq&&(void 0!==o.$lte?"$lte"===i?r<o.$lte&&(o.$lte=r):r<=o.$lte&&(delete o.$lte,o.$lt=r):void 0!==o.$lt?"$lte"===i?r<o.$lt&&(delete o.$lt,o.$lte=r):r<o.$lt&&(o.$lt=r):o[i]=r))):"$ne"===e?(t=s,void("$ne"in(n=a)?n.$ne.push(t):n.$ne=[t])):"$eq"===e?(n=s,delete(t=a).$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,void(t.$eq=n)):void(a[e]=s)}))})}),n}var et=-324,tt=3,nt="";function rt(e,t){if(e===t)return 0;e=ot(e),t=ot(t);var n=st(e),r=st(t);if(n-r!=0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return e===t?0:t<e?1:-1}return(Array.isArray(e)?function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var o=rt(e[r],t[r]);if(0!==o)return o}return e.length===t.length?0:t.length<e.length?1:-1}:function(e,t){for(var n=Object.keys(e),r=Object.keys(t),o=Math.min(n.length,r.length),i=0;i<o;i++){var s=rt(n[i],r[i]);if(0!==s)return s;if(0!==(s=rt(e[n[i]],t[r[i]])))return s}return n.length===r.length?0:r.length<n.length?1:-1})(e,t)}function ot(e){switch(typeof e){case"undefined":return null;case"number":return e===1/0||e===-1/0||isNaN(e)?null:e;case"object":var t,n=e;if(Array.isArray(e)){var r=e.length;e=new Array(r);for(var o=0;o<r;o++)e[o]=ot(n[o])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var i in e={},n)!n.hasOwnProperty(i)||void 0!==(t=n[i])&&(e[i]=ot(t))}}return e}function it(e){return st(e=ot(e))+nt+function(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return function(e){if(0===e)return"1";var n,r,t=e.toExponential().split(/e\+?/),o=parseInt(t[1],10),i=e<0,e=i?"0":"2",o=(n=((i?-o:o)-et).toString(),r=tt,function(){for(var e="",t=r-n.length;e.length<t;)e+="0";return e}()+n);e+=nt+o;t=Math.abs(parseFloat(t[0])),t=(t=(t=i?10-t:t).toFixed(20)).replace(/\.?0+$/,"");return e+(nt+t)}(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,o=n.length,i="";if(t)for(;++r<o;)i+=it(n[r]);else for(;++r<o;){var s=n[r];i+=it(s)+it(e[s])}return i}return""}(e)+"\0"}function st(e){var t=["boolean","number","string","object"].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:t<3?t+2:t+3:Array.isArray(e)?5:void 0}function at(s,a,e){return e.every(function(e){var t,n,r=a[e],o=Ge(e),i=Ve(s,o);return Qe(e)?(t=r,n=s,"$or"!==e?"$not"!==e?!t.find(function(e){return at(n,e,Object.keys(e))}):!at(n,t,Object.keys(t)):t.some(function(e){return at(n,e,Object.keys(e))})):ct(r,s,o,i)})}function ct(t,n,r,o){return!t||("object"==typeof t?Object.keys(t).every(function(e){if(dt[e])return dt[e](n,t[Ax],r,o);throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all')}):t===o)}function ut(e){return null!=e}function ft(e){return void 0!==e}function lt(t,e){return e.some(function(e){return t instanceof Array?-1<t.indexOf(e):t===e})}var dt={$elemMatch:function(t,n,r,e){return!!Array.isArray(e)&&0!==e.length&&e.some("object"==typeof e[0]?function(e){return at(e,n,Object.keys(n))}:function(e){return ct(n,t,r,e)})},$allMatch:function(t,n,r,e){return!!Array.isArray(e)&&0!==e.length&&e.every("object"==typeof e[0]?function(e){return at(e,n,Object.keys(n))}:function(e){return ct(n,t,r,e)})},$eq:function(e,t,n,r){return ft(r)&&0===rt(r,t)},$gte:function(e,t,n,r){return ft(r)&&0<=rt(r,t)},$gt:function(e,t,n,r){return ft(r)&&0<rt(r,t)},$lte:function(e,t,n,r){return ft(r)&&rt(r,t)<=0},$lt:function(e,t,n,r){return ft(r)&&rt(r,t)<0},$exists:function(e,t,n,r){return t?ft(r):!ft(r)},$mod:function(e,r,t,n){return ut(n)&&function(e){var t=r[0],n=r[1];if(0===t)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(t,10)!==t)throw new Error("Divisor is not an integer");if(parseInt(n,10)!==n)throw new Error("Modulus is not an integer");return parseInt(e,10)===e&&e%t===n}(n)},$ne:function(e,t,n,r){return t.every(function(e){return 0!==rt(r,e)})},$in:function(e,t,n,r){return ut(r)&&lt(r,t)},$nin:function(e,t,n,r){return ut(r)&&!lt(r,t)},$size:function(e,t,n,r){return ut(r)&&r.length===t},$all:function(e,t,n,r){return Array.isArray(r)&&(o=r,t.every(function(e){return-1<o.indexOf(e)}));var o},$regex:function(e,t,n,r){return ut(r)&&(r=r,new RegExp(t).test(r))},$type:function(e,t,n,r){return function(e,t){switch(t){case"null":return null===e;case"boolean":return"boolean"==typeof e;case"number":return"number"==typeof e;case"string":return"string"==typeof e;case"array":return e instanceof Array;case"object":return"[object Object]"==={}.toString.call(e)}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}(r,t)}};function pt(e,t){if(e.selector&&e.filter&&"_selector"!==e.filter)return t(new Error('selector invalid for filter "'+("string"==typeof e.filter?e.filter:"function")+'"'));t()}function ht(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=X(e.view):e.filter=X(e.filter))}function vt(e,t){return t.filter&&"string"==typeof t.filter&&!t.doc_ids&&!Y(e.db)}function mt(n,r){var o,i=r.complete;if("_view"===r.filter){if(!r.view||"string"!=typeof r.view){var e=U(M,"`view` filter parameter not found or invalid.");return i(e)}var s=Q(r.view);n.db.get("_design/"+s[0],function(e,t){if(n.isCancelled)return i(null,{status:"cancelled"});if(e)return i(H(e));e=t&&t.views&&t.views[s[1]]&&t.views[s[1]].map;if(!e)return i(U(q,t.views?"missing json key: "+s[1]:"missing json key: views"));r.filter=oe(["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n"),{}),n.doChanges(r)})}else r.selector?(r.filter=function(e){return function(e,s){if("object"!=typeof s)throw new Error("Selector error: expected a JSON object");var t,n,r,o,i=(i=[{doc:e}],t={selector:s=function(){var t=B(s),e=!1;!function e(t,n){for(var r in t){"$and"===r&&(n=!0);r=t[r];"object"==typeof r&&(n=e(r,n))}return n}(t,!1)||("$and"in(t=function e(t){for(var n in t){if(Array.isArray(t))for(var r in t)t[r].$and&&(t[r]=Ze(t[r].$and));n=t[n];"object"==typeof n&&e(n)}return t}(t))&&(t=Ze(t.$and)),e=!0),["$or","$nor"].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var r=t[n],o=e[r];"object"==typeof o&&null!==o||(e[r]={$eq:o})}})}),"$not"in t&&(t.$not=Ze([t.$not]));for(var n=Object.keys(t),r=0;r<n.length;r++){var o=n[r],i=t[o];"object"!=typeof i||null===i?i={$eq:i}:"$ne"in i&&!e&&(i.$ne=[i.$ne]),t[o]=i}return t}()},n=Object.keys(s),i=i.filter(function(e){return at(e.doc,t.selector,n)}),t.sort&&(o=t.sort,i=i.sort(function(e,t){var n=rt(a(e.doc),a(t.doc));return 0!==n?n:(e=e.doc._id)<(t=t.doc._id)?-1:t<e?1:0}),"string"!=typeof t.sort[0]&&"desc"===(r=t.sort[0])[Xe(r)]&&(i=i.reverse())),("limit"in t||"skip"in t)&&(e=t.skip||0,r=("limit"in t?t.limit:i.length)+e,i=i.slice(e,r)),i);function a(t){return o.map(function(e){e=Ge(Xe(e));return Ve(t,e)})}return i&&1===i.length}(e,r.selector)},n.doChanges(r)):(o=Q(r.filter),n.db.get("_design/"+o[0],function(e,t){if(n.isCancelled)return i(null,{status:"cancelled"});if(e)return i(H(e));e=t&&t.filters&&t.filters[o[1]];if(!e)return i(U(q,t&&t.filters?"missing json key: "+o[1]:"missing json key: filters"));r.filter=oe('"use strict";\nreturn '+e+";",{}),n.doChanges(r)}))}function gt(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}Je.plugin(function(e){e._changesFilterPlugin={validate:pt,normalize:ht,shouldFilter:vt,filter:mt}}),Je.version="7.2.2";var yt=gt(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),_t=gt(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function bt(e){if(!/^\d+-/.test(e))return U(J);var t=e.indexOf("-"),n=e.substring(0,t),t=e.substring(t+1);return{prefix:parseInt(n,10),id:t}}function wt(e,t,n){var r,o,i;n=n||{deterministic_revs:!0};var s={status:"available"};if(e._deleted&&(s.deleted=!0),t)if(e._id||(e._id=be()),o=_e(e,n.deterministic_revs),e._rev){if((i=bt(e._rev)).error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[o,s,[]]]]}],r=i.prefix+1}else e._rev_tree=[{pos:1,ids:[o,s,[]]}],r=1;else if(e._revisions&&(e._rev_tree=function(e){for(var t=e.start-e.ids.length+1,n=e.ids,r=[n[0],s,[]],o=1,i=n.length;o<i;o++)r=[n[o],{status:"missing"},[r]];return[{pos:t,ids:r}]}(e._revisions),r=e._revisions.start,o=e._revisions.ids[0]),!e._rev_tree){if((i=bt(e._rev)).error)return i;e._rev_tree=[{pos:r=i.prefix,ids:[o=i.id,s,[]]}]}G(e._id),e._rev=r+"-"+o;var a,c={metadata:{},data:{}};for(a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var u="_"===a[0];if(u&&!yt[a]){var f=U(R,a);throw f.message=R.message+": "+a,f}u&&!_t[a]?c.metadata[a.slice(1)]=e[a]:c.data[a]=e[a]}return c}function kt(e,t,n){if(e.stub)return n();var r,o,i;"string"==typeof e.data?function(t,e,n){var r=function(e){try{return se(e)}catch(e){return{error:U($,"Attachment is not a valid base64 string")}}}(t.data);if(r.error)return n(r.error);t.length=r.length,t.data="blob"===e?ue(r,t.content_type):"base64"===e?ae(r):r,ge(r,function(e){t.digest="md5-"+e,n()})}(e,t,n):(o=t,i=n,ge((r=e).data,function(e){r.digest="md5-"+e,r.length=r.data.size||r.data.length||0,"binary"===o?de(r.data,function(e){r.data=e,i()}):"base64"===o?pe(r.data,function(e){r.data=e,i()}):i()}))}function Ot(a,e,r,c,o,u,f,l,t){a=a||1e3;var d=l.new_edits,i=new S,n=0,s=e.length;function p(){++n===s&&t&&t()}e.forEach(function(e,n){var t;e._id&&Ie(e._id)?r[e._deleted?"_removeLocal":"_putLocal"](e,{ctx:o},function(e,t){u[n]=e||t,p()}):i.has(t=e.metadata.id)?(s--,i.get(t).push([e,n])):i.set(t,[[e,n]])}),i.forEach(function(r,o){var i=0;function s(){(++i<r.length?e:p)()}function e(){var e=r[i],t=e[0],n=e[1];c.has(o)?function(e,t,n,r,o,i,s,a){if(function(e,t){for(var n,r=e.slice(),t=t.split("-"),o=parseInt(t[0],10),i=t[1];n=r.pop();){if(n.pos===o&&n.ids[0]===i)return 1;for(var s=n.ids[2],a=0,c=s.length;a<c;a++)r.push({pos:n.pos+1,ids:s[a]})}}(t.rev_tree,n.metadata.rev)&&!a)return r[o]=n,i();var c=t.winningRev||we(t),u="deleted"in t?t.deleted:$e(t,c),f="deleted"in n.metadata?n.metadata.deleted:$e(n.metadata),l=/^1-/.test(n.metadata.rev);u&&!f&&a&&l&&((l=n.data)._rev=c,l._id=n.metadata.id,n=wt(l,a));e=Ce(t.rev_tree,n.metadata.rev_tree[0],e);if(a&&(u&&f&&"new_leaf"!==e.conflicts||!u&&"new_leaf"!==e.conflicts||u&&!f&&"new_branch"===e.conflicts)){var d=U(A);return r[o]=d,i()}d=n.metadata.rev;n.metadata.rev_tree=e.tree,n.stemmedRevs=e.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);e=we(n.metadata),t=$e(n.metadata,e),u=u===t?0:u<t?-1:1;s(n,e,t,d===e?t:$e(n.metadata,d),!0,u,o,i)}(a,c.get(o),t,u,n,s,f,d):(e=Ce([],t.metadata.rev_tree[0],a),t.metadata.rev_tree=e.tree,t.stemmedRevs=e.stemmedRevs||[],function(e,t,n){var r=we(e.metadata),o=$e(e.metadata,r);if("was_delete"in l&&o)return u[t]=U(q,"deleted"),n();if(d&&"missing"===e.metadata.rev_tree[0].ids[1].status){var i=U(A);return u[t]=i,n()}f(e,r,o,o,!1,o?0:1,t,n)}(t,n,s))}e()})}var jt="document-store",Et="by-sequence",xt="attach-store",qt="attach-seq-store",St="meta-store",At="local-store",Pt="detect-blob-support";function Dt(t){return function(e){t(U(K,e.target&&e.target.error?e.target.error.name||e.target.error.message:"unknown_error"))}}function Ct(e,t,n){return{data:function(t){try{return JSON.stringify(t)}catch(e){return r.a.stringify(t)}}(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Lt(e){if(!e)return null;var t=function(t){try{return JSON.parse(t)}catch(e){return r.a.parse(t)}}(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function $t(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function It(e,t,n,r){n?r(e?"string"!=typeof e?e:fe(e,t):ce([""],{type:t})):e?"string"!=typeof e?le(e,function(e){r(ae(e))}):r(e):r("")}function Tt(r,o,i,e){var t=Object.keys(r._attachments||{});if(!t.length)return e&&e();var n=0;function s(){++n===t.length&&e&&e()}t.forEach(function(e){var t,n;o.attachments&&o.include_docs?(n=(t=r._attachments[e]).digest,i.objectStore(xt).get(n).onsuccess=function(e){t.body=e.target.result.body,s()}):(r._attachments[e].stub=!0,s())})}function Bt(e,s){return Promise.all(e.map(function(i){if(i.doc&&i.doc._attachments){var e=Object.keys(i.doc._attachments);return Promise.all(e.map(function(n){var r=i.doc._attachments[n];if("body"in r){var e=r.body,o=r.content_type;return new Promise(function(t){It(e,o,s,function(e){i.doc._attachments[n]=j(b(r,["digest","content_type"]),{data:e}),t()})})}}))}}))}function Nt(e,t,n){var r=[],o=n.objectStore(Et),i=n.objectStore(xt),s=n.objectStore(qt),a=e.length;function c(){--a||r.length&&r.forEach(function(t){s.index("digestSeq").count(IDBKeyRange.bound(t+"::",t+"::",!1,!1)).onsuccess=function(e){e.target.result||i.delete(t)}})}e.forEach(function(e){o.index("_doc_id_rev").getKey(t+"::"+e).onsuccess=function(e){e=e.target.result;if("number"!=typeof e)return c();o.delete(e),s.index("seq").openCursor(IDBKeyRange.only(e)).onsuccess=function(e){var t=e.target.result;t?(e=t.value.digestSeq.split("::")[0],r.push(e),s.delete(t.primaryKey),t.continue()):c()}}})}function Rt(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}var Mt=new y;function Ft(s,e,a,l,t,n){for(var d,p,h,_,v,r,o,i,c=e.docs,u=0,f=c.length;u<f;u++){var m=c[u];m._id&&Ie(m._id)||(m=c[u]=wt(m,a.new_edits,s)).error&&!o&&(o=m)}if(o)return n(o);var g=!1,b=0,y=new Array(c.length),w=new S,k=!1;function O(){g=!0,j()}function j(){i&&g&&(i.docCount+=b,r.put(i))}function E(){k||(Mt.notify(l._meta.name),n(null,y))}function x(e,t,n,r,o,i,s,a){e.metadata.winningRev=t,e.metadata.deleted=n;var c,u,f,l,d,p,h,v,m=e.data;if(m._id=e.metadata.id,m._rev=e.metadata.rev,r&&(m._deleted=!0),m._attachments&&Object.keys(m._attachments).length)return c=e,u=t,f=n,l=o,d=s,p=a,h=0,void(v=Object.keys(c.data._attachments)).forEach(function(e){var t,n,r,o=c.data._attachments[e];o.stub?(h++,g()):(e=o.data,delete o.data,o.revpos=parseInt(u,10),n=e,r=y,_.count(t=o.digest).onsuccess=function(e){if(e.target.result)return r();_.put({digest:t,body:n}).onsuccess=r})});function g(){h===v.length&&q(c,u,f,l,d,p)}function y(){h++,g()}b+=i,j(),q(e,t,n,o,s,a)}function q(n,r,o,s,e,t){var i=n.data,a=n.metadata;function c(e){var i,t=n.stemmedRevs||[];(t=s&&l.auto_compaction?t.concat((i=[],ke(n.metadata.rev_tree,function(e,t,n,r,o){"available"!==o.status||e||(i.push(t+"-"+n),o.status="missing")}),i)):t)&&t.length&&Nt(t,n.metadata.id,d),a.seq=e.target.result;e=Ct(a,r,o);p.put(e).onsuccess=u}function u(){y[e]={ok:!0,id:a.id,rev:a.rev},w.set(n.metadata.id,n.metadata),function(e,t,n){var r=0,o=Object.keys(e.data._attachments||{});if(!o.length)return n();function i(){++r===o.length&&n()}for(var s,a=0;a<o.length;a++)s=void 0,(s=v.put({seq:t,digestSeq:e.data._attachments[o[a]].digest+"::"+t})).onsuccess=i,s.onerror=function(e){e.preventDefault(),e.stopPropagation(),i()}}(n,a.seq,t)}i._doc_id_rev=a.id+"::"+a.rev,delete i._id,delete i._rev;var f=h.put(i);f.onsuccess=c,f.onerror=function(e){e.preventDefault(),e.stopPropagation(),h.index("_doc_id_rev").getKey(i._doc_id_rev).onsuccess=function(e){h.put(i,e.target.result).onsuccess=c}}}!function(e,i,t){if(!e.length)return t();var s,n=0;function a(){n++,e.length===n&&(s?t(s):t())}e.forEach(function(e){var t,n=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!n.length)return a();function o(e){s=e,++r===n.length&&a()}for(t in e.data._attachments)e.data._attachments.hasOwnProperty(t)&&kt(e.data._attachments[t],i,o)})}(c,l._meta.blobSupport?"blob":"base64",function(e){return e?n(e):void function(){var e=Rt(t,[jt,Et,xt,At,qt,St],"readwrite");if(e.error)return n(e.error);(d=e.txn).onabort=Dt(n),d.ontimeout=Dt(n),d.oncomplete=E,p=d.objectStore(jt),h=d.objectStore(Et),_=d.objectStore(xt),v=d.objectStore(qt),(r=d.objectStore(St)).get(St).onsuccess=function(e){i=e.target.result,j()},function(r){var o=[];if(c.forEach(function(t){t.data&&t.data._attachments&&Object.keys(t.data._attachments).forEach(function(e){e=t.data._attachments[e];e.stub&&o.push(e.digest)})}),!o.length)return r();var i,s=0;o.forEach(function(e){function t(e){e&&!i&&(i=e),++s===o.length&&r(i)}var n;_.get(n=e).onsuccess=function(e){e.target.result?t():((e=U(z,"unknown stub attachment with digest "+n)).status=412,t(e))}})}(function(e){return e?(k=!0,n(e)):void function(){if(c.length)for(var e=0,t=0,n=c.length;t<n;t++){var r=c[t];r._id&&Ie(r._id)?o():p.get(r.metadata.id).onsuccess=i}function o(){++e===c.length&&Ot(s.revs_limit,c,l,w,d,y,x,a,O)}function i(e){e=Lt(e.target.result);e&&w.set(e.id,e),o()}}()})}()})}function Kt(n,r,e,o,i){var s,a,t;function c(e){a=e.target.result,s&&i(s,a,t)}function u(e){s=e.target.result,a&&i(s,a,t)}function f(e){e=e.target.result;if(!e)return i();i([e.key],[e.value],e)}-1===o&&(o=1e3),"function"==typeof n.getAll&&"function"==typeof n.getAllKeys&&1<o&&!e?(t={continue:function(){if(!s.length)return i();var e,t=s[s.length-1];if(r&&r.upper)try{e=IDBKeyRange.bound(t,r.upper,!0,r.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else e=IDBKeyRange.lowerBound(t,!0);r=e,a=s=null,n.getAll(r,o).onsuccess=c,n.getAllKeys(r,o).onsuccess=u}},n.getAll(r,o).onsuccess=c,n.getAllKeys(r,o).onsuccess=u):e?n.openCursor(r,"prev").onsuccess=f:n.openCursor(r).onsuccess=f}function Jt(i,e,t){var n,r="startkey"in i&&i.startkey,o="endkey"in i&&i.endkey,s="key"in i&&i.key,a="keys"in i&&i.keys,c=i.skip||0,u="number"==typeof i.limit?i.limit:-1;if(!a&&(_=(n=function(e,t,n,r,o){try{if(e&&t)return o?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return o?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return o?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}(r,o,!1!==i.inclusive_end,s,i.descending))&&n.error)&&("DataError"!==_.name||0!==_.code))return t(U(K,_.name));o=[jt,Et,St];i.attachments&&o.push(xt);s=Rt(e,o,"readonly");if(s.error)return t(s.error);var f=s.txn;f.oncomplete=function(){i.attachments?Bt(O,i.binary).then(x):x()},f.onabort=Dt(t);var l,d,p,h,v,m,g,y,_,b,w,e=f.objectStore(jt),o=f.objectStore(Et),s=f.objectStore(St),k=o.index("_doc_id_rev"),O=[];function j(e){for(var t=0,n=e.length;t<n&&O.length!==u;t++){var r=e[t];r.error&&a?O.push(r):function(e,t){var n,r,o={id:t.id,key:t.id,value:{rev:e}};t.deleted?a&&(O.push(o),o.value.deleted=!0,o.doc=null):c--<=0&&(O.push(o),i.include_docs&&(r=o,k.get((n=t).id+"::"+e).onsuccess=function(e){r.doc=$t(e.target.result)||{},!i.conflicts||(e=Ee(n)).length&&(r.doc._conflicts=e),Tt(r.doc,i,f)}))}((r=Lt(r)).winningRev,r)}}function E(e,t,n){n&&(j(t),O.length<u&&n.continue())}function x(){var e={total_rows:l,offset:i.skip,rows:O};i.update_seq&&void 0!==d&&(e.update_seq=d),t(null,e)}return s.get(St).onsuccess=function(e){l=e.target.result.docCount},i.update_seq&&(p=function(e){e.target.result&&0<e.target.result.length&&(d=e.target.result[0])},o.openCursor(null,"prev").onsuccess=function(e){e=e.target.result;return p({target:{result:[e&&e.key?e.key:void 0]}})}),!_&&0!==u&&(a?(h=i.keys,v=e,m=E,g=new Array(h.length),y=0,h.forEach(function(t,n){v.get(t).onsuccess=function(e){g[n]=e.target.result||{key:t,error:"not_found"},++y===h.length&&m(h,g,{})}}),0):-1===u?(o=n,b=function(e){e=e.target.result;j(e=i.descending?e.reverse():e)},"function"!=typeof(_=e).getAll?(w=[],_.openCursor(o).onsuccess=function(e){e=e.target.result;e?(w.push(e.value),e.continue()):b({target:{result:w}})}):_.getAll(o).onsuccess=b,0):void Kt(e,n,i.descending,u+c,E))}var zt=!1,Ut=[];function Ht(){!zt&&Ut.length&&(zt=!0,Ut.shift()())}function Wt(e,n,r){Ut.push(function(){e(function(e,t){!function(e,t,n,r){try{e(t,n)}catch(t){r.emit("error",t)}}(n,e,t,r),zt=!1,T()(function(){Ht()})})}),Ht()}function Vt(c,e,t,n){if((c=B(c)).continuous){var r=t+":"+be();return Mt.addListener(t,r,e,c),Mt.notify(t),{cancel:function(){Mt.removeListener(t,r)}}}var u=c.doc_ids&&new _(c.doc_ids);c.since=c.since||0;var f=c.since,l="limit"in c?c.limit:-1;0===l&&(l=1);var d,p=[],h=0,v=W(c),m=new S;function g(e,t,n,r){return n.seq!==t?r():n.winningRev===e._rev?r(n,e):void(i.get(e._id+"::"+n.winningRev).onsuccess=function(e){r(n,$t(e.target.result))})}function o(){c.complete(null,{results:p,last_seq:f})}e=[jt,Et];c.attachments&&e.push(xt);e=Rt(n,e,"readonly");if(e.error)return c.complete(e.error);(d=e.txn).onabort=Dt(c.complete),d.oncomplete=function(){!c.continuous&&c.attachments?Bt(p).then(o):o()};var e=d.objectStore(Et),y=d.objectStore(jt),i=e.index("_doc_id_rev");Kt(e,c.since&&!c.descending?IDBKeyRange.lowerBound(c.since,!0):null,c.descending,l,function(r,e,o){var i,s,a;o&&r.length&&(i=new Array(r.length),s=new Array(r.length),a=0,e.forEach(function(e,n){!function(t,n,r){if(u&&!u.has(t._id))return r();var o=m.get(t._id);if(o)return g(t,n,o,r);y.get(t._id).onsuccess=function(e){o=Lt(e.target.result),m.set(t._id,o),g(t,n,o,r)}}($t(e),r[n],function(e,t){s[n]=e,i[n]=t,++a===r.length&&function(){for(var e=[],t=0,n=i.length;t<n&&h!==l;t++){var r=i[t];r&&e.push(function(e,t){var n=c.processChange(t,e,c);f=n.seq=e.seq;e=v(n);return"object"==typeof e?Promise.reject(e):e?(h++,c.return_docs&&p.push(n),c.attachments&&c.include_docs?new Promise(function(e){Tt(t,c,d,function(){Bt([n],c.binary).then(function(){e(n)})})}):Promise.resolve(n)):Promise.resolve()}(s[t],r))}Promise.all(e).then(function(e){for(var t=0,n=e.length;t<n;t++)e[t]&&c.onChange(e[t])}).catch(c.complete),h!==l&&o.continue()}()})}))})}var Gt,Yt=new S,Qt=new S;function Xt(t,e){var n=this;Wt(function(e){!function(l,r,d){var p=r.name,h=null;function i(e,r){var o=e.objectStore(jt);o.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),o.openCursor().onsuccess=function(e){var t,n=e.target.result;n?(e=$e(t=n.value),t.deletedOrLocal=e?"1":"0",o.put(t),n.continue()):r()}}function s(e,s){var a=e.objectStore(At),c=e.objectStore(jt),u=e.objectStore(Et);c.openCursor().onsuccess=function(e){var t,n,r,o,i=e.target.result;i?(e=Ie(n=(r=i.value).id),r=we(r),e?(t=n+"::"+r,e=n+"::",r=n+"::~",n=u.index("_doc_id_rev"),r=IDBKeyRange.bound(e,r,!1,!1),(o=n.openCursor(r)).onsuccess=function(e){(o=e.target.result)?((e=o.value)._doc_id_rev===t&&a.put(e),u.delete(o.primaryKey),o.continue()):(c.delete(i.primaryKey),i.continue())}):i.continue()):s&&s()}}function a(e,a){var t=e.objectStore(Et),n=e.objectStore(xt),c=e.objectStore(qt);n.count().onsuccess=function(e){if(!e.target.result)return a();t.openCursor().onsuccess=function(e){e=e.target.result;if(!e)return a();for(var t=e.value,n=e.primaryKey,r=Object.keys(t._attachments||{}),o={},i=0;i<r.length;i++)o[t._attachments[r[i]].digest]=!0;for(var s=Object.keys(o),i=0;i<s.length;i++)c.put({seq:n,digestSeq:s[i]+"::"+n});e.continue()}}}function c(e){var s=e.objectStore(Et),a=e.objectStore(jt);a.openCursor().onsuccess=function(e){var t=e.target.result;if(t){var n,r,o=(n=t.value).data?Lt(n):(n.deleted="1"===n.deletedOrLocal,n);if(o.winningRev=o.winningRev||we(o),o.seq)return i();e=o.id+"::",n=o.id+"::",n=s.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,n)),r=0,n.onsuccess=function(e){var t=e.target.result;if(!t)return o.seq=r,i();e=t.primaryKey;r<e&&(r=e),t.continue()}}function i(){var e=Ct(o,o.winningRev,o.deleted);a.put(e).onsuccess=function(){t.continue()}}}}l._meta=null,l._remote=!1,l.type=function(){return"idb"},l._id=v(function(e){e(null,l._meta.instanceId)}),l._bulkDocs=function(e,t,n){Ft(r,e,t,l,h,n)},l._get=function(e,n,t){var r,o,i,s=n.ctx;if(!s){var a=Rt(h,[jt,Et,xt],"readonly");if(a.error)return t(a.error);s=a.txn}function c(){t(i,{doc:r,metadata:o,ctx:s})}s.objectStore(jt).get(e).onsuccess=function(e){if(!(o=Lt(e.target.result)))return i=U(q,"missing"),c();if(n.rev)t=n.latest?function(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var o=n.pos,i=n.ids,s=i[0],a=i[1],c=i[2],i=0===c.length,u=n.history?n.history.slice():[];if(u.push({id:s,pos:o,opts:a}),i)for(var f=0,l=u.length;f<l;f++){var d=u[f];if(d.pos+"-"+d.id===e)return o+"-"+s}for(var p=0,h=c.length;p<h;p++)r.push({pos:o+1,ids:c[p],history:u})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}(n.rev,o):n.rev;else{var t=o.winningRev;if($e(o))return i=U(q,"deleted"),c()}e=s.objectStore(Et),t=o.id+"::"+t;e.index("_doc_id_rev").get(t).onsuccess=function(e){if(!(r=(r=e.target.result)&&$t(r)))return i=U(q,"missing"),c();c()}}},l._getAttachment=function(e,t,n,r,o){var i;if(r.ctx)i=r.ctx;else{var s=Rt(h,[jt,Et,xt],"readonly");if(s.error)return o(s.error);i=s.txn}var s=n.digest,a=n.content_type;i.objectStore(xt).get(s).onsuccess=function(e){It(e.target.result.body,a,r.binary,function(e){o(null,e)})}},l._info=function(e){var t,n,r=Rt(h,[St,Et],"readonly");if(r.error)return e(r.error);r=r.txn;r.objectStore(St).get(St).onsuccess=function(e){n=e.target.result.docCount},r.objectStore(Et).openCursor(null,"prev").onsuccess=function(e){e=e.target.result;t=e?e.key:0},r.oncomplete=function(){e(null,{doc_count:n,update_seq:t,idb_attachment_format:l._meta.blobSupport?"binary":"base64"})}},l._allDocs=function(e,t){Jt(e,h,t)},l._changes=function(e){return Vt(e,l,p,h)},l._close=function(e){h.close(),Yt.delete(p),e()},l._getRevisionTree=function(e,t){var n=Rt(h,[jt],"readonly");if(n.error)return t(n.error);n.txn.objectStore(jt).get(e).onsuccess=function(e){e=Lt(e.target.result);e?t(null,e.rev_tree):t(U(q))}},l._doCompaction=function(r,i,e){var t=Rt(h,[jt,Et,xt,qt],"readwrite");if(t.error)return e(t.error);var o=t.txn;o.objectStore(jt).get(r).onsuccess=function(e){var t=Lt(e.target.result);ke(t.rev_tree,function(e,t,n,r,o){-1!==i.indexOf(t+"-"+n)&&(o.status="missing")}),Nt(i,r,o);var n=t.winningRev,e=t.deleted;o.objectStore(jt).put(Ct(t,n,e))},o.onabort=Dt(e),o.oncomplete=function(){e()}},l._getLocal=function(e,t){var n=Rt(h,[At],"readonly");if(n.error)return t(n.error);e=n.txn.objectStore(At).get(e);e.onerror=Dt(t),e.onsuccess=function(e){e=e.target.result;e?(delete e._doc_id_rev,t(null,e)):t(U(q))}},l._putLocal=function(t,n,r){"function"==typeof n&&(r=n,n={}),delete t._revisions;var o=t._rev,e=t._id;t._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1";var i,s=n.ctx;if(!s){var a=Rt(h,[At],"readwrite");if(a.error)return r(a.error);(s=a.txn).onerror=Dt(r),s.oncomplete=function(){i&&r(null,i)}}var c,u=s.objectStore(At);o?(c=u.get(e)).onsuccess=function(e){e=e.target.result;e&&e._rev===o?u.put(t).onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},n.ctx&&r(null,i)}:r(U(A))}:((c=u.add(t)).onerror=function(e){r(U(A)),e.preventDefault(),e.stopPropagation()},c.onsuccess=function(){i={ok:!0,id:t._id,rev:t._rev},n.ctx&&r(null,i)})},l._removeLocal=function(t,n,r){"function"==typeof n&&(r=n,n={});var o,e=n.ctx;if(!e){var i=Rt(h,[At],"readwrite");if(i.error)return r(i.error);(e=i.txn).oncomplete=function(){o&&r(null,o)}}var s=t._id,a=e.objectStore(At),e=a.get(s);e.onerror=Dt(r),e.onsuccess=function(e){e=e.target.result;e&&e._rev===t._rev?(a.delete(s),o={ok:!0,id:s,rev:"0-0"},n.ctx&&r(null,o)):r(U(q))}},l._destroy=function(e,t){Mt.removeAllListeners(p);var n=Qt.get(p);n&&n.result&&(n.result.close(),Yt.delete(p));n=indexedDB.deleteDatabase(p);n.onsuccess=function(){Qt.delete(p),f&&p in localStorage&&delete localStorage[p],t(null,{ok:!0})},n.onerror=Dt(t)};var e=Yt.get(p);if(e)return h=e.idb,l._meta=e.global,T()(function(){d(null,l)});e=indexedDB.open(p,5);Qt.set(p,e),e.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return function(e){var t=e.createObjectStore(jt,{keyPath:"id"});e.createObjectStore(Et,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(xt,{keyPath:"digest"}),e.createObjectStore(St,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(Pt),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(At,{keyPath:"_id"});e=e.createObjectStore(qt,{autoIncrement:!0});e.createIndex("seq","seq"),e.createIndex("digestSeq","digestSeq",{unique:!0})}(t);var n=e.currentTarget.transaction;e.oldVersion<3&&t.createObjectStore(At,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.oldVersion<4&&((t=t.createObjectStore(qt,{autoIncrement:!0})).createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0}));var r=[i,s,a,c],o=e.oldVersion;!function e(){var t=r[o-1];o++,t&&t(n,e)}()},e.onsuccess=function(e){(h=e.target.result).onversionchange=function(){h.close(),Yt.delete(p)},h.onabort=function(e){k("error","Database has a global failure",e.target.error),h.close(),Yt.delete(p)};var t,n,r,o,i,s,a=h.transaction([St,Pt,jt],"readwrite"),c=!1;function u(){void 0!==r&&c&&(l._meta={name:p,instanceId:o,blobSupport:r},Yt.set(p,{idb:h,global:l._meta}),d(null,l))}function f(){var e;void 0!==n&&void 0!==t&&((e=p+"_id")in t?o=t[e]:t[e]=o=be(),t.docCount=n,a.objectStore(St).put(t))}a.objectStore(St).get(St).onsuccess=function(e){t=e.target.result||{id:St},f()},i=function(e){n=e,f()},a.objectStore(jt).index("deletedOrLocal").count(IDBKeyRange.only("0")).onsuccess=function(e){i(e.target.result)},Gt||(s=a,Gt=new Promise(function(n){var e=ce([""]),e=s.objectStore(Pt).put(e,"key");e.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),t=navigator.userAgent.match(/Edge\//);n(t||!e||43<=parseInt(e[1],10))},e.onerror=s.onabort=function(e){e.preventDefault(),e.stopPropagation(),n(!1)}}).catch(function(){return!1})),Gt.then(function(e){r=e,u()}),a.oncomplete=function(){c=!0,u()},a.onabort=Dt(d)},e.onerror=function(e){e=e.target.error&&e.target.error.message;e?-1!==e.indexOf("stored database is a higher version")&&(e=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):e="Failed to open indexedDB, are you in private browsing mode?",k("error",e),d(U(K,e))}}(n,t,e)},e,n.constructor)}Xt.valid=function(){try{return"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};var Zt={};function en(e){var e=e.doc||e.ok,t=e&&e._attachments;t&&Object.keys(t).forEach(function(e){e=t[e];e.data=fe(e.data,e.content_type)})}function tn(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function nn(n){return n._attachments&&Object.keys(n._attachments)?Promise.all(Object.keys(n._attachments).map(function(e){var t=n._attachments[e];if(t.data&&"string"!=typeof t.data)return new Promise(function(e){pe(t.data,e)}).then(function(e){t.data=e})})):Promise.resolve()}function rn(e,t){return on(e,e.db+"/"+t)}function on(e,t){return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+(e.path?"/":"")+t}function sn(t){return"?"+Object.keys(t).map(function(e){return e+"="+encodeURIComponent(t[e])}).join("&")}function an(a,e){var t=this,m=function(e,t){!function(){if(t.prefix){var e=re(t.prefix).protocol;return"http"===e||"https"===e}}()||(n=t.name.substr(t.prefix.length),e=t.prefix.replace(/\/?$/,"/")+encodeURIComponent(n));var n=re(e);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});e=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=e.pop(),-1===n.db.indexOf("%")&&(n.db=encodeURIComponent(n.db)),n.path=e.join("/"),n}(a.name,a),n=rn(m,"");a=B(a);var r,s=function(e,t){(t=t||{}).headers=t.headers||new He,t.credentials="include",(a.auth||m.auth)&&(n=a.auth||m.auth,r=ae(unescape(encodeURIComponent(n.username+":"+n.password))),t.headers.set("Authorization","Basic "+r));var n,r,o,i,s=a.headers||{};return Object.keys(s).forEach(function(e){t.headers.append(e,s[e])}),i=t,n=-1!==(o="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"").indexOf("msie"),r=-1!==o.indexOf("trident"),o=-1!==o.indexOf("edge"),i=!("method"in i)||"GET"===i.method,(n||r||o)&&i&&(e+=(-1===e.indexOf("?")?"?":"&")+"_nonce="+Date.now()),(a.fetch||Ue)(e,t)};function o(e,n){return h(e,u()(function(t){y().then(function(){return n.apply(this,t)}).catch(function(e){t.pop()(e)})})).bind(t)}function g(e,t,n){var r={};return(t=t||{}).headers=t.headers||new He,t.headers.get("Content-Type")||t.headers.set("Content-Type","application/json"),t.headers.get("Accept")||t.headers.set("Accept","application/json"),s(e,t).then(function(e){return r.ok=e.ok,r.status=e.status,e.json()}).then(function(e){if(r.data=e,!r.ok){r.data.status=r.status;e=H(r.data);if(n)return n(e);throw e}if(Array.isArray(r.data)&&(r.data=r.data.map(function(e){return e.error||e.missing?H(e):e})),!n)return r;n(null,r.data)})}function y(){return a.skip_setup?Promise.resolve():r||((r=g(n).catch(function(e){return e&&e.status&&404===e.status?(O(404,"PouchDB is just detecting if the remote exists."),g(n,{method:"PUT"})):Promise.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||Promise.reject(e)})).catch(function(){r=null}),r)}function c(e){return e.split("/").map(encodeURIComponent).join("/")}T()(function(){e(null,t)}),t._remote=!0,t.type=function(){return"http"},t.id=o("id",function(t){s(on(m,"")).then(function(e){return e.json()}).catch(function(){return{}}).then(function(e){e=e&&e.uuid?e.uuid+m.db:rn(m,"");t(null,e)})}),t.compact=o("compact",function(r,o){"function"==typeof r&&(o=r,r={}),r=B(r),g(rn(m,"_compact"),{method:"POST"}).then(function(){!function n(){t.info(function(e,t){t&&!t.compact_running?o(null,{ok:!0}):setTimeout(n,r.interval||200)})}()})}),t.bulkGet=h("bulkGet",function(n,s){var a=this;function e(t){var e={};n.revs&&(e.revs=!0),n.attachments&&(e.attachments=!0),n.latest&&(e.latest=!0),g(rn(m,"_bulk_get"+sn(e)),{method:"POST",body:JSON.stringify({docs:n.docs})}).then(function(e){n.attachments&&n.binary&&e.data.results.forEach(function(e){e.docs.forEach(en)}),t(null,e.data)}).catch(t)}function r(){for(var r=Math.ceil(n.docs.length/50),o=0,i=new Array(r),e=0;e<r;e++){var t=b(n,["revs","attachments","binary","latest"]);t.docs=n.docs.slice(50*e,Math.min(n.docs.length,50*(e+1))),w(a,t,function(n){return function(e,t){i[n]=t.results,++o===r&&s(null,{results:V(i)})}}(e))}}var o=on(m,""),t=Zt[o];"boolean"!=typeof t?e(function(e,t){e?(Zt[o]=!1,O(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),r()):(Zt[o]=!0,s(null,t))}):t?e(s):r()}),t._info=function(t){y().then(function(){return s(rn(m,""))}).then(function(e){return e.json()}).then(function(e){e.host=rn(m,""),t(null,e)}).catch(t)},t.fetch=function(t,n){return y().then(function(){var e="/"===t.substring(0,1)?on(m,t.substring(1)):rn(m,t);return s(e,n)})},t.get=o("get",function(t,i,n){"function"==typeof i&&(n=i,i={});var e={};function r(r){var l,o=r._attachments,e=o&&Object.keys(o);if(o&&e.length)return l=e.map(function(t){return function(){return n=o[e=t],e=tn(r._id)+"/"+c(e)+"?rev="+r._rev,s(rn(m,e)).then(function(e){return"buffer"in e?e.buffer():e.blob()}).then(function(t){if(i.binary){var e=Object.getOwnPropertyDescriptor(t.__proto__,"type");return e&&!e.set||(t.type=n.content_type),t}return new Promise(function(e){pe(t,e)})}).then(function(e){delete n.stub,delete n.length,n.data=e});var n,e}}),new Promise(function(e,t){var n,r=0,o=0,i=0,s=l.length;function a(){++i===s?n?t(n):e():f()}function c(){r--,a()}function u(e){r--,n=n||e,a()}function f(){for(;r<5&&o<s;)r++,l[o++]().then(c,u)}f()})}(i=B(i)).revs&&(e.revs=!0),i.revs_info&&(e.revs_info=!0),i.latest&&(e.latest=!0),i.open_revs&&("all"!==i.open_revs&&(i.open_revs=JSON.stringify(i.open_revs)),e.open_revs=i.open_revs),i.rev&&(e.rev=i.rev),i.conflicts&&(e.conflicts=i.conflicts),i.update_seq&&(e.update_seq=i.update_seq),t=tn(t),g(rn(m,t+sn(e))).then(function(t){return Promise.resolve().then(function(){if(i.attachments)return e=t.data,Array.isArray(e)?Promise.all(e.map(function(e){if(e.ok)return r(e.ok)})):r(e);var e}).then(function(){n(null,t.data)})}).catch(function(e){e.docId=t,n(e)})}),t.remove=o("remove",function(e,t,n,r){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(o=e,n="function"==typeof t?(r=t,{}):(r=n,t));n=o._rev||n.rev;g(rn(m,tn(o._id))+"?rev="+n,{method:"DELETE"},r).catch(r)}),t.getAttachment=o("getAttachment",function(e,t,n,r){"function"==typeof n&&(r=n,n={});var o,n=n.rev?"?rev="+n.rev:"",n=rn(m,tn(e))+"/"+c(t)+n;s(n,{method:"GET"}).then(function(e){if(o=e.headers.get("content-type"),e.ok)return void 0===i||i.browser||"function"!=typeof e.buffer?e.blob():e.buffer();throw e}).then(function(e){void 0===i||i.browser||(e.type=o),r(null,e)}).catch(function(e){r(e)})}),t.removeAttachment=o("removeAttachment",function(e,t,n,r){g(rn(m,tn(e)+"/"+c(t))+"?rev="+n,{method:"DELETE"},r).catch(r)}),t.putAttachment=o("putAttachment",function(e,t,n,r,o,i){"function"==typeof o&&(i=o,o=r,r=n,n=null);var s,t=tn(e)+"/"+c(t),t=rn(m,t);if(n&&(t+="?rev="+n),"string"==typeof r){try{s=se(r)}catch(e){return i(U($,"Attachment is not a valid base64 string"))}r=s?ue(s,o):""}g(t,{headers:new He({"Content-Type":o}),method:"PUT",body:r},i).catch(i)}),t._bulkDocs=function(e,t,n){e.new_edits=t.new_edits,y().then(function(){return Promise.all(e.docs.map(nn))}).then(function(){return g(rn(m,"_bulk_docs"),{method:"POST",body:JSON.stringify(e)},n)}).catch(n)},t._put=function(t,e,n){y().then(function(){return nn(t)}).then(function(){return g(rn(m,tn(t._id)),{method:"PUT",body:JSON.stringify(t)})}).then(function(e){n(null,e.data)}).catch(function(e){e.docId=t&&t._id,n(e)})},t.allDocs=o("allDocs",function(t,n){"function"==typeof t&&(n=t,t={});var e,r={},o="GET";(t=B(t)).conflicts&&(r.conflicts=!0),t.update_seq&&(r.update_seq=!0),t.descending&&(r.descending=!0),t.include_docs&&(r.include_docs=!0),t.attachments&&(r.attachments=!0),t.key&&(r.key=JSON.stringify(t.key)),t.start_key&&(t.startkey=t.start_key),t.startkey&&(r.startkey=JSON.stringify(t.startkey)),t.end_key&&(t.endkey=t.end_key),t.endkey&&(r.endkey=JSON.stringify(t.endkey)),void 0!==t.inclusive_end&&(r.inclusive_end=!!t.inclusive_end),void 0!==t.limit&&(r.limit=t.limit),void 0!==t.skip&&(r.skip=t.skip);r=sn(r);void 0!==t.keys&&(o="POST",e={keys:t.keys}),g(rn(m,"_all_docs"+r),{method:o,body:JSON.stringify(e)}).then(function(e){t.include_docs&&t.attachments&&t.binary&&e.data.rows.forEach(en),n(null,e.data)}).catch(n)}),t._changes=function(i){var s="batch_size"in i?i.batch_size:25;!(i=B(i)).continuous||"heartbeat"in i||(i.heartbeat=1e4);var e="timeout"in i?i.timeout:3e4;"timeout"in i&&i.timeout&&e-i.timeout<5e3&&(e=i.timeout+5e3),"heartbeat"in i&&i.heartbeat&&e-i.heartbeat<5e3&&(e=i.heartbeat+5e3);var o={};"timeout"in i&&i.timeout&&(o.timeout=i.timeout);var a=void 0!==i.limit&&i.limit,c=a;if(i.style&&(o.style=i.style),(i.include_docs||i.filter&&"function"==typeof i.filter)&&(o.include_docs=!0),i.attachments&&(o.attachments=!0),i.continuous&&(o.feed="longpoll"),i.seq_interval&&(o.seq_interval=i.seq_interval),i.conflicts&&(o.conflicts=!0),i.descending&&(o.descending=!0),i.update_seq&&(o.update_seq=!0),"heartbeat"in i&&i.heartbeat&&(o.heartbeat=i.heartbeat),i.filter&&"string"==typeof i.filter&&(o.filter=i.filter),i.view&&"string"==typeof i.view&&(o.filter="_view",o.view=i.view),i.query_params&&"object"==typeof i.query_params)for(var t in i.query_params)i.query_params.hasOwnProperty(t)&&(o[t]=i.query_params[t]);var u,f="GET";i.doc_ids?(o.filter="_doc_ids",f="POST",u={doc_ids:i.doc_ids}):i.selector&&(o.filter="_selector",f="POST",u={selector:i.selector});var l,d=new ze,p=function(e,t){var n,r;i.aborted||(o.since=e,"object"==typeof o.since&&(o.since=JSON.stringify(o.since)),i.descending?a&&(o.limit=c):o.limit=!a||s<c?s:c,n=rn(m,"_changes"+sn(o)),r={signal:d.signal,method:f,body:JSON.stringify(u)},l=e,i.aborted||y().then(function(){return g(n,r,t)}).catch(t))},h={results:[]},v=function(e,t){if(!i.aborted){var n=0;if(t&&t.results){n=t.results.length,h.last_seq=t.last_seq;var r=null,o=null;"number"==typeof t.pending&&(r=t.pending),"string"!=typeof h.last_seq&&"number"!=typeof h.last_seq||(o=h.last_seq),t.results=t.results.filter(function(e){c--;var t=W(i)(e);return t&&(i.include_docs&&i.attachments&&i.binary&&en(e),i.return_docs&&h.results.push(e),i.onChange(e,r,o)),t})}else if(e)return i.aborted=!0,void i.complete(e);t&&t.last_seq&&(l=t.last_seq);n=a&&c<=0||t&&n<s||i.descending;(!i.continuous||a&&c<=0)&&n?i.complete(null,h):T()(function(){p(l,v)})}};return p(i.since||0,v),{cancel:function(){i.aborted=!0,d.abort()}}},t.revsDiff=o("revsDiff",function(e,t,n){"function"==typeof t&&(n=t,t={}),g(rn(m,"_revs_diff"),{method:"POST",body:JSON.stringify(e)},n).catch(n)}),t._close=function(e){e()},t._destroy=function(e,t){g(rn(m,""),{method:"DELETE"}).then(function(e){t(null,e)}).catch(function(e){404===e.status?t(null,{ok:!0}):t(e)})}}function cn(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,cn)}catch(e){}}function un(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,un)}catch(e){}}function fn(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,fn)}catch(e){}}function ln(e,t){return t&&e.then(function(e){T()(function(){t(null,e)})},function(e){T()(function(){t(e)})}),e}function dn(n,r){return function(){var e=arguments,t=this;return n.add(function(){return r.apply(t,e)})}}function pn(e){var e=new _(e),t=new Array(e.size),n=-1;return e.forEach(function(e){t[++n]=e}),t}function hn(e){var n=new Array(e.size),r=-1;return e.forEach(function(e,t){n[++r]=t}),n}function vn(e){return new fn("builtin "+e+" function requires map values to be numbers or number arrays")}function mn(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e[n];if("number"!=typeof o){if(!Array.isArray(o))throw vn("_sum");for(var t="number"==typeof t?[t]:t,i=0,s=o.length;i<s;i++){var a=o[i];if("number"!=typeof a)throw vn("_sum");void 0===t[i]?t.push(a):t[i]+=a}}else"number"==typeof t?t+=o:t[0]+=o}return t}an.valid=function(){return!0},t()(cn,Error),t()(un,Error),t()(fn,Error);var gn=k.bind(null,"log"),yn=Array.isArray,_n=JSON.parse;function bn(e,t){return oe("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:mn,log:gn,isArray:yn,toJSON:_n})}function wn(){this.promise=new Promise(function(e){e()})}function kn(e){if(!e)return"undefined";switch(typeof e){case"function":case"string":return e.toString();default:return JSON.stringify(e)}}function On(r,o,i,s,t,a){var c,u=(e=s,kn(i)+kn(e)+"undefined");if(!t&&(c=r._cachedViews=r._cachedViews||{})[u])return c[u];var e=r.info().then(function(e){var n=e.db_name+"-mrview-"+(t?"temp":ye(u));return ie(r,"_local/"+a,function(e){e.views=e.views||{};var t=o;-1===t.indexOf("/")&&(t=o+"/"+o);t=e.views[t]=e.views[t]||{};if(!t[n])return t[n]=!0,e}).then(function(){return r.registerDependentDatabase(n).then(function(e){e=e.db;e.auto_compaction=!0;var t={name:n,db:e,sourceDB:r,adapter:r.adapter,mapFun:i,reduceFun:s};return t.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return t.seq=e?e.seq:0,c&&t.db.once("destroyed",function(){delete c[u]}),t})})})});return c&&(c[u]=e),e}wn.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},wn.prototype.finish=function(){return this.promise};var jn={},En=new wn;function xn(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function qn(e,t){try{e.emit("error",t)}catch(e){k("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),k("error",t)}}var Sn,An,Pn,Dn,Cn,Ln={_sum:function(e,t){return mn(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:mn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e[n];t+=o*o}return t}(t)}}},$n=(Sn="mrviews",An=function(e,t){if("function"!=typeof e||2!==e.length)return bn(e.toString(),t);var n=e;return function(e){return n(e,t)}},Pn=function(e){e=e.toString();return function(e){if(/^_sum/.test(e))return Ln._sum;if(/^_count/.test(e))return Ln._count;if(/^_stats/.test(e))return Ln._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}(e)||bn(e)},Dn=function(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new un("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)},{query:function(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),t=t?((o=t).group_level=Rn(o.group_level),o.limit=Rn(o.limit),o.skip=Rn(o.skip),o):{},"function"==typeof e&&(e={map:e});var o=Promise.resolve().then(function(){return function(n,e,r){if("function"==typeof n._query)return t=n,o=e,i=r,new Promise(function(n,r){t._query(o,i,function(e,t){return e?r(e):void n(t)})});var t,o,i;if(Y(n))return function(e,t,n){var r,o,i,s=[],a="GET";if(Nn("reduce",n,s),Nn("include_docs",n,s),Nn("attachments",n,s),Nn("limit",n,s),Nn("descending",n,s),Nn("group",n,s),Nn("group_level",n,s),Nn("skip",n,s),Nn("stale",n,s),Nn("conflicts",n,s),Nn("startkey",n,s,!0),Nn("start_key",n,s,!0),Nn("endkey",n,s,!0),Nn("end_key",n,s,!0),Nn("inclusive_end",n,s),Nn("key",n,s,!0),Nn("update_seq",n,s),s=""===(s=s.join("&"))?"":"?"+s,void 0!==n.keys&&((c="keys="+encodeURIComponent(JSON.stringify(n.keys))).length+s.length+1<=2e3?s+=("?"===s[0]?"&":"?")+c:(a="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)),"string"!=typeof t)return r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()}),e.fetch("_temp_view"+s,{headers:new He({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(r)}).then(function(e){return o=e.ok,i=e.status,e.json()}).then(function(e){if(!o)throw e.status=i,H(e);return e}).then(Bn(n));var c=xn(t);return e.fetch("_design/"+c[0]+"/_view/"+c[1]+s,{headers:new He({"Content-Type":"application/json"}),method:a,body:JSON.stringify(r)}).then(function(e){return o=e.ok,i=e.status,e.json()}).then(function(e){if(!o)throw e.status=i,H(e);return e.rows.forEach(function(e){if(e.value&&e.value.error&&"builtin_reduce_error"===e.value.error)throw new Error(e.reason)}),e}).then(Bn(n))}(n,e,r);if("string"!=typeof e)return Mn(r,e),En.add(function(){return On(n,"temp_view/temp_view",e.map,e.reduce,!0,Sn).then(function(e){return t=Jn(e).then(function(){return zn(e,r)}),n=function(){return e.db.destroy()},t.then(function(e){return n().then(function(){return e})},function(e){return n().then(function(){throw e})});var t,n})}),En.finish();var s=e,a=xn(s),c=a[1];return n.get("_design/"+a[0]).then(function(e){var t=e.views&&e.views[c];if(!t)throw new un("ddoc "+e._id+" has no view named "+c);return Dn(e,c),Mn(r,t),On(n,s,t.map,t.reduce,!1,Sn).then(function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&T()(function(){Jn(e)}),zn(e,r)):Jn(e).then(function(){return zn(e,r)})})})}(r,e,t)});return ln(o,n),o},viewCleanup:(Cn=function(){var e,t,n=this;return"function"==typeof n._viewCleanup?(e=n,new Promise(function(n,r){e._viewCleanup(function(e,t){return e?r(e):void n(t)})})):Y(n)?n.fetch("_view_cleanup",{headers:new He({"Content-Type":"application/json"}),method:"POST"}).then(function(e){return e.json()}):(t=n).get("_local/"+Sn).then(function(s){var a=new S;Object.keys(s.views).forEach(function(e){var t=xn(e),n="_design/"+t[0],e=t[1],t=a.get(n);t||(t=new _,a.set(n,t)),t.add(e)});var e={keys:hn(a),include_docs:!0};return t.allDocs(e).then(function(e){var i={};e.rows.forEach(function(r){var o=r.key.substring(8);a.get(r.key).forEach(function(e){var t=o+"/"+e;s.views[t]||(t=e);var t=Object.keys(s.views[t]),n=r.doc&&r.doc.views&&r.doc.views[e];t.forEach(function(e){i[e]=i[e]||n})})});e=Object.keys(i).filter(function(e){return!i[e]}).map(function(e){return dn(Kn(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Promise.all(e).then(function(){return{ok:!0}})})},Fn({ok:!0}))},u()(function(e){var t=e.pop(),e=Cn.apply(this,e);return"function"==typeof t&&ln(e,t),e}))});function In(e,t){var n=rt(e.key,t.key);return 0!==n?n:rt(e.value,t.value)}function Tn(e){var t=e.value;return t&&"object"==typeof t&&t._id||e.id}function Bn(t){return function(e){return t.include_docs&&t.attachments&&t.binary&&e.rows.forEach(function(e){var n=e.doc&&e.doc._attachments;n&&Object.keys(n).forEach(function(e){var t=n[e];n[e].data=fe(t.data,t.content_type)})}),e}}function Nn(e,t,n,r){t=t[e];void 0!==t&&(r&&(t=encodeURIComponent(JSON.stringify(t))),n.push(e+"="+t))}function Rn(e){if(void 0!==e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function Mn(t,e){var n=t.descending?"endkey":"startkey",r=t.descending?"startkey":"endkey";if(void 0!==t[n]&&void 0!==t[r]&&0<rt(t[n],t[r]))throw new cn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(e.reduce&&!1!==t.reduce){if(t.include_docs)throw new cn("{include_docs:true} is invalid for reduce");if(t.keys&&1<t.keys.length&&!t.group&&!t.group_level)throw new cn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(e){e=function(e){if(e)return"number"!=typeof e?new cn('Invalid value for integer: "'+e+'"'):e<0?new cn('Invalid value for positive integer: "'+e+'"'):void 0}(t[e]);if(e)throw e})}function Fn(t){return function(e){if(404===e.status)return t;throw e}}function Kn(e){e="string"==typeof e?e:e.name;return jn[e]||(jn[e]=new wn)}function Jn(t){return dn(Kn(t),function(){return u=An((s=t).mapFun,function(e,t){e={id:c._id,key:ot(e)};null!=t&&(e.value=ot(t)),a.push(e)}),f=s.seq||0,i=new wn,o().then(function(){return i.finish()}).then(function(){s.seq=f});function o(){return s.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:f,limit:50}).then(e)}function e(e){var t,r,n=e.results;if(n.length){e=function(e){for(var t=new S,n=0,r=e.length;n<r;n++){var o,i=e[n];"_"!==i.doc._id[0]&&(a=[],(c=i.doc)._deleted||function(t,e,n){try{e(n)}catch(e){qn(t,e)}}(s.sourceDB,u,c),a.sort(In),o=function(e){for(var t,n=new S,r=0,o=e.length;r<o;r++){var i=e[r],s=[i.key,i.id];0<r&&0===rt(i.key,t)&&s.push(r),n.set(it(s),i),t=i.key}return n}(a),t.set(i.doc._id,[o,i.changes])),f=i.seq}return t}(n);if(i.add((t=e,r=f,function(){return i=t,n=r,(o=s).db.get("_local/lastSeq").catch(Fn({_id:"_local/lastSeq",seq:0})).then(function(t){var e=hn(i);return Promise.all(e.map(function(e){return n=o,r={_id:t="_local/doc_"+e,keys:[]},e=i.get(e),u=e[0],(1===(e=e[1]).length&&/^1-/.test(e[0].rev)?Promise.resolve(r):n.db.get(t).catch(Fn(r))).then(function(t){return(t.keys.length?n.db.allDocs({keys:t.keys,include_docs:!0}):Promise.resolve({rows:[]})).then(function(e){return function(e,t){for(var n=[],r=new _,o=0,i=t.rows.length;o<i;o++){var s,a=t.rows[o].doc;a&&(n.push(a),r.add(a._id),a._deleted=!u.has(a._id),a._deleted||"value"in(s=u.get(a._id))&&(a.value=s.value))}var c=hn(u);return c.forEach(function(e){var t;r.has(e)||(t={_id:e},"value"in(e=u.get(e))&&(t.value=e.value),n.push(t))}),e.keys=pn(c.concat(e.keys)),n.push(e),n}(t,e)})});var n,t,r,u})).then(function(e){e=V(e);return t.seq=n,e.push(t),o.db.bulkDocs({docs:e})})});var o,i,n})),!(n.length<50))return o()}}var s,a,c,u,f,i})()}function zn(e,t){return dn(Kn(e),function(){return function(n,o){var i,e,s=n.reduceFun&&!1!==o.reduce,a=o.skip||0;function t(e){return e.include_docs=!0,n.db.allDocs(e).then(function(e){return i=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||n<t))return e.doc.value}t=function(e){for(var t,n,r,o,i,s=[],a=[],c=0;;){var u=e[c++];if("\0"!==u)switch(u){case"1":s.push(null);break;case"2":s.push("1"===e[c]),c++;break;case"3":var f=function(e,t){var n,r=t;if("1"===e[t])n=0,t++;else{var o="0"===e[t],i="",s=e.substring(++t,t+tt),s=parseInt(s,10)+et;for(o&&(s=-s),t+=tt;;){var a=e[t];if("\0"===a)break;i+=a,t++}n=1===(i=i.split(".")).length?parseInt(i,10):parseFloat(i[0]+"."+i[1]),o&&(n-=10),0!==s&&(n=parseFloat(n+"e"+s))}return{num:n,length:t-r}}(e,c);s.push(f.num),c+=f.length;break;case"4":for(var l="";;){var d=e[c];if("\0"===d)break;l+=d,c++}l=l.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),s.push(l);break;case"5":var p={element:[],index:s.length};s.push(p.element),a.push(p);break;case"6":p={element:{},index:s.length};s.push(p.element),a.push(p);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+u)}else{if(1===s.length)return s.pop();n=a,r=o=void 0,i=(t=s).pop(),n.length&&(i===(o=n[n.length-1]).element&&(n.pop(),o=n[n.length-1]),r=o.element,o=o.index,Array.isArray(r)?r.push(i):o===t.length-2?r[t.pop()]=i:t.push(i))}}}(e.doc._id);return{key:t[0],id:t[1],value:"value"in e.doc?e.doc.value:null}})})}function r(t){var r=s?function(e,t,n){0===n.group_level&&delete n.group_level;var r=n.group||n.group_level,o=Pn(e.reduceFun),i=[],s=isNaN(n.group_level)?Number.POSITIVE_INFINITY:n.group_level;t.forEach(function(e){var t=i[i.length-1],n=r?e.key:null;if(r&&Array.isArray(n)&&(n=n.slice(0,s)),t&&0===rt(t.groupKey,n))return t.keys.push([e.key,e.id]),void t.values.push(e.value);i.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(var a,c,u=0,f=i.length;u<f;u++){var l=i[u],d=function(t,e,n,r){try{return{output:e(n,r,!1)}}catch(e){return qn(t,e),{error:e}}}(e.sourceDB,o,l.keys,l.values);if(d.error&&d.error instanceof fn)throw d.error;t.push({value:d.error?null:d.output,key:l.groupKey})}return{rows:(a=t,c=n.skip||0,"number"==typeof(n=n.limit)?a.slice(c,n+c):0<c?a.slice(c):a)}}(n,t,o):{total_rows:i,offset:a,rows:t};if(o.update_seq&&(r.update_seq=n.seq),o.include_docs){var e=pn(t.map(Tn));return n.sourceDB.allDocs({keys:e,include_docs:!0,conflicts:o.conflicts,attachments:o.attachments,binary:o.binary}).then(function(e){var n=new S;return e.rows.forEach(function(e){n.set(e.id,e.doc)}),t.forEach(function(e){var t=Tn(e),t=n.get(t);t&&(e.doc=t)}),r})}return r}if(void 0===o.keys||o.keys.length||(o.limit=0,delete o.keys),void 0!==o.keys){var c=o.keys.map(function(e){e={startkey:it([e]),endkey:it([e,{}])};return o.update_seq&&(e.update_seq=!0),t(e)});return Promise.all(c).then(V).then(r)}var u,f,c={descending:o.descending};return o.update_seq&&(c.update_seq=!0),"start_key"in o&&(e=o.start_key),"startkey"in o&&(e=o.startkey),"end_key"in o&&(f=o.end_key),"endkey"in o&&(f=o.endkey),void 0!==e&&(c.startkey=it(o.descending?[e,{}]:[e])),void 0!==f&&(u=!1!==o.inclusive_end,c.endkey=it((u=o.descending?!u:u)?[f,{}]:[f])),void 0!==o.key&&(u=it([o.key]),f=it([o.key,{}]),c.descending?(c.endkey=u,c.startkey=f):(c.startkey=u,c.endkey=f)),s||("number"==typeof o.limit&&(c.limit=o.limit),c.skip=a),t(c).then(r)}(e,t)})()}e={query:function(e,t,n){return $n.query.call(this,e,t,n)},viewCleanup:function(e){return $n.viewCleanup.call(this,e)}};function Un(e){return/^1-/.test(e)}function Hn(t,n){var e=Object.keys(n._attachments);return Promise.all(e.map(function(e){return t.getAttachment(n._id,e,{rev:n._rev})}))}var Wn="pouchdb";function Vn(t,n,r,o,i){return t.get(n).catch(function(e){if(404===e.status)return"http"!==t.adapter&&"https"!==t.adapter||O(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:o,_id:n,history:[],replicator:Wn,version:1};throw e}).then(function(e){if(!i.cancelled&&e.last_seq!==r)return e.history=(e.history||[]).filter(function(e){return e.session_id!==o}),e.history.unshift({last_seq:r,session_id:o}),e.history=e.history.slice(0,5),e.version=1,e.replicator=Wn,e.session_id=o,e.last_seq=r,t.put(e).catch(function(e){if(409===e.status)return Vn(t,n,r,o,i);throw e})})}function Gn(e,t,n,r,o){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=o||{}}Gn.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},Gn.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?Vn(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},Gn.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return Vn(this.src,this.id,e,t,this.returnValue).catch(function(e){if(Xn(e))return!(n.opts.writeSourceCheckpoint=!1);throw e})}return Promise.resolve(!0)};var Yn={undefined:function(e,t){return 0===rt(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return((t=t).session_id!==e.session_id?function e(t,n){var r=t[0],o=t.slice(1),i=n[0],s=n.slice(1);return r&&0!==n.length?Qn(r.session_id,n)?{last_seq:r.last_seq,history:t}:Qn(i.session_id,o)?{last_seq:i.last_seq,history:s}:e(o,s):{last_seq:0,history:[]}}(t.history,e.history):{last_seq:t.last_seq,history:t.history}).last_seq}};function Qn(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||Qn(e,r))}function Xn(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function Zn(u,f,l,d,i){var n,p,r=[],o={seq:0,changes:[],docs:[]},s=!1,a=!1,c=!1,h=0,v=l.continuous||l.live||!1,t=l.batch_size||100,m=l.batches_limit||10,g=!1,y=l.doc_ids,_=l.selector,b=[],w=be();i=i||{ok:!0,start_time:(new Date).toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var k={};function e(){return p?Promise.resolve():(e=u,t=f,o=(n=l).doc_ids?n.doc_ids.sort(rt):"",i=n.filter?n.filter.toString():"",c=a=s="",n.selector&&(c=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify((r=n.query_params,Object.keys(r).sort(rt).reduce(function(e,t){return e[t]=r[t],e},{})))),n.filter&&"_view"===n.filter&&(a=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+a+s+o+c;return new Promise(function(e){ge(t,e)})}).then(function(e){return"_local/"+e.replace(/\//g,".").replace(/\+/g,"_")}).then(function(e){p=new Gn(u,f,e,d,!1===l.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:"source"===l.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:"target"===l.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0})}));var e,t,n,r,o,i,s,a,c}function O(){if(b=[],0!==n.docs.length){var t=n.docs;return f.bulkDocs({docs:t,new_edits:!1},{timeout:l.timeout}).then(function(e){if(d.cancelled)throw A(),new Error("cancelled");var r=Object.create(null);e.forEach(function(e){e.error&&(r[e.id]=e)});e=Object.keys(r).length;i.doc_write_failures+=e,i.docs_written+=t.length-e,t.forEach(function(e){var t=r[e._id];if(t){i.errors.push(t);var n=(t.name||"").toLowerCase();if("unauthorized"!==n&&"forbidden"!==n)throw t;d.emit("denied",B(t))}else b.push(e)})},function(e){throw i.doc_write_failures+=t.length,e})}}function j(){if(n.error)throw new Error("There was a problem getting docs.");i.last_seq=h=n.seq;var e=B(i);return b.length&&(e.docs=b,"number"==typeof n.pending&&(e.pending=n.pending,delete n.pending),d.emit("change",e)),s=!0,p.writeCheckpoint(n.seq,w).then(function(){if(s=!1,d.cancelled)throw A(),new Error("cancelled");n=void 0,L()}).catch(function(e){throw I(e),e})}function E(){return function(a,c,r,o){r=B(r);var i=[],u=!0;return Promise.resolve().then(function(){var e=Object.keys(r).filter(function(e){e=r[e].missing;return 1===e.length&&Un(e[0])});if(0<e.length)return a.allDocs({keys:e,include_docs:!0,conflicts:!0}).then(function(e){if(o.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){var t;e.deleted||!e.doc||!Un(e.value.rev)||(t=e.doc)._attachments&&0<Object.keys(t._attachments).length||(t=e.doc)._conflicts&&0<t._conflicts.length||(e.doc._conflicts&&delete e.doc._conflicts,i.push(e.doc),delete r[e.id])})})}).then(function(){var e,n,t=(e=r,n=[],Object.keys(e).forEach(function(t){e[t].missing.forEach(function(e){n.push({id:t,rev:e})})}),{docs:n,revs:!0,latest:!0});if(t.docs.length)return a.bulkGet(t).then(function(e){if(o.cancelled)throw new Error("cancelled");return Promise.all(e.results.map(function(e){return Promise.all(e.docs.map(function(e){var n,r,o,i,s=e.ok;return e.error&&(u=!1),s&&s._attachments?(n=c,o=s,e=Y(r=a)&&!Y(n),i=Object.keys(o._attachments),(e?n.get(o._id).then(function(t){return Promise.all(i.map(function(e){return t._attachments&&t._attachments[e]&&t._attachments[e].digest===o._attachments[e].digest?n.getAttachment(t._id,e):r.getAttachment(o._id,e)}))}).catch(function(e){if(404!==e.status)throw e;return Hn(r,o)}):Hn(r,o)).then(function(e){var n=Object.keys(s._attachments);return e.forEach(function(e,t){t=s._attachments[n[t]];delete t.stub,delete t.length,t.data=e}),s})):s}))})).then(function(e){i=i.concat(V(e).filter(Boolean))})})}).then(function(){return{ok:u,docs:i}})}(u,f,n.diffs,d).then(function(e){n.error=!e.ok,e.docs.forEach(function(e){delete n.diffs[e._id],i.docs_read++,n.docs.push(e)})})}function x(){var t;d.cancelled||n||(0!==r.length?(n=r.shift(),t={},n.changes.forEach(function(e){"_user/"!==e.id&&(t[e.id]=e.changes.map(function(e){return e.rev}))}),f.revsDiff(t).then(function(e){if(d.cancelled)throw A(),new Error("cancelled");n.diffs=e}).then(E).then(O).then(j).then(x).catch(function(e){S("batch processing terminated with error",e)})):q(!0))}function q(e){0!==o.changes.length?(e||a||t<=o.changes.length)&&(r.push(o),o={seq:0,changes:[],docs:[]},"pending"!==d.state&&"stopped"!==d.state||(d.state="active",d.emit("active")),x()):0!==r.length||n||((v&&k.live||a)&&(d.state="pending",d.emit("paused")),a&&A())}function S(e,t){c||(t.message||(t.message=e),i.ok=!1,i.status="aborting",r=[],o={seq:0,changes:[],docs:[]},A(t))}function A(e){var t,n,r,o;c||d.cancelled&&(i.status="cancelled",s)||(i.status=i.status||"complete",i.end_time=(new Date).toISOString(),i.last_seq=h,c=!0,e?((e=U(e)).result=i,"unauthorized"===(t=(e.name||"").toLowerCase())||"forbidden"===t?(d.emit("error",e),d.removeAllListeners()):(r=d,e=e,!1===(n=l).retry?(r.emit("error",e),r.removeAllListeners()):("function"!=typeof n.back_off_function&&(n.back_off_function=N),r.emit("requestError",e),"active"!==r.state&&"pending"!==r.state||(r.emit("paused",e),r.state="stopped",o=function(){n.current_back_off=0},r.once("paused",function(){r.removeListener("active",o)}),r.once("active",o)),n.current_back_off=n.current_back_off||0,n.current_back_off=n.back_off_function(n.current_back_off),setTimeout(function(){Zn(u,f,l,d)},n.current_back_off)))):(d.emit("complete",i),d.removeAllListeners()))}function P(e,t,n){if(d.cancelled)return A();"number"==typeof t&&(o.pending=t),W(l)(e)&&(o.seq=e.seq||n,o.changes.push(e),T()(function(){q(0===r.length&&k.live)}))}function D(e){if(g=!1,d.cancelled)return A();var t;0<e.results.length?(k.since=e.results[e.results.length-1].seq,L(),q(!0)):(t=function(){v?(k.live=!0,L()):a=!0,q(!0)},n||0!==e.results.length?t():(s=!0,p.writeCheckpoint(e.last_seq,w).then(function(){s=!1,i.last_seq=h=e.last_seq,t()}).catch(I)))}function C(e){if(g=!1,d.cancelled)return A();S("changes rejected",e)}function L(){var e;function t(){e.cancel()}function n(){d.removeListener("cancel",t)}!g&&!a&&r.length<m&&(g=!0,d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",t),(e=u.changes(k).on("change",P)).then(n,n),e.then(D).catch(C),l.retry&&(d._changes=e,d._abortChanges=t))}function $(){e().then(function(){return d.cancelled?void A():p.getCheckpoint().then(function(e){k={since:h=e,limit:t,batch_size:t,style:"all_docs",doc_ids:y,selector:_,return_docs:!0},l.filter&&("string"!=typeof l.filter?k.include_docs=!0:k.filter=l.filter),"heartbeat"in l&&(k.heartbeat=l.heartbeat),"timeout"in l&&(k.timeout=l.timeout),l.query_params&&(k.query_params=l.query_params),l.view&&(k.view=l.view),L()})}).catch(function(e){S("getCheckpoint rejected with ",e)})}function I(e){s=!1,S("writeCheckpoint completed with error",e)}d.ready(u,f),d.cancelled?A():(d._addedListeners||(d.once("cancel",A),"function"==typeof l.complete&&(d.once("error",l.complete),d.once("complete",function(e){l.complete(null,e)})),d._addedListeners=!0),void 0===l.since?$():e().then(function(){return s=!0,p.writeCheckpoint(l.since,w)}).then(function(){s=!1,d.cancelled?A():(h=l.since,$())}).catch(I))}function er(){a.a.call(this),this.cancelled=!1,this.state="pending";var n=this,r=new Promise(function(e,t){n.once("complete",e),n.once("error",t)});n.then=function(e,t){return r.then(e,t)},n.catch=function(e){return r.catch(e)},n.catch(function(){})}function tr(e,t){return"string"==typeof e?new t.PouchConstructor(e,t):e}function nr(e,t,n,r){if("function"==typeof n&&(r=n,n={}),(n=void 0===n?{}:n).doc_ids&&!Array.isArray(n.doc_ids))throw U(M,"`doc_ids` filter parameter is not a list.");n.complete=r,(n=B(n)).continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;r=new er;return Zn(tr(e,n),tr(t,n),n,r),r}function rr(e,t,n,r){return"function"==typeof n&&(r=n,n={}),(n=B(n=void 0===n?{}:n)).PouchConstructor=n.PouchConstructor||this,new or(e=tr(e,n),t=tr(t,n),n,r)}function or(e,t,n,r){var o=this;this.canceled=!1;var i=n.push?j({},n,n.push):n,s=n.pull?j({},n,n.pull):n;function a(e){o.emit("change",{direction:"pull",change:e})}function c(e){o.emit("change",{direction:"push",change:e})}function u(e){o.emit("denied",{direction:"push",doc:e})}function f(e){o.emit("denied",{direction:"pull",doc:e})}function l(){o.pushPaused=!0,o.pullPaused&&o.emit("paused")}function d(){o.pullPaused=!0,o.pushPaused&&o.emit("paused")}function p(){o.pushPaused=!1,o.pullPaused&&o.emit("active",{direction:"push"})}function h(){o.pullPaused=!1,o.pushPaused&&o.emit("active",{direction:"pull"})}this.push=nr(e,t,i),this.pull=nr(t,e,s),this.pushPaused=!0,this.pullPaused=!0;var v={};function m(n){return function(e,t){("change"!==e||t!==a&&t!==c)&&("denied"!==e||t!==f&&t!==u)&&("paused"!==e||t!==d&&t!==l)&&("active"!==e||t!==h&&t!==p)||(e in v||(v[e]={}),v[e][n]=!0,2===Object.keys(v[e]).length&&o.removeAllListeners(e))}}function g(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}n.live&&(this.push.on("complete",o.pull.cancel.bind(o.pull)),this.pull.on("complete",o.push.cancel.bind(o.push))),this.on("newListener",function(e){"change"===e?(g(o.pull,"change",a),g(o.push,"change",c)):"denied"===e?(g(o.pull,"denied",f),g(o.push,"denied",u)):"active"===e?(g(o.pull,"active",h),g(o.push,"active",p)):"paused"===e&&(g(o.pull,"paused",d),g(o.push,"paused",l))}),this.on("removeListener",function(e){"change"===e?(o.pull.removeListener("change",a),o.push.removeListener("change",c)):"denied"===e?(o.pull.removeListener("denied",f),o.push.removeListener("denied",u)):"active"===e?(o.pull.removeListener("active",h),o.push.removeListener("active",p)):"paused"===e&&(o.pull.removeListener("paused",d),o.push.removeListener("paused",l))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var y=Promise.all([this.push,this.pull]).then(function(e){e={push:e[0],pull:e[1]};return o.emit("complete",e),r&&r(null,e),o.removeAllListeners(),e},function(e){if(o.cancel(),r?r(e):o.emit("error",e),o.removeAllListeners(),r)throw e});this.then=function(e,t){return y.then(e,t)},this.catch=function(e){return y.catch(e)}}Gn.prototype.getCheckpoint=function(){var t=this;return t.opts&&t.opts.writeSourceCheckpoint&&!t.opts.writeTargetCheckpoint?t.src.get(t.id).then(function(e){return e.last_seq||0}).catch(function(e){if(404!==e.status)throw e;return 0}):t.target.get(t.id).then(function(n){return t.opts&&t.opts.writeTargetCheckpoint&&!t.opts.writeSourceCheckpoint?n.last_seq||0:t.src.get(t.id).then(function(e){if(n.version!==e.version)return 0;var t=n.version?n.version.toString():"undefined";return t in Yn?Yn[t](n,e):0},function(e){if(404===e.status&&n.last_seq)return t.src.put({_id:t.id,last_seq:0}).then(function(){return 0},function(e){return Xn(e)?(t.opts.writeSourceCheckpoint=!1,n.last_seq):0});throw e})}).catch(function(e){if(404!==e.status)throw e;return 0})},t()(er,a.a),er.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},er.prototype.ready=function(e,t){var n=this;function r(){n.cancel()}n._readyCalled||(n._readyCalled=!0,e.once("destroyed",r),t.once("destroyed",r),n.once("complete",function(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}))},t()(or,a.a),or.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Je.plugin(function(e){e.adapter("idb",Xt,!0)}).plugin(function(e){e.adapter("http",an,!1),e.adapter("https",an,!1)}).plugin(e).plugin(function(e){e.replicate=nr,e.sync=rr,Object.defineProperty(e.prototype,"replicate",{get:function(){var r=this;return void 0===this.replicateMethods&&(this.replicateMethods={from:function(e,t,n){return r.constructor.replicate(e,r,t,n)},to:function(e,t,n){return r.constructor.replicate(r,e,t,n)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}}),ir.default=Je}.call(this,sr(282))}}]);